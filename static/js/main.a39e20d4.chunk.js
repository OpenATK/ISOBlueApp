(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1018:function(e,t,n){"use strict";var r=s(n(248)),a=s(n(260)),c=s(n(1019)),u=s(n(1020)),o=s(n(384));n(1021);function s(e){return e&&e.__esModule?e:{default:e}}var i=n(180),l=n(90),d=(n(264),n(140)),p=n(1125),f=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,c.default)(this,e);this._token=t.token||null,this._domain=t.domain||"localhost",this._options=t.options;var n=d.createHash("sha256");n.update(this._domain),this._name=n.digest("hex"),this._isSet=!!this._token,this._tokenDB=new o.default(this._name),this._id="OadaTokenID",this._rev=null,this.token=this._token?this._token:""}return(0,u.default)(e,[{key:"checkTokenDB",value:function(){var e=(0,a.default)(r.default.mark(function e(){var t,n;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=null,e.prev=1,e.next=4,this._tokenDB.get(this._id);case 4:n=e.sent,t=n.token,this._rev=n._rev,e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(1),e.abrupt("return",t);case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}},e,this,[[1,9]])}));return function(){return e.apply(this,arguments)}}()},{key:"setup",value:function(){var e=(0,a.default)(r.default.mark(function e(t){var n,a,c,u;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,!this.isSet()){e.next=5;break}n=this.token,e.next=23;break;case 5:return e.next=7,this.checkTokenDB();case 7:if((n=e.sent)&&!t){e.next=23;break}if(a=l.parse(this._domain),c=void 0,"undefined"!==typeof window){e.next=17;break}return e.next=14,p.node(a.host,this._options);case 14:c=e.sent,e.next=21;break;case 17:return u=i.promisify(p.getAccessToken),e.next=20,u(a.host,this._options);case 20:c=e.sent;case 21:n=c.access_token,this.put(n);case 23:return e.abrupt("return",n);case 24:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=(0,a.default)(r.default.mark(function e(){return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.setup());case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"put",value:function(){var e=(0,a.default)(r.default.mark(function e(t){var n;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.checkTokenDB(),e.prev=1,!n){e.next=9;break}return e.next=5,this._tokenDB.put({_id:this._id,_rev:this._rev,token:t});case 5:e.sent,this.token=t,e.next=13;break;case 9:return e.next=11,this._tokenDB.put({_id:this._id,token:t});case 11:e.sent,this.token=t;case 13:e.next=17;break;case 15:e.prev=15,e.t0=e.catch(1);case 17:case"end":return e.stop()}},e,this,[[1,15]])}));return function(t){return e.apply(this,arguments)}}()},{key:"renew",value:function(){var e=(0,a.default)(r.default.mark(function e(){return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._isSet=!1,e.abrupt("return",this.setup(!0));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"cleanUp",value:function(){var e=(0,a.default)(r.default.mark(function e(){return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._tokenDB.destroy();case 3:this._isSet=!1,e.next=8;break;case 6:e.prev=6,e.t0=e.catch(0);case 8:case"end":return e.stop()}},e,this,[[0,6]])}));return function(){return e.apply(this,arguments)}}()},{key:"isSet",value:function(){return this._isSet}}]),e}();e.exports=f},1027:function(e,t){},1029:function(e,t){},1035:function(e,t){},1037:function(e,t){},1068:function(e,t){},1070:function(e,t){},1071:function(e,t){},1077:function(e,t){},1080:function(e,t){},1100:function(e,t){},1103:function(e,t){},1119:function(e,t){},1122:function(e,t){},1172:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"toggleDrawerOpen",function(){return Nt});var a={};n.r(a),n.d(a,"storeUserLocation",function(){return Zt}),n.d(a,"centerOnUser",function(){return Bt}),n.d(a,"centerOnUnit",function(){return Ht});var c={};n.r(c),n.d(c,"handleDeviceUpdate",function(){return on}),n.d(c,"getDevices",function(){return sn}),n.d(c,"init",function(){return ln}),n.d(c,"getHour",function(){return dn});var u={};n.r(u),n.d(u,"setDate",function(){return En}),n.d(u,"setHour",function(){return In}),n.d(u,"setMeasurement",function(){return Sn}),n.d(u,"selectUnit",function(){return Cn}),n.d(u,"unselectUnit",function(){return Dn}),n.d(u,"toggleMode",function(){return Un});var o={};n.r(o),n.d(o,"createSnapshots",function(){return Vn});var s={};n.r(s),n.d(s,"signOut",function(){return tr}),n.d(s,"updateOadaDomain",function(){return nr}),n.d(s,"connect",function(){return rr}),n.d(s,"setConnection",function(){return ar});var i={};n.r(i),n.d(i,"init",function(){return sr});var l=n(1),d=n.n(l),p=n(48),f=n(21),h=n(4),b=n(34),v=n(35),m=n(37),O=n(36),j=n(38),x=n(31),k=n(3),g=n(190),y=n.n(g),w=n(280),_=n(149),E=n.n(_),I=n(118),S=n.n(I),C=n(186),D=n.n(C),U=n(468),L=n.n(U),M=n(469),q=n.n(M);function R(){var e=Object(h.a)(["session.toggleDrawerOpen"]);return R=function(){return e},e}function N(){var e=Object(h.a)(["map.centerOnUser"]);return N=function(){return e},e}function V(){var e=Object(h.a)(["map.userLocationAvailable"]);return V=function(){return e},e}var T=function(e){function t(){return Object(b.a)(this,t),Object(m.a)(this,Object(O.a)(t).apply(this,arguments))}return Object(j.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){var e,t=this,n=this.props.classes;return e=this.props.userLocationAvailable?d.a.createElement(E.a,{onClick:function(){return t.props.centerOnUser({})}},d.a.createElement(L.a,{className:n.icon})):null,d.a.createElement(D.a,null,d.a.createElement(E.a,{color:"inherit","aria-label":"Open Drawer",onClick:function(){return t.props.toggleDrawerOpen({})}},d.a.createElement(q.a,{className:n.icon})),d.a.createElement(S.a,{variant:"h6",color:"inherit",className:n.flex},"ISOBlueApp [1.1.0]"),e)}}]),t}(d.a.Component),W=Object(x.connect)({userLocationAvailable:Object(k.state)(V()),centerOnUser:Object(k.signal)(N()),toggleDrawerOpen:Object(k.signal)(R())},Object(f.withStyles)(function(e){var t;return{flex:{flex:1},icon:(t={color:"#FFFFFF"},Object(w.a)(t,e.breakpoints.up("xs"),{width:5*e.spacing.unit,height:5*e.spacing.unit,marginRight:e.spacing.unit}),Object(w.a)(t,e.breakpoints.down("xs"),{width:4*e.spacing.unit,height:4*e.spacing.unit,marginRight:e.spacing.unit}),t)}})(T)),G=n(1176),P=n(1177),A=n(1179),F=(n(667),n(24)),J=n.n(F),X=(n(310),n(1174));function Z(){var e=Object(h.a)(["diagnostics.selectedUnit"]);return Z=function(){return e},e}function B(){var e=Object(h.a)(["diagnostics.hour"]);return B=function(){return e},e}function H(){var e=Object(h.a)(["diagnostics.date"]);return H=function(){return e},e}function Y(){var e=Object(h.a)(["oada"]);return Y=function(){return e},e}function z(){var e=Object(h.a)(["data.ready"]);return z=function(){return e},e}function Q(){var e=Object(h.a)(["data.connection_id"]);return Q=function(){return e},e}var K=function(e){function t(e){var n;return Object(b.a)(this,t),(n=Object(m.a)(this,Object(O.a)(t).call(this,e))).dataLines=[],n}return Object(j.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){var e=this,t=this.props.connection_id;if(!this.props.ready)return null;if(this.dataLines=[],!this.props.oada[t].bookmarks.hasOwnProperty("isoblue"))return null;var n=this.props.oada[t].bookmarks.isoblue["device-index"]||{};if(this.props.selectedUnit&&this.props.date&&this.props.hour){var r=null;try{r=n[this.props.selectedUnit].location["day-index"][this.props.date]["hour-index"][this.props.hour]["sec-index"]}catch(c){return console.error("hmm"),null}var a=[];J.a.forEach(r,function(e){e.hasOwnProperty("lat")&&e.hasOwnProperty("lng")&&e.lat&&e.lng&&a.push([e.lat,e.lng])}),this.dataLines.push(a)}else J.a.forEach(n,function(t,n){if(t.hasOwnProperty("location")&&t.location.hasOwnProperty("day-index")){var r=Object.keys(t.location["day-index"]);if(0!==r.length){var a=J.a.maxBy(r,function(e){return new Date(e)});if(t.location["day-index"][a].hasOwnProperty("hour-index")){var c=Object.keys(t.location["day-index"][a]["hour-index"]),u=J.a.max(c),o=J.a.max(J.a.remove(c,function(e){return e!==u})),s=Math.round((new Date).getTime()/1e3),i=[];if(void 0!==o&&t.location["day-index"][a]["hour-index"][o].hasOwnProperty("sec-index")){var l=t.location["day-index"][a]["hour-index"][o]["sec-index"];Object.keys(l||{}).forEach(function(e){s-e<=900&&l[e].hasOwnProperty("lat")&&l[e].hasOwnProperty("lng")&&l[e].lat&&l[e].lng&&i.push([l[e].lat,l[e].lng])})}if(t.location["day-index"][a]["hour-index"][u].hasOwnProperty("sec-index")){var d=t.location["day-index"][a]["hour-index"][u]["sec-index"];Object.keys(d||{}).forEach(function(e){s-e<=900&&d[e].hasOwnProperty("lat")&&d[e].hasOwnProperty("lng")&&d[e].lat&&d[e].lng&&i.push([d[e].lat,d[e].lng])})}e.dataLines.push(i)}}}});return d.a.createElement("div",null,this.dataLines.map(function(e){return d.a.createElement(X.a,{positions:e,color:"#ffffff"})}))}}]),t}(d.a.Component),$=Object(x.connect)({connection_id:Object(k.state)(Q()),ready:Object(k.state)(z()),oada:Object(k.state)(Y()),date:Object(k.state)(H()),hour:Object(k.state)(B()),selectedUnit:Object(k.state)(Z())},Object(f.withStyles)(function(e){return{}},{withTheme:!0})(K)),ee=n(1175),te=n(1178);function ne(){var e=Object(h.a)(["diagnostics.selectUnit"]);return ne=function(){return e},e}function re(){var e=Object(h.a)(["snapshots"]);return re=function(){return e},e}var ae=function(e){function t(){return Object(b.a)(this,t),Object(m.a)(this,Object(O.a)(t).apply(this,arguments))}return Object(j.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){var e=this,t=[];return J.a.forEach(Object.keys(this.props.snapshots)||{},function(n){var r=e.props.snapshots[n].location;r&&r.hasOwnProperty("lat")&&r.hasOwnProperty("lng")&&r.lat&&r.lng&&t.push(d.a.createElement(ee.a,{ref:function(t){e.unit=t},key:n,center:[e.props.snapshots[n].location.lat,e.props.snapshots[n].location.lng],color:"#ffffff",fillColor:function(){switch(e.props.snapshots[n].health){case"Healthy":return"#008000";case"Sick":return"#ffbf00";case"Down":default:return"#707070"}}(),fillOpacity:1,radius:12,zIndexOffset:1,onClick:function(t){return e.props.selectUnit({unit:n})}},d.a.createElement(te.a,{direction:"top",offset:[0,-10]},d.a.createElement("b",null,"Unit: ",n),d.a.createElement("br",null),d.a.createElement("center",null,d.a.createElement("b",null,e.props.snapshots[n].health)))))}),d.a.createElement("div",null,t)}}]),t}(d.a.Component),ce=Object(x.connect)({snapshots:Object(k.state)(re()),selectUnit:Object(k.signal)(ne())},Object(f.withStyles)(function(e){return{}},{withTheme:!0})(ae));function ue(){var e=Object(h.a)(["diagnostics.selectUnit"]);return ue=function(){return e},e}function oe(){var e=Object(h.a)(["map.storeUserLocation"]);return oe=function(){return e},e}function se(){var e=Object(h.a)(["map.userLocationAvailable"]);return se=function(){return e},e}function ie(){var e=Object(h.a)(["map.userLocation"]);return ie=function(){return e},e}function le(){var e=Object(h.a)(["map.targetCenter"]);return le=function(){return e},e}var de=function(e){function t(){return Object(b.a)(this,t),Object(m.a)(this,Object(O.a)(t).apply(this,arguments))}return Object(j.a)(t,e),Object(v.a)(t,[{key:"componentDidMount",value:function(){this.refs.map.leafletElement.locate()}},{key:"render",value:function(){var e=this,t=this.props.classes,n=[];return this.props.userLocationAvailable&&n.push(d.a.createElement(G.a,{key:"user",position:[this.props.userLocation.lat,this.props.userLocation.lng]},"zIndexOffset=",1)),d.a.createElement("div",{className:t.map},d.a.createElement(P.a,{dragging:!0,center:[this.props.targetCenter.lat,this.props.targetCenter.lng],ref:"map",zoom:18,onlocationfound:function(t){return e.props.storeUserLocation({lat:t.latlng.lat,lng:t.latlng.lng})},style:{height:"100%",width:"100%",position:"relative"}},d.a.createElement(A.a,{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"}),d.a.createElement(ce,null),d.a.createElement($,null),n))}}]),t}(d.a.Component),pe=Object(x.connect)({targetCenter:Object(k.state)(le()),userLocation:Object(k.state)(ie()),userLocationAvailable:Object(k.state)(se()),storeUserLocation:Object(k.signal)(oe()),selectUnit:Object(k.signal)(ue())},Object(f.withStyles)(function(e){return{map:{position:"relative",display:"flex",width:"100%",height:"calc(100% - 56px)"}}},{withTheme:!0})(de)),fe=n(41);function he(){var e=Object(h.a)(["data"]);return he=function(){return e},e}function be(){var e=Object(h.a)(["oada"]);return be=function(){return e},e}function ve(){var e=Object(h.a)(["diagnostics.measurement"]);return ve=function(){return e},e}function me(){var e=Object(h.a)(["diagnostics.selectedUnit"]);return me=function(){return e},e}function Oe(){var e=Object(h.a)(["diagnostics.hour"]);return Oe=function(){return e},e}function je(){var e=Object(h.a)(["diagnostics.date"]);return je=function(){return e},e}function xe(){var e=Object(h.a)(["data.connection_id"]);return xe=function(){return e},e}var ke=function(e){function t(){return Object(b.a)(this,t),Object(m.a)(this,Object(O.a)(t).apply(this,arguments))}return Object(j.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){var e;if(!(this.props.selectedUnit&&this.props.date&&this.props.hour))return null;e=this.props.oada[this.props.connection_id].bookmarks.isoblue["device-index"][this.props.selectedUnit]["day-index"][this.props.date]["hour-index"][this.props.hour];var t,n=[];return"Latency"===this.props.measurement&&e?(J.a.forEach(Object.values(e.heartbeats||{}),function(e){e.latency=e.recTime-e.genTime,e.time=new Date(1e3*e.genTime).toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric"}),n.push(e)}),t=d.a.createElement(fe.c,{data:n,margin:{top:20,right:30,left:0,bottom:80}},d.a.createElement(fe.b,{type:"step",isAnimationActive:!1,dataKey:"latency",stroke:"#8884d8"}),d.a.createElement(fe.a,{stroke:"#ccc",strokeDasharray:"5 5"}),d.a.createElement(fe.f,{dataKey:"time",label:{value:"Time",position:"insideBottom",dy:20}}),d.a.createElement(fe.g,{dataKey:"latency",label:{value:"Latency (sec)",position:"insideLeft",angle:-90}}),d.a.createElement(fe.e,null))):"Wifi RSSI"===this.props.measurement&&e?(J.a.forEach(Object.values(e.heartbeats||{}),function(e){J.a.forEach(e.interfaces,function(t){"wifi"===t.type&&(t.time=new Date(1e3*e.genTime).toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric"}),n.push(t))})}),t=d.a.createElement(fe.c,{data:n,margin:{top:20,right:30,left:0,bottom:80}},d.a.createElement(fe.b,{type:"step",isAnimationActive:!1,dataKey:"rssi",stroke:"#8884d8"}),d.a.createElement(fe.a,{stroke:"#ccc",strokeDasharray:"5 5"}),d.a.createElement(fe.f,{dataKey:"time"}),d.a.createElement(fe.g,{dataKey:"rssi",label:{value:"WiFi RSSI (dB)",position:"insideLeft",angle:-90}}),d.a.createElement(fe.e,null))):"Cellular RSSI"===this.props.measurement&&e?(J.a.forEach(Object.values(e.heartbeats||{}),function(e){J.a.forEach(e.interfaces,function(t){"cellular"===t.type&&(t.time=new Date(1e3*e.genTime).toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric"}),n.push(t))})}),t=d.a.createElement(fe.c,{data:n,margin:{top:20,right:30,left:0,bottom:80}},d.a.createElement(fe.b,{type:"step",isAnimationActive:!1,dataKey:"rssi",stroke:"#8884d8"}),d.a.createElement(fe.a,{stroke:"#ccc",strokeDasharray:"5 5"}),d.a.createElement(fe.f,{dataKey:"time"}),d.a.createElement(fe.g,{dataKey:"rssi",label:{value:"Cellular RSSI (dB)",position:"insideLeft",angle:-90}}),d.a.createElement(fe.e,null))):t=d.a.createElement(fe.c,{margin:{top:20,right:30,left:0,bottom:80}}),d.a.createElement(fe.d,{width:"100%",height:"100%"},t)}}]),t}(d.a.Component),ge=Object(x.connect)({connection_id:Object(k.state)(xe()),date:Object(k.state)(je()),hour:Object(k.state)(Oe()),selectedUnit:Object(k.state)(me()),measurement:Object(k.state)(ve()),oada:Object(k.state)(be()),data:Object(k.state)(he())},Object(f.withStyles)(function(e){return{}},{withTheme:!0})(ke));function ye(){var e=Object(h.a)(["diagnostics.mode"]);return ye=function(){return e},e}var we=function(e){function t(){return Object(b.a)(this,t),Object(m.a)(this,Object(O.a)(t).apply(this,arguments))}return Object(j.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){return"map"===this.props.mode?d.a.createElement(pe,null):d.a.createElement(ge,null)}}]),t}(d.a.Component),_e=Object(x.connect)({mode:Object(k.state)(ye())},we),Ee=n(188),Ie=n.n(Ee),Se=n(85),Ce=n.n(Se),De=n(73),Ue=n.n(De),Le=n(45),Me=n.n(Le),qe=n(187),Re=n.n(qe),Ne=n(44),Ve=n.n(Ne),Te=n(481),We=n.n(Te),Ge=n(482),Pe=n.n(Ge),Ae=n(284),Fe=n.n(Ae);function Je(){var e=Object(h.a)(["diagnostics.selectUnit"]);return Je=function(){return e},e}function Xe(){var e=Object(h.a)(["health"]);return Xe=function(){return e},e}var Ze=function(e){function t(){return Object(b.a)(this,t),Object(m.a)(this,Object(O.a)(t).apply(this,arguments))}return Object(j.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){var e,t=this,n=this.props.classes;return e=Object.keys(this.props.health||{}).length>0?d.a.createElement(Ue.a,{className:n.list,component:"nav"},Object.keys(this.props.health).map(function(e){return d.a.createElement(Me.a,{button:!0,key:"-".concat(e),onClick:function(){return t.props.selectUnit({unit:e})}},d.a.createElement(Ve.a,{primary:e}),d.a.createElement(Re.a,null,function(){switch(t.props.health[e]){case"Healthy":return d.a.createElement(We.a,{className:n.healthy});case"Sick":return d.a.createElement(Pe.a,{className:n.sick});case"Down":default:return d.a.createElement(Fe.a,null)}}()))})):d.a.createElement(Ue.a,{className:n.list,component:"nav"}),d.a.createElement(Ue.a,null,d.a.createElement(Me.a,null,d.a.createElement(Ve.a,{align:"center",primary:"My ISOBlues:"})),e,d.a.createElement(Ce.a,null))}}]),t}(d.a.Component),Be=Object(x.connect)({health:Object(k.state)(Xe()),selectUnit:Object(k.signal)(Je())},Object(f.withStyles)(function(e){return{list:{width:"90%",backgroundColor:e.palette.background.paper,overflow:"auto",height:300,margin:1.5*e.spacing.unit},textField:{margin:1.5*e.spacing.unit},healthy:{color:"#008000"},sick:{color:"#ffbf00"},down:{color:"#ff0000"}}})(Ze)),He=n(74),Ye=n.n(He),ze=n(97),Qe=n.n(ze),Ke=n(121),$e=n.n(Ke);function et(){var e=Object(h.a)(["diagnostics.toggleMode"]);return et=function(){return e},e}function tt(){var e=Object(h.a)(["diagnostics.setMeasurement"]);return tt=function(){return e},e}function nt(){var e=Object(h.a)(["diagnostics.setHour"]);return nt=function(){return e},e}function rt(){var e=Object(h.a)(["diagnostics.setDate"]);return rt=function(){return e},e}function at(){var e=Object(h.a)(["diagnostics.unselectUnit"]);return at=function(){return e},e}function ct(){var e=Object(h.a)(["diagnostics.selectUnit"]);return ct=function(){return e},e}function ut(){var e=Object(h.a)(["data.connection_id"]);return ut=function(){return e},e}function ot(){var e=Object(h.a)(["oada"]);return ot=function(){return e},e}function st(){var e=Object(h.a)(["diagnostics.mode"]);return st=function(){return e},e}function it(){var e=Object(h.a)(["data"]);return it=function(){return e},e}function lt(){var e=Object(h.a)(["snapshots"]);return lt=function(){return e},e}function dt(){var e=Object(h.a)(["diagnostics.selectedUnit"]);return dt=function(){return e},e}function pt(){var e=Object(h.a)(["diagnostics.measurement"]);return pt=function(){return e},e}function ft(){var e=Object(h.a)(["diagnostics.hour"]);return ft=function(){return e},e}function ht(){var e=Object(h.a)(["diagnostics.date"]);return ht=function(){return e},e}var bt=function(e){function t(){return Object(b.a)(this,t),Object(m.a)(this,Object(O.a)(t).apply(this,arguments))}return Object(j.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){var e,t=this,n=d.a.createElement(Me.a,null,d.a.createElement(Ve.a,{align:"center"},d.a.createElement(Ye.a,{onClick:function(){return t.props.toggleMode({})},variant:"contained"},"map"===this.props.mode?"Show Statistics":"Show Map")));e="map"===this.props.mode?["GPS"]:["Latency","Wifi RSSI","Cellular RSSI"];var r=d.a.createElement(Qe.a,{value:this.props.measurement,renderValue:function(e){return"".concat(e)},onChange:function(e){return t.props.setMeasurement({measurement:e.target.value})}},e.map(function(e){return d.a.createElement($e.a,{key:e,value:e},e)})),a=d.a.createElement(Qe.a,{value:this.props.date,renderValue:function(e){return"".concat(e)},onChange:function(e){return t.props.setDate({date:e.target.value})}},Object.keys(this.props.oada[this.props.connection_id].bookmarks.isoblue["device-index"][this.props.selectedUnit].location["day-index"]).map(function(e){return d.a.createElement($e.a,{key:e,value:e},e)}),";"),c=d.a.createElement(Qe.a,{value:this.props.hour,renderValue:function(e){return"".concat(e)},onChange:function(e){return t.props.setHour({hour:e.target.value})}},Object.keys(this.props.oada[this.props.connection_id].bookmarks.isoblue["device-index"][this.props.selectedUnit].location["day-index"][this.props.date]["hour-index"]).map(function(e){return d.a.createElement($e.a,{key:e,value:e},e)}),";");return d.a.createElement(Ue.a,null,d.a.createElement(Me.a,null,d.a.createElement(Ve.a,{align:"center",primary:"Selected Unit:"})),d.a.createElement(Me.a,null,d.a.createElement(Ve.a,{align:"center",primary:this.props.selectedUnit})),d.a.createElement(Ce.a,null),d.a.createElement(Me.a,null,d.a.createElement(Ve.a,{align:"center",primary:"ISOBlue Status:"})),d.a.createElement(Me.a,null,d.a.createElement(Ve.a,{align:"center",primary:"Health:"}),d.a.createElement(Ve.a,{align:"center",primary:this.props.snapshots[this.props.selectedUnit].health})),d.a.createElement(Me.a,null,d.a.createElement(Ve.a,{align:"center",primary:"Last Report:"}),d.a.createElement(Ve.a,{align:"center",primary:"NA"===this.props.snapshots[this.props.selectedUnit].lastReport?"NA":this.props.snapshots[this.props.selectedUnit].lastLocationReport+" min"})),d.a.createElement(Ce.a,null),d.a.createElement(Me.a,null,d.a.createElement(Ve.a,{align:"center",primary:"Available Data:"})),d.a.createElement(Me.a,null,d.a.createElement(Ve.a,{align:"center"},r)),d.a.createElement(Me.a,null,d.a.createElement(Ve.a,{align:"center"},a)),d.a.createElement(Me.a,null,d.a.createElement(Ve.a,{align:"center"},c)),n,d.a.createElement(Ce.a,null),d.a.createElement(Me.a,null,d.a.createElement(Ve.a,{align:"center"},d.a.createElement(Ye.a,{variant:"contained",onClick:function(){return t.props.unselectUnit({})}},"Back to Main"))))}}]),t}(d.a.Component),vt=Object(x.connect)({date:Object(k.state)(ht()),hour:Object(k.state)(ft()),measurement:Object(k.state)(pt()),selectedUnit:Object(k.state)(dt()),snapshots:Object(k.state)(lt()),data:Object(k.state)(it()),mode:Object(k.state)(st()),oada:Object(k.state)(ot()),connection_id:Object(k.state)(ut()),selectUnit:Object(k.signal)(ct()),unselectUnit:Object(k.signal)(at()),setDate:Object(k.signal)(rt()),setHour:Object(k.signal)(nt()),setMeasurement:Object(k.signal)(tt()),toggleMode:Object(k.signal)(et())},Object(f.withStyles)(function(e){return{}})(bt));function mt(){var e=Object(h.a)(["session.toggleDrawerOpen"]);return mt=function(){return e},e}function Ot(){var e=Object(h.a)(["session.drawerOpen"]);return Ot=function(){return e},e}function jt(){var e=Object(h.a)(["diagnostics.selectedUnit"]);return jt=function(){return e},e}var xt=function(e){function t(){return Object(b.a)(this,t),Object(m.a)(this,Object(O.a)(t).apply(this,arguments))}return Object(j.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){var e,t=this,n=this.props.classes;return e=this.props.selectedUnit?d.a.createElement(vt,null):d.a.createElement(Be,null),d.a.createElement(Ie.a,{open:this.props.drawerOpen,onClose:function(){return t.props.toggleDrawerOpen({})},classes:{paper:n.drawerPaper}},d.a.createElement("div",{className:n.toolbar}),e)}}]),t}(d.a.Component),kt=Object(x.connect)({selectedUnit:Object(k.state)(jt()),drawerOpen:Object(k.state)(Ot()),toggleDrawerOpen:Object(k.signal)(mt())},Object(f.withStyles)(function(e){return{drawerPaper:{position:"relative",width:240,backgroundColor:"#eeeeee"},toolbar:e.mixins.toolbar}})(xt)),gt=n(126),yt=n(189),wt=n.n(yt);function _t(){var e=Object(h.a)(["connection.updateOadaDomain"]);return _t=function(){return e},e}function Et(){var e=Object(h.a)(["connection.setConnection"]);return Et=function(){return e},e}function It(){var e=Object(h.a)(["connection.dialog_open"]);return It=function(){return e},e}function St(){var e=Object(h.a)(["connection.oada_domain_text"]);return St=function(){return e},e}var Ct=Object(x.connect)({oadaDomainText:Object(k.state)(St()),open:Object(k.state)(It()),submitClicked:Object(k.signal)(Et()),oadaDomainChanged:Object(k.signal)(_t())},function(e){function t(){return Object(b.a)(this,t),Object(m.a)(this,Object(O.a)(t).apply(this,arguments))}return Object(j.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){var e=this;return d.a.createElement(wt.a,{open:this.props.open,className:"connection-dialog"},d.a.createElement(gt.c,{id:"form-dialog-title"},"Connect to OADA Server"),d.a.createElement(gt.b,null,"Please enter the domain of OADA server."),d.a.createElement(gt.b,null,d.a.createElement(gt.d,{autoFocus:!0,label:"Domain",value:this.props.oadaDomainText,onChange:function(t){return e.props.oadaDomainChanged({value:t.target.value})},margin:"dense",fullwidth:"true"})),d.a.createElement(gt.a,null,d.a.createElement(Ye.a,{onClick:function(){e.props.open=!1},color:"secondary"},"Cancel"),d.a.createElement(Ye.a,{onClick:function(){e.props.submitClicked({})},color:"secondary"},"Submit")))}}]),t}(d.a.Component));function Dt(){var e=Object(h.a)(["init"]);return Dt=function(){return e},e}var Ut=function(e){function t(){return Object(b.a)(this,t),Object(m.a)(this,Object(O.a)(t).apply(this,arguments))}return Object(j.a)(t,e),Object(v.a)(t,[{key:"componentWillMount",value:function(){this.props.init({})}},{key:"render",value:function(){var e=this.props.classes;return d.a.createElement("div",{className:e.root},d.a.createElement(y.a,{position:"absolute",className:e.appBar},d.a.createElement(W,null)),d.a.createElement(kt,null),d.a.createElement("main",{className:e.content},d.a.createElement("div",{className:e.toolbar}),d.a.createElement(_e,null)),d.a.createElement(Ct,null))}}]),t}(d.a.Component),Lt=Object(x.connect)({init:Object(k.signal)(Dt())},Object(f.withStyles)(function(e){return{root:{flexGrow:1,height:"100vh",zIndex:1,overflow:"hidden",position:"relative",display:"flex"},appBar:{zIndex:e.zIndex.drawer+1},content:{flexGrow:1},toolbar:e.mixins.toolbar}},{withTheme:!0})(Ut)),Mt=n(12),qt=n(13);function Rt(){var e=Object(h.a)(["session.drawerOpen"]);return Rt=function(){return e},e}var Nt=Object(Mt.sequence)("toggleDrawerOpen",[Object(qt.toggle)(Object(k.state)(Rt()))]),Vt=Object(Mt.Module)({state:{drawerOpen:!1,dataReady:!1},signals:r});function Tt(){var e=Object(h.a)(["diagnostics.selectedUnit"]);return Tt=function(){return e},e}function Wt(){var e=Object(h.a)(["snapshots.",".location"]);return Wt=function(){return e},e}function Gt(){var e=Object(h.a)(["map.targetCenter"]);return Gt=function(){return e},e}function Pt(){var e=Object(h.a)(["map.targetCenter"]);return Pt=function(){return e},e}function At(){var e=Object(h.a)(["map.userLocation"]);return At=function(){return e},e}function Ft(){var e=Object(h.a)(["map.targetCenter"]);return Ft=function(){return e},e}function Jt(){var e=Object(h.a)(["map.targetCenter"]);return Jt=function(){return e},e}function Xt(){var e=Object(h.a)(["map.userLocationAvailable"]);return Xt=function(){return e},e}var Zt=Object(Mt.sequence)("storeUserLocation",[function(e){var t=e.state,n=e.props;return t.set("map.userLocation",{lat:n.lat,lng:n.lng})},Object(qt.set)(Object(k.state)(Xt()),!0)]),Bt=Object(Mt.sequence)("centerOnUser",[Object(qt.set)(Object(k.state)(Jt()),{lat:40.428641,lng:-86.913783}),Object(qt.debounce)(1),{continue:[Object(qt.set)(Object(k.state)(Ft()),Object(k.state)(At()))],discard:[]}]),Ht=Object(Mt.sequence)("centerOnUnit",[Object(qt.set)(Object(k.state)(Pt()),{lat:40.428641,lng:-86.913783}),Object(qt.debounce)(1),{continue:[Object(qt.set)(Object(k.state)(Gt()),Object(k.state)(Wt(),Object(k.state)(Tt())))],discard:[]}]),Yt=n(86),zt=n.n(Yt);function Qt(){var e=Object(h.a)(["data.ready"]);return Qt=function(){return e},e}function Kt(){var e=Object(h.a)(["connection_id"]);return Kt=function(){return e},e}function $t(){var e=Object(h.a)(["data.connection_id"]);return $t=function(){return e},e}function en(){var e=Object(h.a)(["health"]);return en=function(){return e},e}function tn(){var e=Object(h.a)(["data.ready"]);return tn=function(){return e},e}function nn(){var e=Object(h.a)(["data.ready"]);return nn=function(){return e},e}function rn(){var e=Object(h.a)(["data.ready"]);return rn=function(){return e},e}var an={bookmarks:{_type:"application/vnd.oada.bookmarks.1+json",_rev:"0-0",isoblue:{_type:"application/vnd.oada.isoblue.1+json",_rev:"0-0","device-index":{"*":{_type:"application/vnd.oada.isoblue.device.1+json",_rev:"0-0","*":{_type:"application/vnd.oada.isoblue.dataset.1+json",_rev:"0-0","day-index":{"*":{_type:"application/vnd.oada.isoblue.day.1+json",_rev:"0-0","hour-index":{"*":{_type:"application/vnd.oada.isoblue.hour.1+json"}}}}}}}}}},cn={bookmarks:{_type:"applications/vnd.oada.bookmarks.1+json",_rev:"0-0",isoblue:{_type:"applications/vnd.oada.isoblue.1+json",_rev:"0-0","device-index":{"*":{_type:"applications/vnd.oada.isoblue.device.1+json",_rev:"0-0","*":{_type:"application/vnd.oada.isoblue.dataset.1+json",_rev:"0-0","day-index":{"*":{_type:"applications/vnd.oada.isoblue.day.1+json",_rev:"0-0"}}}}}}}};function un(e){var t=e.state,n=e.props,r=Object.keys(t.get("oada.".concat(n.connection_id,".bookmarks.isoblue.device-index"))||{}),a=[];return r.forEach(function(e){var r=t.get("oada.".concat(n.connection_id,".bookmarks.isoblue.device-index.").concat(e,".location.day-index"))||{},c=Object.keys(r);if(0!==c.length){var u=J.a.maxBy(c,function(e){return new Date(e)}),o=J.a.max(Object.keys(r[u]["hour-index"]||{}));a.push({path:"/bookmarks/isoblue/device-index/".concat(e,"/location/day-index/").concat(u,"/hour-index/").concat(o),watch:{signals:["snapshots.createSnapshots"]},tree:an})}}),{requests:a}}var on=Object(Mt.sequence)("data.handleDeviceUpdate",[Object(qt.set)(Object(k.state)(rn()),!1),un,zt.a.get,Object(qt.set)(Object(k.state)(nn()),!0)]),sn=Object(Mt.sequence)("data.getDevices",[function(e){e.state,e.props;return{requests:[{path:"/bookmarks/isoblue",tree:cn,watch:{signals:["data.handleDeviceUpdate"]}}]}},zt.a.get]),ln=Object(Mt.sequence)("data.init",[Object(qt.set)(Object(k.state)(tn()),!1),Object(qt.set)(Object(k.state)(en()),{}),Object(qt.set)(Object(k.state)($t()),Object(k.props)(Kt())),sn,un,zt.a.get,Object(qt.set)(Object(k.state)(Qt()),!0)]),dn=Object(Mt.sequence)("data.getHour",[function(e){var t=e.state;e.props;return{requests:[{connection_id:t.get("data.connection_id"),path:"/bookmarks/isoblue/device-index/".concat(t.get("diagnostics.selectedUnit"),"/location/day-index/").concat(t.get("diagnostics.date"),"/hour-index/").concat(t.get("diagnostics.hour")),tree:an}]}},zt.a.get]);function pn(){var e=Object(h.a)(["diagnostics.measurement"]);return pn=function(){return e},e}function fn(){var e=Object(h.a)(["diagnostics.mode"]);return fn=function(){return e},e}function hn(){var e=Object(h.a)(["diagnostics.measurement"]);return hn=function(){return e},e}function bn(){var e=Object(h.a)(["diagnostics.mode"]);return bn=function(){return e},e}function vn(){var e=Object(h.a)(["diagnostics.mode"]);return vn=function(){return e},e}function mn(){var e=Object(h.a)(["diagnostics.hour"]);return mn=function(){return e},e}function On(){var e=Object(h.a)(["diagnostics.date"]);return On=function(){return e},e}function jn(){var e=Object(h.a)(["diagnostics.selectedUnit"]);return jn=function(){return e},e}function xn(){var e=Object(h.a)(["unit"]);return xn=function(){return e},e}function kn(){var e=Object(h.a)(["diagnostics.selectedUnit"]);return kn=function(){return e},e}function gn(){var e=Object(h.a)(["hour"]);return gn=function(){return e},e}function yn(){var e=Object(h.a)(["diagnostics.hour"]);return yn=function(){return e},e}function wn(){var e=Object(h.a)(["date"]);return wn=function(){return e},e}function _n(){var e=Object(h.a)(["diagnostics.date"]);return _n=function(){return e},e}var En=Object(Mt.sequence)("setDate",[Object(qt.set)(Object(k.state)(_n()),Object(k.props)(wn())),function(e){var t=e.state;e.props;return t.set("diagnostics.hour",J.a.max(Object.keys(t.get("oada.".concat(t.get("data.connection_id"),".bookmarks.isoblue.device-index.").concat(t.get("diagnostics.selectedUnit"),".location.day-index.").concat(t.get("diagnostics.date"),".hour-index")))))},dn,Ht]),In=Object(Mt.sequence)("setHour",[Object(qt.set)(Object(k.state)(yn()),Object(k.props)(gn())),dn,Ht]),Sn=Object(Mt.sequence)("setMeasurement",[function(e){var t=e.state,n=e.props;return t.set("diagnostics.measurement",n.measurement)}]),Cn=Object(Mt.sequence)("selectUnit",[function(e){var t=e.state;e.props;return{connection_id:t.get("data.connection_id")}},Object(qt.set)(Object(k.state)(kn()),Object(k.props)(xn())),function(e){var t=e.state,n=e.props,r=Object.keys(t.get("oada.".concat(n.connection_id,".bookmarks.isoblue.device-index.").concat(n.unit,".location.day-index"))).sort(function(e,t){return new Date(t)-new Date(e)})[0],a=J.a.max(Object.keys(t.get("oada.".concat(n.connection_id,".bookmarks.isoblue.device-index.").concat(n.unit,".location.day-index.").concat(r,".hour-index"))));t.set("diagnostics.date",r),t.set("diagnostics.hour",a)},Ht]),Dn=Object(Mt.sequence)("unselectUnit",[Object(qt.set)(Object(k.state)(jn()),null),Object(qt.set)(Object(k.state)(On()),null),Object(qt.set)(Object(k.state)(mn()),null)]),Un=Object(Mt.sequence)("toggleMode",[Object(qt.when)(Object(k.state)(vn()),function(e){return"map"===e}),{true:[Object(qt.set)(Object(k.state)(bn()),"graph"),Object(qt.set)(Object(k.state)(hn()),"Latency")],false:[Object(qt.set)(Object(k.state)(fn()),"map"),Object(qt.set)(Object(k.state)(pn()),"GPS")]}]),Ln=Object(Mt.Module)({state:{hour:null,measurement:"GPS",selectedUnit:null,date:null,mode:"map"},signals:u}),Mn=Object(Mt.Module)({state:{targetCenter:{lat:40.428641,lng:-86.913783},userLocation:{lat:40.428641,lng:-86.913783},userLocationAvailable:!1},signals:a}),qn=Object(Mt.Module)({signals:c});function Rn(){var e=Object(h.a)(["units"]);return Rn=function(){return e},e}function Nn(){var e=Object(h.a)(["snapshots"]);return Nn=function(){return e},e}var Vn=Object(Mt.sequence)("createSnapshots",[function(e){var t=e.state,n=e.props;return{units:J.a.reduce(Object.keys(t.get("oada.".concat(n.connection_id,".bookmarks.isoblue.device-index"))||{}),function(e,r,a){var c=t.get("oada.".concat(n.connection_id,".bookmarks.isoblue.device-index.").concat(r,".location.day-index")),u=J.a.maxBy(Object.keys(c||{}),function(e){return new Date(e)});if(!u)return e;if(!c[u].hasOwnProperty("hour-index"))return e;var o=J.a.max(Object.keys(c[u]["hour-index"]||{}));if(!o)return e;var s=J.a.max(Object.keys(c[u]["hour-index"][o]["sec-index"]||{}))||null,i=s?c[u]["hour-index"][o]["sec-index"][s]:null;if(i){var l=Math.round((Math.round((new Date).getTime()/1e3)-s)/60),d=null;d=l<2?"Healthy":l<10?"Sick":"Down";var p=null;i.hasOwnProperty("lat")&&i.hasOwnProperty("lng")&&(p=i);e[r]={health:d,connection:null,location:p,lastLocationReport:l,lastHeartbeatTime:l},t.set("health.".concat(r),d)}else e[r]={health:"Down",connection:null,location:null,lastReport:"NA",lastHeartbeatTime:60},t.set("health.".concat(r),"Down");return e},{})}},Object(qt.set)(Object(k.state)(Nn()),Object(k.props)(Rn()))]),Tn=Object(Mt.Module)({state:{},signals:o}),Wn=n(150),Gn=n.n(Wn);function Pn(){var e=Object(h.a)(["connection.oada_domain_text"]);return Pn=function(){return e},e}function An(){var e=Object(h.a)(["connection.oada_domain"]);return An=function(){return e},e}function Fn(){var e=Object(h.a)(["connection.dialog_open"]);return Fn=function(){return e},e}function Jn(){var e=Object(h.a)(["connection_id"]);return Jn=function(){return e},e}function Xn(){var e=Object(h.a)(["connection.connection_id"]);return Xn=function(){return e},e}function Zn(){var e=Object(h.a)(["connection_id"]);return Zn=function(){return e},e}function Bn(){var e=Object(h.a)(["data.connection_id"]);return Bn=function(){return e},e}function Hn(){var e=Object(h.a)(["value"]);return Hn=function(){return e},e}function Yn(){var e=Object(h.a)(["connection.oada_domain_text"]);return Yn=function(){return e},e}function zn(){var e=Object(h.a)(["Connections.oada_fields_domain_text"]);return zn=function(){return e},e}function Qn(){var e=Object(h.a)(["Connections.oada_domain_text"]);return Qn=function(){return e},e}function Kn(){var e=Object(h.a)(["Connections.oada_fields_domain"]);return Kn=function(){return e},e}function $n(){var e=Object(h.a)(["Connections.oada_domain"]);return $n=function(){return e},e}function er(){var e=Object(h.a)(["Connections.oada_token"]);return er=function(){return e},e}var tr=[Object(qt.set)(Object(k.state)(er()),""),Object(qt.set)(Object(k.state)($n()),""),Object(qt.set)(Object(k.state)(Kn()),""),Object(qt.set)(Object(k.state)(Qn()),""),Object(qt.set)(Object(k.state)(zn()),"")],nr=[Object(qt.set)(Object(k.state)(Yn()),Object(k.props)(Hn()))],rr=[function(e){return{domain:e.state.get("connection.oada_domain"),options:{redirect:"https://openatk.com/ISOBlueApp/oauth2/redirect.html",metadata:"eyJqa3UiOiJodHRwczovL2lkZW50aXR5Lm9hZGEtZGV2LmNvbS9jZXJ0cyIsImtpZCI6ImtqY1NjamMzMmR3SlhYTEpEczNyMTI0c2ExIiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJyZWRpcmVjdF91cmlzIjpbImh0dHBzOi8vb3BlbmF0ay5jb20vSVNPQmx1ZUFwcC9vYXV0aDIvcmVkaXJlY3QuaHRtbCIsImh0dHA6Ly9sb2NhbGhvc3Q6ODAwMC9vYXV0aDIvcmVkaXJlY3QuaHRtbCJdLCJ0b2tlbl9lbmRwb2ludF9hdXRoX21ldGhvZCI6InVybjppZXRmOnBhcmFtczpvYXV0aDpjbGllbnQtYXNzZXJ0aW9uLXR5cGU6and0LWJlYXJlciIsImdyYW50X3R5cGVzIjpbImF1dGhvcml6YXRpb25fY29kZSJdLCJyZXNwb25zZV90eXBlcyI6WyJ0b2tlbiIsImNvZGUiLCJpZF90b2tlbiIsImlkX3Rva2VuIHRva2VuIiwiY29kZSBpZF90b2tlbiIsImNvZGUgdG9rZW4iLCJjb2RlIGlkX3Rva2VuIHRva2VuIl0sImNsaWVudF9uYW1lIjoiSVNPQmx1ZSBIZWFsdGggTW9uaXRvciIsImNsaWVudF91cmkiOiJodHRwOi8vb2FkYS5vcGVuYXRrLmNvbS9JU09CbHVlQXBwIiwiY29udGFjdHMiOlsiU2FtIE5vZWwgPHNhbm9lbEBwdXJkdWUuZWR1PiJdLCJqd2tzIjp7ImtleXMiOlt7Imt0eSI6IlJTQSIsIm4iOiJ6YXVaRkJ1TWRsdjFrWWp6VWI0cS1fM200c21GeG5mdzRTWW9hSHE3Y2k4U2N0WTN4ajdyZEFIeWtRcG5RVnJqNktPOG1hSHYtMEJ2VzVNaGNnaXZrdVlzLXpIRXZmWUJlVkJuY3ZIZ09rSlBiYzkxQ3dfaXdPWTdFSFdCOGhNN1ZpTFFWY19EdjBoOG5KeWJCdmhMMDRDSFF0N0NwTXRWWUc2Zm9KWGMzZHE1MmpOUWJCSElaNW03VnoxS3R5em9MY3A4TzJtaGFMcDQ1VXIzQ18xZUd0djhuNU56OWJXX0JoNVhGWWJEeHY3Qm5oWk5JdzFHQ2JqakF3bXRibm5MN0dnZjRDeTYwd1JIbVI0dm9lMjFPSWpvQVNxMmpaMDN4MTJtWHM3SFBJM1lCNHkyOXd2Wk13MmdMek9kVG9ycnFPLXRsbW4xYm9Qa1dLSkpTWG9BdnciLCJlIjoiQVFBQiJ9XX0sInNvZnR3YXJlX2lkIjoiNzY1ZjFlZjctMzExNy00NjhhLTgwYjMtMDExYzQ1MjhkMGExIiwicmVnaXN0cmF0aW9uX3Byb3ZpZGVyIjoiaHR0cHM6Ly9pZGVudGl0eS5vYWRhLWRldi5jb20iLCJpYXQiOjE1NDcxNDYxOTF9.seH7eMsR1218IgEEbiq3T5ASGQAr7vqvy54_Yu8-6TIoAoVfslG-dSYWE2dXZ_P65kElqCKZLizVxyR1732vcFnOdzp6jE_pgpLg-eWZfVnIvNQdGK8Dh-5t1gVbPs1ME-j_GMCb2Un-mpDS8LAw4Nig_r-monjKyKbcPBN6gc4",scope:"oada.isoblue:all"}}},zt.a.connect,Object(qt.set)(Object(k.state)(Bn()),Object(k.props)(Zn())),Object(qt.set)(Object(k.state)(Xn()),Object(k.props)(Jn())),Object(qt.set)(Object(k.state)(Fn()),!1)],ar=[Object(qt.set)(Object(k.state)(An()),Object(k.state)(Pn())),rr,ln,Vn];var cr=Object(Mt.Module)({state:{dialog_open:!0,oada_domain_text:"https://oada.openatk.com",oada_domain:"https://oada.openatk.com"},signals:s,providers:{oada:Gn.a}}),ur=n(483),or=n.n(ur),sr=Object(Mt.sequence)("init",[]),ir=Object(Mt.Module)({modules:{connection:cr,session:Vt,oada:or.a,diagnostics:Ln,map:Mn,data:qn,snapshots:Tn},signals:i,providers:{oada:Gn.a}}),lr=(n(1173),Object(Mt.Controller)(ir,{devtools:null})),dr=Object(f.createMuiTheme)({typography:{useNextVariants:!0}});Object(p.render)(d.a.createElement(x.Container,{controller:lr},d.a.createElement(f.MuiThemeProvider,{theme:dr},d.a.createElement(Lt,null))),document.getElementById("root"))},577:function(e,t,n){e.exports=n(1172)},667:function(e,t,n){},901:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(248)),a=l(n(365)),c=l(n(370)),u=l(n(260)),o=l(n(943)),s=l(n(977)),i=l(n(264));function l(e){return e&&e.__esModule?e:{default:e}}var d=n(180),p=(n(389),n(90)),f=n(390),h=n(979),b=n(999),v=n(1018),m=function(){var e=(0,u.default)(r.default.mark(function e(t){var n,l,m,O,j,x,k,g,y,w,_,E,I,S,C,D,U,L=function(){var e=(0,u.default)(r.default.mark(function e(t,n){var a,c,u,o,l,p,f,h,b=t.path,v=t.data,O=t.headers;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return v._id=i.default.clone(v._id)||"resources/"+(0,s.default)(),a={path:b,type:v._type,headers:O,data:{_id:v._id}},"_rev"in v&&(a.data._rev=0),c={path:"/"+v._id,type:v._type,data:v},e.prev=4,e.next=7,G(a);case 7:u=e.sent,e.next=50;break;case 10:if(e.prev=10,e.t0=e.catch(4),!e.t0.response||412!==e.t0.response.status){e.next=49;break}if(o=b.split("/"),l=o.splice(0,o.length-1).join("/"),!(n>16e3)){e.next=17;break}throw e.t0;case 17:return e.prev=17,e.next=20,m({method:"get",url:k+l,headers:{Authorization:"Bearer "+j}});case 20:p=e.sent,e.next=29;break;case 23:return e.prev=23,e.t1=e.catch(17),n=n||1e3,e.next=28,d.delay(n);case 28:return e.abrupt("return",L({path:b,data:v,headers:O},2*n));case 29:if(!p.data[o[o.length-1]]){e.next=41;break}if(c.data._id=p.data[o[o.length-1]]._id,c.path="/"+c.data._id,c.data._id){e.next=39;break}return n=n||1e3,e.next=36,d.delay(n);case 36:return(f=i.default.cloneDeep(O))["if-match"]=parseInt(p.headers["x-oada-rev"]),e.abrupt("return",L({path:b,data:v,headers:f},2*n));case 39:e.next=47;break;case 41:return n=n||1e3,e.next=44,d.delay(n);case 44:return(f=i.default.cloneDeep(O))["if-match"]=parseInt(p.headers["x-oada-rev"]),e.abrupt("return",L({path:b,data:v,headers:f},2*n));case 47:e.next=50;break;case 49:throw e.t0;case 50:return"_rev"in v&&delete c.data._rev,e.next=53,G(c);case 53:return h=e.sent,e.abrupt("return",{link:u,resource:h});case 55:case"end":return e.stop()}},e,this,[[4,10],[17,23]])}));return function(t,n){return e.apply(this,arguments)}}(),M=function(){var e=(0,u.default)(r.default.mark(function e(t){var n,c=t.method,u=t.url,o=t.path,s=t.headers,i=t.data,l=t.type;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o||u){e.next=2;break}throw new Error("Either path or url must be specified.");case 2:if(!u){e.next=9;break}if(!/^\//.test(u)){e.next=7;break}u=J+u,e.next=9;break;case 7:if(0===u.indexOf(J)){e.next=9;break}throw new Error("'url' key must begin with the domain used to connect");case 9:return c=c.toLowerCase(),/\/$/.test((n={method:c,url:u||k+o,headers:{authorization:"Bearer "+j}}).url)&&(n.url=n.url.slice(0,n.url.length-1)),(0,a.default)(s||{}).forEach(function(e){n.headers[e.toLowerCase()]=s[e]}),"put"!==c&&"post"!==c||(n.headers["content-type"]=n.headers["content-type"]||l||i._type,n.data=i),"delete"===c&&(n.headers["content-type"]=n.headers["content-type"]||l),e.abrupt("return",n);case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),q=function(){var e=(0,u.default)(r.default.mark(function e(t){return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",l(t));case 4:if(e.prev=4,e.t0=e.catch(0),!e.t0||401!==e.t0.response.status){e.next=10;break}return e.next=9,F();case 9:return e.abrupt("return",l(t));case 10:throw e.t0;case 11:case"end":return e.stop()}},e,this,[[0,4]])}));return function(t){return e.apply(this,arguments)}}(),R=function(){var e=(0,u.default)(r.default.mark(function e(t){var n,a,c,u,o,s,i,l=t.url,d=t.path,h=t.headers,b=t.watch,v=t.tree;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M({method:"get",url:l,path:d,headers:h});case 2:return n=e.sent,a=void 0,e.next=6,q(n);case 6:if(c=e.sent,!b){e.next=15;break}return d=d||p.parse(l).path,n.headers["x-oada-rev"]=c.data._rev,console.log("SENDING THIS REEVVVVVVVVVVVVVVV",c.data._rev),e.next=13,_({headers:n.headers,path:d,func:b.function,payload:b.payload});case 13:a=e.sent,console.log("WATCH RESPONSE",a);case 15:if(!v){e.next=45;break}if(console.log("IS TREE"),u=p.parse(n.url).path.replace(/^\//,"").split("/"),o=I(u,v),console.log(v,o),f.has(v,o)){e.next=22;break}throw new Error("The path does not exist on the given tree.");case 22:if(s=f.get(v,o),e.prev=23,!b||!a.resource){e.next=31;break}return console.log("tree getting",b,a.resource),e.next=28,N(n.url,s,a.resource,!0);case 28:i=e.sent,e.next=34;break;case 31:return e.next=33,N(n.url,s,{},!0);case 33:i=e.sent;case 34:c.data=i.data,c.cached=i.cached,e.next=45;break;case 38:if(e.prev=38,e.t0=e.catch(23),console.log("ERA",e.t0),!e.t0.response||404!==e.t0.response.status){e.next=44;break}e.next=45;break;case 44:throw e.t0;case 45:return e.abrupt("return",c);case 46:case"end":return e.stop()}},e,this,[[23,38]])}));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=(0,u.default)(r.default.mark(function e(t,n,o,s){var i;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n._type){e.next=6;break}return e.next=3,R({url:t,headers:"_rev"in o?{"x-oada-rev":o._rev}:{}});case 3:i=e.sent,o=i.data,s=!!i.cached&&i.cached;case 6:return e.abrupt("return",d.map((0,a.default)(o||{}),function(){var e=(0,u.default)(r.default.mark(function e(a){var u;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("object"!==(0,c.default)(o[a])){e.next=20;break}if(!n[a]){e.next=9;break}return e.next=4,N(t+"/"+a,n[a],o[a],s);case 4:return u=e.sent,s=u.cached,e.abrupt("return",o[a]=u.data);case 9:if(!n["*"]){e.next=17;break}return e.next=12,N(t+"/"+a,n["*"],o[a],s);case 12:return u=e.sent,s=u.cached,e.abrupt("return",o[a]=u.data);case 17:return e.abrupt("return");case 18:e.next=21;break;case 20:return e.abrupt("return");case 21:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()).then(function(){return{data:o,cached:s}}));case 7:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),V=function(){var e=(0,u.default)(r.default.mark(function e(t){var n,a,c,o,s,l,h,b=t.url,v=t.tree,m=t.data;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=p.parse(b).path.replace(/^\//,""),a=n.replace(/\/$/,"").split("/"),m._id&&(c=I(a,v),f.set(v,c+"/_id",m._id)),o={},s=[],e.next=7,E(a,v,o);case 7:return l=e.sent,h=l._rev,e.next=11,d.mapSeries(a.slice(0,a.length-l.stored),function(){var e=(0,u.default)(r.default.mark(function e(t,n){var c,u,d,p,b;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c=l.stored+1+n,u="/"+a.slice(0,c+1).join("/"),d=I(a.slice(0,c+1),v),!(f.has(v,d+"/_type")&&c<=l.setup)){e.next=14;break}return e.next=6,w(f.get(v,d));case 6:return p=e.sent,e.next=9,L({path:u,data:i.default.cloneDeep(p),headers:{"if-match":h}});case 9:b=e.sent,h=b.resource.headers["x-oada-rev"],f.set(o,u,p),b.path=u,s.push(b);case 14:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}());case 11:return e.abrupt("return",s);case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),T=function(){var e=(0,u.default)(r.default.mark(function e(t,o,s){var i;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!o._type){e.next=13;break}return e.prev=1,e.next=4,R({url:t});case 4:i=e.sent,s=i.data,e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(1),404!==e.t0.status){e.next=13;break}return s={},e.abrupt("return");case 13:return e.abrupt("return",d.map((0,a.default)(s||{}),function(){var e=(0,u.default)(r.default.mark(function e(n){var a;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("object"!==(0,c.default)(s[n])){e.next=18;break}if(!o[n]){e.next=8;break}return e.next=4,T(t+"/"+n,o[n],s[n]);case 4:return a=e.sent,e.abrupt("return",s[n]=a.data);case 8:if(!o["*"]){e.next=15;break}return e.next=11,T(t+"/"+n,o["*"],s[n]);case 11:return a=e.sent,e.abrupt("return",s[n]=a.data);case 15:return e.abrupt("return");case 16:e.next=19;break;case 18:return e.abrupt("return");case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()).then((0,u.default)(r.default.mark(function e(){var a;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!o._type){e.next=23;break}if(e.prev=1,!s._id){e.next=11;break}return e.prev=3,e.next=6,W({path:"/"+s._id,headers:{"content-type":o._type}});case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(3),console.log("aaaaaaaa","/"+s._id,t,e.t0);case 11:return e.next=13,W({url:t,headers:{"content-type":o._type}});case 13:a=e.sent,e.next=21;break;case 16:if(e.prev=16,e.t1=e.catch(1),!e.t1.response||404!==e.t1.response.status){e.next=21;break}return s={},e.abrupt("return",{link:a||{},data:s||{}});case 21:e.next=26;break;case 23:if(!n){e.next=26;break}return e.next=26,n.removeLookup({url:t});case 26:return e.abrupt("return",{link:a||{},data:s||{}});case 27:case"end":return e.stop()}},e,this,[[1,16],[3,8]])}))));case 14:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,n,r){return e.apply(this,arguments)}}(),W=function(){var e=(0,u.default)(r.default.mark(function e(t){var n,a,c,u,o,s=t.url,i=t.path,l=t.type,d=t.headers,h=t.tree,b=t.unwatch;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M({method:"delete",url:s,path:i,type:l,headers:d});case 2:if(n=e.sent,!b){e.next=6;break}return i=i||p.parse(s).path,e.abrupt("return",O.unwatch({path:i,headers:n.headers}));case 6:if(!h){e.next=16;break}if(a=p.parse(n.url).path.replace(/^\//,"").split("/"),c=I(a,h),f.has(h,c)){e.next=11;break}throw new Error("The path does not exist on the given tree.");case 11:return u=f.get(h,c),e.next=14,T(n.url,u,{},!0);case 14:return o=e.sent,e.abrupt("return",o.link);case 16:if(n.headers["content-type"]){e.next=18;break}throw new Error("content-type header must be specified.");case 18:return e.abrupt("return",q(n));case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),G=function(){var e=(0,u.default)(r.default.mark(function e(t){var n,a,c,u,o=t.url,s=t.path,l=t.data,d=t.type,h=t.headers,b=t.tree;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M({method:"put",url:o,path:s,data:l,type:d,headers:h});case 2:if(n=e.sent,!b){e.next=10;break}return e.next=6,V({url:n.url,tree:i.default.cloneDeep(b),data:l});case 6:a=e.sent,c=a.length>0?a[a.length-1].path.replace(/^\//,"").split("/"):p.parse(n.url).path.replace(/^\//,"").split("/"),u=I(c,b)+"/_type",!n.headers["content-type"]&&f.has(b,u)&&(n.headers["content-type"]=i.default.clone(f.get(b,u)));case 10:if(n.headers["content-type"]){e.next=12;break}throw new Error("content-type header must be specified.");case 12:return e.abrupt("return",q(n).then(function(e){return e}));case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=(0,u.default)(r.default.mark(function e(t,a){return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,n.resetCache();case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),A=function(){var e=(0,u.default)(r.default.mark(function e(){return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=3;break}return e.next=3,n.db.close();case 3:O&&O.close(),x.cleanUp();case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),F=function(){var e=(0,u.default)(r.default.mark(function e(){return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.renew();case 2:j=e.sent;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),J=t.domain,X=t.options,Z=t.cache,B=t.token,H=t.websocket;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(U=function(){return n?n._getMemoryCache():{}},C=function(e){var t=e.url,n=e.path,r=e.data,a=e.type,c=e.headers,u=e.tree;return t="/"===(t=t||k+n)[t.length-1]?t+(0,s.default)():t+"/"+(0,s.default)(),G({url:t,data:r,type:a,headers:c,tree:u})},S=function(e){var t=e.name,r=e.req,a=e.expires,c=(0,o.default)({name:t,req:r,expires:a});l=c.api,n=c},I=function(e,t){var n=i.default.clone(e);return"/"+(n=e.map(function(e,r){return f.has(t,"/"+n.slice(0,r).join("/")+"/*")?(n[r]="*","*"):e})).join("/")},E=function(e,t,n){var r,a=0,c=void 0;return d.mapSeries(e,function(u,o){var s=e.length-1-o,l="/"+e.slice(0,s+1).join("/"),d=I(e.slice(0,s+1),t);if(f.has(t,d+"/_type")){if(c=c||s,f.has(n,l))throw a=i.default.clone(s),new Error("stored");return R({path:l}).then(function(e){throw f.set(n,l,{}),a=i.default.clone(s),r=e.headers["x-oada-rev"],new Error("stored")}).catch(function(e){if(/^stored/.test(e.message))throw e})}}).catch(function(e){if(/^stored/.test(e.message))return{stored:a,setup:c}}).then(function(){return{stored:a,setup:c||0,_rev:r}})},_=function(e){var t=e.headers,a=e.path,c=e.func,o=e.payload;return O?O.watch({path:a,headers:t},function(){var e=(0,u.default)(r.default.mark(function e(u){var s;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((s=i.default.cloneDeep(o)||{}).response=u,s.request={url:k+a,headers:t,method:u.change.type},e.prev=3,!n){e.next=8;break}return e.next=7,n.handleWatchChange(s);case 7:s=e.sent;case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.log(e.t0);case 13:if(!c){e.next=16;break}return e.next=16,c(s);case 16:return e.abrupt("return");case 17:case"end":return e.stop()}},e,this,[[3,10]])}));return function(t){return e.apply(this,arguments)}}()):void 0},w=function e(t){var n=Array.isArray(t)?[]:{};return t?d.map((0,a.default)(t||{}),function(r){if("*"!==r){var a=t[r];if("object"===("undefined"===typeof a?"undefined":(0,c.default)(a))&&a){if(!a._type)return a._id?(n[r]={_id:a._id},void("_rev"in a&&(n[r]._rev=a._rev))):e(a).then(function(e){n[r]=e})}else n[r]=a}}).then(function(){return n}):t},J){e.next=9;break}throw new Error("domain undefined");case 9:if("string"===typeof J){e.next=11;break}throw new Error("domain must be a string");case 11:if(X||B){e.next=13;break}throw new Error("options and token undefined");case 13:if(!B||"string"===typeof B){e.next=15;break}throw new Error("token must be a string");case 15:if(void 0===Z||"boolean"===typeof Z||"object"===("undefined"===typeof Z?"undefined":(0,c.default)(Z))){e.next=17;break}throw new Error("cache must be either a boolean or an object with 'name' and/or 'expires' keys");case 17:if(!Z||!Z.name||"string"===typeof Z.name){e.next=19;break}throw new Error("cache name must be a string");case 19:if("undefined"===typeof H||"boolean"===typeof H){e.next=21;break}throw new Error("websocket must be boolean");case 21:if(l=b,m=b,x=new v({domain:J,token:B,options:X}),J){e.next=26;break}throw new Error("domain undefined");case 26:return k=J,g=Z&&Z.name?Z.name:p.parse(J).hostname.replace(/\./g,"_"),y=Z&&Z.expires?Z.expires:void 0,e.next=31,x.get();case 31:if(j=e.sent,!1===H){e.next=41;break}return e.next=35,h(J);case 35:return D=e.sent,m=D.http,l=D.http,e.next=40,D;case 40:O=e.sent;case 41:if(!1===Z){e.next=44;break}return e.next=44,S({name:g||(0,s.default)(),req:l,expires:y});case 44:return e.abrupt("return",{token:j,cache:n||!1,websocket:O||!1,get:R,put:G,post:C,delete:W,resetCache:P,disconnect:A,reconnect:F,_getMemoryCache:U});case 45:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}();t.default={connect:m}},943:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(382)),a=i(n(370)),c=i(n(365)),u=i(n(248)),o=i(n(260));t.default=function(e){var t,n=function(){var e=(0,o.default)(u.default.mark(function e(t,n){var r,a,c,o,s,i,l,d,b;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=p.parse(t.url),a=r.path.split("/"),c=a.slice(1,3).join("/"),o=a.length>3?"/"+a.slice(3,a.length).join("/"):"",s={_id:c,valid:void 0===t.valid||t.valid,accessed:Date.now(),doc:{}},i=m[c],l={doc:{}},i){e.next=23;break}return e.prev=8,e.next=11,L.get(c);case 11:l=e.sent,e.next=21;break;case 14:if(e.prev=14,e.t0=e.catch(8),!t.method||"delete"!==t.method.toLowerCase()){e.next=20;break}return e.abrupt("return");case 20:o&&(s.INCOMPLETE_RESOURCE=!0);case 21:e.next=25;break;case 23:void 0!==(l=i.data)._rev&&(s._rev=l._rev);case 25:if(!t.method||"delete"!==t.method.toLowerCase()){e.next=35;break}if(o){e.next=32;break}return m[c]&&m[c].promise&&m[c].promise.cancel(),delete m[c],e.abrupt("return",L.remove(l).then(function(e){return{response:e}}).catch(function(e){if(404!==e.status)throw e}));case 32:h.has(l.doc,o)&&(s.doc=l.doc,h.remove(s.doc,o));case 33:e.next=36;break;case 35:o?(d=h.has(l.doc,o)?h.get(l.doc,o):{},b=f.merge(d,t.data||{}),h.set(l.doc,o,b),s.doc=l.doc):s.doc=f.merge(l.doc,t.data);case 36:return void 0!=t._rev&&(s.doc._rev=t._rev),e.abrupt("return",R(c,s,n,t));case 38:case"end":return e.stop()}},e,this,[[8,14]])}));return function(t,n){return e.apply(this,arguments)}}(),i=function(){var e=(0,o.default)(u.default.mark(function e(t){var r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M({method:"GET",url:t.url,headers:t.headers});case 2:return(r=e.sent).cached=!1,t.data=r.data,e.prev=5,e.next=8,n(t);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(5),console.log("getResFromServerError",e.t0);case 13:return e.abrupt("return",r);case 14:case"end":return e.stop()}},e,this,[[5,10]])}));return function(t){return e.apply(this,arguments)}}(),k=function(){var e=(0,o.default)(u.default.mark(function e(t){var n,r,a,c,o,s,l,d,f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments[2];return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=p.parse(t.url),r=n.path.split("/"),a=r.slice(1,3).join("/"),c=r.length>3?"/"+r.slice(3,r.length).join("/"):"",o=void 0,void 0,(s=m[a])&&(o=s.data.doc),o){e.next=19;break}return e.prev=9,e.next=12,L.get(a);case 12:l=e.sent,o=l.doc,e.next=19;break;case 16:e.prev=16,e.t0=e.catch(9),console.log("getResFromDbErr",e.t0);case 19:if(o||f){e.next=23;break}return e.abrupt("return",i(t));case 23:if(o||!f){e.next=25;break}throw"Offline and resource not found in local db.";case 25:if(!(o.accessed+q<=Date.now()||"false"===!o.valid)){e.next=30;break}if(!f){e.next=29;break}e.next=30;break;case 29:return e.abrupt("return",i(t));case 30:if(!(t.headers&&t.headers["x-oada-rev"]&&parseInt(t.headers["x-oada-rev"])-parseInt(o._rev)>=b)){e.next=32;break}return e.abrupt("return",i(t));case 32:if(!h.has(o,c)){e.next=37;break}return d=h.get(o,c),e.abrupt("return",{data:d,headers:{"x-oada-rev":o._rev,"content-location":a+c},status:200,cached:!0});case 37:return e.abrupt("return",i(t));case 38:case"end":return e.stop()}},e,this,[[9,16]])}));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=(0,o.default)(u.default.mark(function e(t,n){var r,a,c;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=p.parse(t.url),a=f.cloneDeep(t),/^\/resources/.test(r.path)&&/^\/users/.test(r.path)){e.next=7;break}return e.next=5,V(t);case 5:c=e.sent,a.url=r.protocol+"//"+r.host+"/"+c.resourceId+c.pathLeftover;case 7:return e.abrupt("return",k(a,b,n||v).then(function(e){return e}));case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),y=function(){var e=(0,o.default)(u.default.mark(function e(t){var r,a,c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=p.parse(t.url),!c){e.next=7;break}return e.next=4,V({url:r.protocol+"//"+r.host+reqPieces.slice(0,reqPieces.length-1).join("/"),headers:t.headers});case 4:e.sent,e.next=13;break;case 7:return e.next=9,M(t);case 9:return a=e.sent,e.next=12,n({url:a.headers["content-location"],data:t.data,_rev:parseInt(a.headers["x-oada-rev"]),valid:!1});case 12:return e.abrupt("return",a);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),w=function(){var e=(0,o.default)(u.default.mark(function e(t){var r,a,c;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=p.parse(t.url),a=r.path.split("/"),e.next=4,V({url:r.protocol+"//"+r.host+a.slice(0,a.length-1).join("/"),headers:t.headers});case 4:return c=e.sent,e.next=7,n({url:"/"+c.resourceId+c.pathLeftover+"/"+a[a.length-1],method:"delete",valid:!1});case 7:return e.abrupt("return");case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),_=function(){var e=(0,o.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return m[t._id]&&(m[t._id].promise&&m[t._id].promise.cancel(),delete m[t._id]),e.prev=1,e.next=4,L.remove(t);case 4:e.next=11;break;case 6:if(e.prev=6,e.t0=e.catch(1),404!==e.t0.status){e.next=10;break}return e.abrupt("return");case 10:throw e.t0;case 11:case"end":return e.stop()}},e,this,[[1,6]])}));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=(0,o.default)(u.default.mark(function e(t,r){var a,c,o;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=p.parse(t.url),!/^\/resources/.test(a.path)&&!/^\/users/.test(a.path)){e.next=6;break}return e.next=4,n({url:t.url,method:t.method,valid:!1});case 4:e.next=31;break;case 6:return e.prev=6,e.next=9,V(t);case 9:return c=e.sent,e.next=12,n({url:"/"+c.resourceId+c.pathLeftover,method:t.method,valid:!1});case 12:return e.next=14,_(c);case 14:return e.prev=14,e.next=17,w(t);case 17:e.next=23;break;case 19:throw e.prev=19,e.t0=e.catch(14),console.log("was a problem updating parent doc"),e.t0;case 23:e.next=31;break;case 25:if(e.prev=25,e.t1=e.catch(6),!e.t1.response||404!==e.t1.response.status){e.next=30;break}e.next=31;break;case 30:throw e.t1;case 31:if(r){e.next=37;break}return e.next=34,M(t);case 34:o=e.sent,e.next=37;break;case 37:return e.abrupt("return",o);case 38:case"end":return e.stop()}},e,this,[[6,25],[14,19]])}));return function(t,n){return e.apply(this,arguments)}}(),I=function(){var e=(0,o.default)(u.default.mark(function e(t,r){var s,i;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===r._rev){e.next=7;break}return e.next=3,V({url:t.url,headers:t.headers,resourceId:r._id});case 3:return s=e.sent,i=T(r,{url:t.url,headers:t.headers}),e.next=7,n({url:"/"+(r._id||s.resourceId),data:i});case 7:if("object"!==("undefined"===typeof r?"undefined":(0,a.default)(r))){e.next=11;break}return e.abrupt("return",d.map((0,c.default)(r||{}),function(){var e=(0,o.default)(u.default.mark(function e(n){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("_"!==n.charAt(0)){e.next=2;break}return e.abrupt("return");case 2:if(r[n]){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,I({url:t.url+"/"+n,headers:t.headers},r[n]);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()));case 11:return e.abrupt("return");case 12:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),S=function(){var e=(0,o.default)(u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!L){e.next=6;break}return e.next=4,L.destroy();case 4:(0,c.default)(m).forEach(function(){var e=(0,o.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!m[t].promise){e.next=3;break}return e.next=3,m[t].promise.cancel();case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),m={};case 6:e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return");case 11:case"end":return e.stop()}},e,this,[[0,8]])}));return function(){return e.apply(this,arguments)}}(),C=e.name,D=e.req,U=e.expires,L=L||new s.default(C);s.default.on("destroyed",function(){var e=(0,o.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t===C&&(L=new s.default(C));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var M=D,q=U||1728e5;function R(e,t,n,r){var a=Date.now();return e in m?(m[e].data=t,m[e].access=a):m[e]={data:t,access:a,promise:void 0},m[e].promise||(m[e].promise=d.delay(x).then(function(){N(e,n,r)}).catch(function(e){console.log("handleMemoryCacheError",e)})),d.resolve()}function N(e,t,n){return L.put(m[e].data).then(function(t){m[e].data._rev=t.rev,delete m[e].promise}).catch(function(t){console.log("Error doPut",m[e].data._rev,t)})}function V(e){var t=p.parse(e.url),n=m[t.path];return n?n.data:L.get(t.path).catch((0,o.default)(u.default.mark(function n(){var r,a,c,o,s;return u.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.resourceId){n.next=5;break}r=e.resourceId,a="",n.next=11;break;case 5:return n.next=7,M({method:"HEAD",url:e.url,headers:e.headers});case 7:c=n.sent,o=c.headers["content-location"].split("/"),r=o.slice(1,3).join("/"),a=o.length>3?"/"+o.slice(3,o.length).join("/"):"";case 11:return s={_id:t.path,resourceId:r,pathLeftover:a},n.abrupt("return",R(t.path,s,void 0,e).then(function(){return V(e)}));case 13:case"end":return n.stop()}},n,this)})))}function T(e,t){var n=Array.isArray(e)?[]:{};return e?((0,c.default)(e||{}).forEach(function(){var r=(0,o.default)(u.default.mark(function r(c,o){var s,i;return u.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if("object"===("undefined"===typeof(s=e[c])?"undefined":(0,a.default)(s))&&s){r.next=4;break}return n[c]=s,r.abrupt("return");case 4:if(!s._meta){r.next=11;break}return r.next=7,V({url:t.url+"/"+c,headers:t.headers});case 7:return i=r.sent,n[c]={_id:i.resourceId},void 0!==e[c]._rev&&(n[c]._rev=e[c]._rev),r.abrupt("return");case 11:n[c]=T(e[c],{url:t.url+"/"+c,headers:t.headers});case 12:case"end":return r.stop()}},r,this)}));return function(e,t){return r.apply(this,arguments)}}()),n):e}function W(e,t,n){return"object"===("undefined"===typeof e?"undefined":(0,a.default)(e))?d.map((0,c.default)(e||{}),function(r){return null===e[r]?n=t+"/"+r:W(e[r],t+"/"+r,n).then(function(e){return n=e||n,e||n})},{concurrency:1}).then(function(){return n}).catch(function(e){}):d.resolve(void 0)}function G(e,t,n){return"object"===("undefined"===typeof e?"undefined":(0,a.default)(e))?d.map((0,c.default)(e||{}),function(r){if("_rev"===r)n.path=t,n.data=e;else if("_"===r.charAt(0))return n;return G(e[r],t+"/"+r,n).then(function(){return n})}).then(function(){return n}):d.resolve(n)}setInterval(function(){var e=Date.now(),t={key:void 0,time:e},n=0;(0,c.default)(m).forEach(function(r){!m[r].promise&&e-m[r].access<O&&(m[r].access<t&&(t={key:r,time:m[r].access}),delete m[r],n++)}),0===n&&t.key&&delete m[t.key]},j);var P=l().limit({concurrency:1}).process(function(){var e=(0,o.default)(u.default.mark(function e(t){var r=this;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return p.parse(t.request.url),t.response.change.body._id=t.response.resourceId,e.abrupt("return",G(t.response.change.body,"",{path:"",data:t.response.change.body}).then(function(){var e=(0,o.default)(u.default.mark(function e(a){var c,s;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.response.change.wasDelete){e.next=9;break}return e.next=3,W(a.data,"","");case 3:return c=e.sent,s=a.path+c,t.nullPath=s,e.abrupt("return",n({url:t.request.url+s,headers:t.request.headers,method:"delete",valid:!0}).then((0,o.default)(u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}},e,this)}))));case 9:return e.next=11,I(t.request,t.response.change.body,{});case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}},e,r)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){return t}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());return t={api:function(e){switch(e.method){case"get":return g(e);case"delete":return E(e);case"put":return y(e)}},db:L,resetCache:S,handleWatchChange:function(e){return P(e)},removeLookup:_,findDeepestResource:G,findNullValue:W,getLookup:V,dbUpsert:n,handleMemoryCache:R,doPut:N},(0,r.default)(t,"findDeepestResource",G),(0,r.default)(t,"_recursiveUpsert",I),(0,r.default)(t,"findNullValue",W),(0,r.default)(t,"replaceLinks",T),(0,r.default)(t,"removeLookup",_),(0,r.default)(t,"updateParent",w),(0,r.default)(t,"getResFromDb",k),(0,r.default)(t,"getResFromServer",i),(0,r.default)(t,"_getMemoryCache",function(){return m}),t};var s=i(n(384));function i(e){return e&&e.__esModule?e:{default:e}}var l=n(948),d=(n(389),n(180)),p=n(90),f=n(264),h=n(390),b=!1,v=10,m={},O=3e4,j=1e4,x=5e3;d.config({cancellation:!0})},979:function(e,t,n){"use strict";var r=s(n(980)),a=s(n(382)),c=s(n(985)),u=s(n(992)),o=s(n(996));function s(e){return e&&e.__esModule?e:{default:e}}var i=n(180),l=n(90),d=n(393),p=n(998);i.config({warnings:!1}),e.exports=function(e){var t=[];e=e.replace("https://","wss://").replace("http://","ws://");var n=new p(e),s=!1,f={},h={};function b(){s&&(t.forEach(function(e){n.send((0,o.default)(e))}),t=[])}return new i(function(e,t){n.onopen=function(t){s=!0,b(),e(n)},n.onclose=function(e){},n.onmessage=function(e){var t=JSON.parse(e.data);if(t.requestId)if(f[t.requestId]){if(t.status>=200&&t.status<300)f[t.requestId].resolve(t);else{var n=new Error("Request failed with status code "+t.status);n.request=f[t.requestId].request,n.response={status:t.status,statusText:t.statusText,headers:t.headers,data:t.data},f[t.requestId].reject(n)}delete f[t.requestId]}else if(h[t.requestId])if(h[t.requestId].resolve){if("success"===t.status)h[t.requestId].resolve(t);else{var r=new Error("Request failed with status code "+t.status);r.response=t,r.request=h[t.requestId].request,h[t.requestId].reject(r)}delete h[t.requestId].resolve,delete h[t.requestId].reject}else{if(null==h[t.requestId].callback)throw new Error("The given watch function has an undefined callback:",h[t.requestId]);h[t.requestId].callback(t)}}}).then(function(){return{url:e,http:function(e){return new i(function(n,o){var s=l.parse(e.url),i={requestId:d(),method:e.method.toLowerCase(),path:s.path,data:e.data,headers:(0,u.default)(e.headers).map(function(e){var t=(0,c.default)(e,2),n=t[0],r=t[1];return(0,a.default)({},n.toLowerCase(),r)}).reduce(function(e,t){return(0,r.default)({},e,t)})};t.push(i),f[i.requestId]={request:e,resolve:n,reject:o},b()})},close:function(){t=[],f={},h={},n.close()},watch:function(e,n){return new i(function(o,s){var i={requestId:d(),method:"watch",path:e.path,headers:(0,u.default)(e.headers).map(function(e){var t=(0,c.default)(e,2),n=t[0],r=t[1];return(0,a.default)({},n.toLowerCase(),r)}).reduce(function(e,t){return(0,r.default)({},e,t)})};t.push(i),h[i.requestId]={request:e,resolve:o,reject:s,callback:n},b()})},unwatch:function(e,n){return new i(function(o,s){var i={requestId:d(),method:"unwatch",path:e.path,headers:(0,u.default)(e.headers).map(function(e){var t=(0,c.default)(e,2),n=t[0],r=t[1];return(0,a.default)({},n.toLowerCase(),r)}).reduce(function(e,t){return(0,r.default)({},e,t)})};t.push(i),h[i.requestId]={request:e,resolve:o,reject:s,callback:n},b()})}}})}}},[[577,1,2]]]);
//# sourceMappingURL=main.a39e20d4.chunk.js.map