{"version":3,"sources":["../../oada-cache/build/token.js","components/AppBarContent/index.js","components/Visualization/Map/Lines/index.js","components/Visualization/Map/Markers/index.js","components/Visualization/Map/index.js","components/Visualization/Graph/index.js","components/Visualization/index.js","components/DrawerContent/Summary/index.js","components/DrawerContent/Diagnostics/index.js","components/DrawerContent/index.js","components/ConnectDialog/index.js","components/App/index.js","modules/session/sequences.js","modules/session/index.js","modules/map/sequences.js","modules/data/sequences.js","modules/diagnostics/sequences.js","modules/diagnostics/index.js","modules/map/index.js","modules/data/index.js","modules/snapshots/sequences.js","modules/snapshots/index.js","modules/connection/sequences.js","modules/connection/index.js","modules/root/sequences.js","modules/root/index.js","controller.js","index.js","../../oada-cache/build/index.js","../../oada-cache/build/cache.js","../../oada-cache/build/websocket.js"],"names":["_regenerator2","_interopRequireDefault","__webpack_require__","_asyncToGenerator3","_classCallCheck3","_createClass3","_pouchdb2","obj","__esModule","default","Promise","urlLib","crypto","oadaIdClient","Token","param","arguments","length","undefined","this","_token","token","_domain","domain","_options","options","hash","createHash","update","_name","digest","_isSet","_tokenDB","_id","_rev","key","value","_ref","mark","_callee","result","doc","wrap","_context","prev","next","get","sent","t0","abrupt","stop","apply","_ref2","_callee2","_expired","TOKEN","urlObj","gat","_context2","isSet","checkTokenDB","parse","window","node","host","promisify","getAccessToken","access_token","put","_x2","_ref3","_callee3","_context3","setup","_ref4","_callee4","_context4","_x3","_ref5","_callee5","_context5","_ref6","_callee6","_context6","destroy","module","exports","AppBarContent","userLocationButton","_this","classes","props","userLocationAvailable","react_default","a","createElement","IconButton_default","onClick","centerOnUser","MyLocation_default","className","icon","Toolbar_default","color","aria-label","toggleDrawerOpen","Menu_default","Typography_default","variant","flex","React","Component","connect","state","_templateObject","signal","_templateObject2","_templateObject3","withStyles","theme","_icon","Object","defineProperty","breakpoints","up","width","spacing","unit","height","marginRight","down","Lines","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","dataLines","_this2","conn_id","connection_id","ready","oada","bookmarks","hasOwnProperty","devices","isoblue","selectedUnit","date","hour","gps_data","e","console","error","points","_","forEach","instance","lat","lng","push","unit_resource","location","date_list","keys","last_date","maxBy","o","Date","hour_list","current_hour","max","last_hour","remove","n","current_time_sec","Math","round","getTime","positions","prev_gps_data","current_gps_data","map","Polyline","Lines_templateObject","Lines_templateObject2","Lines_templateObject3","_templateObject4","_templateObject5","_templateObject6","withTheme","Markers","unitMarkers","snapshots","tempGPS","CircleMarker","ref","center","fillColor","health","fillOpacity","radius","zIndexOffset","selectUnit","Tooltip","direction","offset","Markers_templateObject","Markers_templateObject2","refs","leafletElement","locate","currentMarker","Marker","position","userLocation","Map","dragging","targetCenter","zoom","onlocationfound","storeUserLocation","latlng","style","TileLayer","url","attribution","Map_Markers","Map_Lines","Map_templateObject","Map_templateObject2","Map_templateObject3","Map_templateObject4","Map_templateObject5","display","Graph","rawData","chart","data","measurement","values","heartbeats","latency","recTime","genTime","time","toLocaleTimeString","minute","es6","margin","top","right","left","bottom","type","isAnimationActive","dataKey","stroke","strokeDasharray","label","dy","angle","interfaces","connection","Graph_templateObject","Graph_templateObject2","Graph_templateObject3","Graph_templateObject4","Graph_templateObject5","Graph_templateObject6","_templateObject7","Visualization","mode","Visualization_Map","Visualization_Graph","Visualization_templateObject","Summary","units","List_default","list","component","ListItem_default","button","concat","ListItemText_default","primary","ListItemIcon_default","Sync_default","healthy","SyncProblem_default","sick","SyncDisabled_default","align","Divider_default","Summary_templateObject","Summary_templateObject2","backgroundColor","palette","background","paper","overflow","textField","Diagnostics","measurements","visualizing","Button_default","toggleMode","measurementSelect","Select_default","renderValue","onChange","setMeasurement","target","MenuItem_default","dateSelect","setDate","hourSelect","setHour","lastReport","lastLocationReport","unselectUnit","Diagnostics_templateObject","Diagnostics_templateObject2","Diagnostics_templateObject3","Diagnostics_templateObject4","Diagnostics_templateObject5","Diagnostics_templateObject6","Diagnostics_templateObject7","_templateObject8","_templateObject9","_templateObject10","_templateObject11","_templateObject12","_templateObject13","_templateObject14","_templateObject15","DrawerContent","content","DrawerContent_Diagnostics","DrawerContent_Summary","Drawer_default","open","drawerOpen","onClose","drawerPaper","toolbar","DrawerContent_templateObject","DrawerContent_templateObject2","DrawerContent_templateObject3","mixins","oadaDomainText","ConnectDialog_templateObject","ConnectDialog_templateObject2","submitClicked","ConnectDialog_templateObject3","oadaDomainChanged","ConnectDialog_templateObject4","_React$Component","ConnectDialog","inherits","createClass","Dialog_default","index_es","id","autoFocus","fullwidth","App","init","root","AppBar_default","appBar","components_AppBarContent","components_DrawerContent","components_Visualization","components_ConnectDialog","App_templateObject","flexGrow","zIndex","drawer","sequence","toggle","sequences_templateObject","Module","dataReady","signals","set","map_sequences_templateObject","sequences_templateObject2","debounce","continue","sequences_templateObject3","sequences_templateObject4","discard","centerOnUnit","sequences_templateObject5","sequences_templateObject6","sequences_templateObject7","sequences_templateObject8","masterTree","_type","device-index","*","day-index","hour-index","dayTree","setRequestLastHour","requests","device_name","device_data","path","watch","tree","handleDeviceUpdate","data_sequences_templateObject","data_sequences_templateObject2","getDevices","data_sequences_templateObject3","data_sequences_templateObject4","data_sequences_templateObject5","data_sequences_templateObject6","data_sequences_templateObject7","getHour","diagnostics_sequences_templateObject","diagnostics_sequences_templateObject2","diagnostics_sequences_templateObject3","diagnostics_sequences_templateObject4","diagnostics_sequences_templateObject5","diagnostics_sequences_templateObject6","sort","b","diagnostics_sequences_templateObject7","diagnostics_sequences_templateObject8","sequences_templateObject9","when","sequences_templateObject10","true","sequences_templateObject11","sequences_templateObject12","false","sequences_templateObject13","sequences_templateObject14","createSnapshots","reduce","acc","unitkey","unitLocationData","lastDate","lastHour","lastGPS","msg_gps","lastHeartbeatTime","snapshots_sequences_templateObject","snapshots_sequences_templateObject2","signOut","connection_sequences_templateObject","connection_sequences_templateObject2","connection_sequences_templateObject3","connection_sequences_templateObject4","connection_sequences_templateObject5","updateOadaDomain","connection_sequences_templateObject6","connection_sequences_templateObject7","redirect","metadata","scope","connection_sequences_templateObject8","connection_sequences_templateObject9","connection_sequences_templateObject10","connection_sequences_templateObject11","connection_sequences_templateObject12","setConnection","connection_sequences_templateObject13","connection_sequences_templateObject14","dialog_open","oada_domain_text","oada_domain","providers","oadaProvider","modules","session","oadaModule","diagnostics","Controller","devtools","createMuiTheme","typography","useNextVariants","render","_cerebral_react","controller","core_styles","components_App","document","getElementById","_keys2","_typeof3","_cache2","_uuid2","_lodash2","pointer","ws","axios","_TOKEN","_callee18","CACHE","REQUEST","NOCACHEREQUEST","SOCKET","DOMAIN","NAME","EXPIRES","_replaceLinks","_watch","_findDeepestResources","_convertSetupTreePath","_configureCache","post","socketApi","_getMemoryCache","_makeResourceAndLink","waitTime","linkReq","resReq","link","pathPieces","parentPath","response","newHeaders","resource","headers","clone","status","split","splice","join","method","Authorization","t1","delay","cloneDeep","parseInt","_buildRequest","_ref8","_ref7","req","Error","test","indexOf","toLowerCase","authorization","slice","header","_x5","_sendRequest","_ref9","reconnect","_x6","_ref11","_ref10","watchResponse","pieces","treePath","subTree","stuff","log","func","function","payload","replace","has","_recursiveGet","cached","_x7","_ref12","_callee7","got","_context7","x-oada-rev","_ref13","res","_x12","then","_x8","_x9","_x10","_x11","_ensureTree","_ref15","_callee9","_ref14","firstPath","storedTree","responses","ret","parentRev","_context9","mapSeries","stored","_ref16","_callee8","piece","j","i","urlPath","resp","_context8","if-match","_x14","_x15","_x13","_recursiveDelete","_ref19","_callee12","_context12","_ref20","_callee10","_context10","_x19","_callee11","_context11","del","content-type","removeLookup","_x16","_x17","_x18","_ref23","_callee13","_ref22","unwatch","_context13","_x20","_ref25","_callee14","_ref24","_context14","_x21","resetCache","_ref26","_callee15","name","expires","_context15","_x22","_x23","disconnect","_ref27","_callee16","_context16","db","close","cleanUp","_ref28","_callee17","_context17","renew","cache","websocket","_context18","_ref18","_ref17","api","newPieces","z","catch","err","message","watchPayload","request","change","handleWatchChange","_x4","Array","isArray","val","hostname","http","delete","_x","_defineProperty3","dbUpsert","resourceId","pathLeftover","dbPut","memoryResult","curData","newData","valid","accessed","now","memoryCache","INCOMPLETE_RESOURCE","promise","cancel","merge","handleMemoryCache","getResFromServer","getResFromDb","res_inmemory","res_localdb","offline","revLimit","expiration","content-location","newReq","lookup","getLookup","protocol","OFFLINE","REVLIMIT","reqPieces","updateParent","_recursiveUpsert","body","newBody","replaceLinks","charAt","on","dbName","access","dbPutDelay","doPut","resolve","rev","_meta","findNullValue","nullPath","concurrency","findDeepestResource","deepestResource","setInterval","oldest","deleteCount","timeThreshold","cleanMemoryTimer","queue","cq","limit","process","deletedPath","wasDelete","config","cancellation","_extends3","_slicedToArray3","_entries2","_stringify2","uuid","WebSocket","warnings","messages","socket","connected","httpCallbacks","watchCallbacks","sendMessages","send","reject","onopen","event","onclose","onmessage","JSON","requestId","statusText","_err","callback"],"mappings":"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","file":"static/js/main.a39e20d4.chunk.js","sourcesContent":["\"use strict\";\n/* Copyright 2018 Open Ag Data Alliance\n *\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @author Servio Palacios, Samuel Noel\n * Token API for Handling Tokens in the Cache Library - Super Class.\n * @module src/token\n */\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require(\"babel-runtime/helpers/asyncToGenerator\");\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require(\"babel-runtime/helpers/createClass\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _pouchdb = require(\"pouchdb\");\n\nvar _pouchdb2 = _interopRequireDefault(_pouchdb);\n\nvar _http = require(\"http\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar Promise = require(\"bluebird\");\n\nvar urlLib = require(\"url\");\n\nvar _ = require(\"lodash\"); //const debug = require(\"debug\")(\"oada-cache:token\");\n\n\nvar crypto = require(\"crypto\");\n\nvar oadaIdClient = require(\"@oada/oada-id-client\"); //const error = require('debug')('oada-cache:index:error');\n//const info = require('debug')('oada-cache:index:info');\n\n\nvar Token = function () {\n  function Token() {\n    var param = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    (0, _classCallCheck3.default)(this, Token);\n    var self = this;\n    self._token = param.token || null;\n    self._domain = param.domain || \"localhost\";\n    self._options = param.options; // creating database nae based on the domain\n    // ensured one to one correspondence with the domain\n    // i.e., token belongs to that domain\n\n    var hash = crypto.createHash(\"sha256\");\n    hash.update(self._domain);\n    self._name = hash.digest(\"hex\");\n    self._isSet = self._token ? true : false;\n    self._tokenDB = new _pouchdb2.default(this._name);\n    self._id = \"OadaTokenID\";\n    self._rev = null;\n    self.token = self._token ? self._token : \"\";\n  } //constructor\n\n  /**\n   * searches for a local db and a doc\n   */\n\n\n  (0, _createClass3.default)(Token, [{\n    key: \"checkTokenDB\",\n    value: function () {\n      var _ref = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee() {\n        var result, doc;\n        return _regenerator2.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                result = null;\n                _context.prev = 1;\n                _context.next = 4;\n                return this._tokenDB.get(this._id);\n\n              case 4:\n                doc = _context.sent; //      debug(\"received document ->\", doc);\n\n                result = doc.token;\n                this._rev = doc._rev;\n                _context.next = 12;\n                break;\n\n              case 9:\n                _context.prev = 9;\n                _context.t0 = _context[\"catch\"](1);\n                return _context.abrupt(\"return\", result);\n\n              case 12:\n                return _context.abrupt(\"return\", result);\n\n              case 13:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[1, 9]]);\n      }));\n\n      function checkTokenDB() {\n        return _ref.apply(this, arguments);\n      }\n\n      return checkTokenDB;\n    }() //checkTokenDB\n\n    /**\n     * if token was provided then it sets the .token in the constructor -> returns that value\n     * sets the pouch db if it does not exist\n     */\n\n  }, {\n    key: \"setup\",\n    value: function () {\n      var _ref2 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee2(_expired) {\n        var TOKEN, urlObj, result, gat;\n        return _regenerator2.default.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                // Get a token\n                TOKEN = null; //returned to the chache library\n\n                if (!this.isSet()) {\n                  _context2.next = 5;\n                  break;\n                }\n\n                TOKEN = this.token;\n                _context2.next = 23;\n                break;\n\n              case 5:\n                _context2.next = 7;\n                return this.checkTokenDB();\n\n              case 7:\n                TOKEN = _context2.sent;\n\n                if (!(!TOKEN || _expired)) {\n                  _context2.next = 23;\n                  break;\n                } //local cache does not have a token\n\n\n                urlObj = urlLib.parse(this._domain);\n                result = void 0; // Open the browser and the login popup\n\n                if (!(typeof window === \"undefined\")) {\n                  _context2.next = 17;\n                  break;\n                }\n\n                _context2.next = 14;\n                return oadaIdClient.node(urlObj.host, this._options);\n\n              case 14:\n                result = _context2.sent;\n                _context2.next = 21;\n                break;\n\n              case 17:\n                // the library itself detects a browser environment and delivers .browser\n                gat = Promise.promisify(oadaIdClient.getAccessToken);\n                _context2.next = 20;\n                return gat(urlObj.host, this._options);\n\n              case 20:\n                result = _context2.sent;\n\n              case 21:\n                TOKEN = result.access_token; //        debug(\"setup token -> access token:\", result.access_token);\n\n                this.put(TOKEN);\n\n              case 23:\n                return _context2.abrupt(\"return\", TOKEN);\n\n              case 24:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function setup(_x2) {\n        return _ref2.apply(this, arguments);\n      }\n\n      return setup;\n    }() //setup\n\n    /**\n     * fetches the token from the this._tokenDB or\n     * setups the new database and retrieves the new token to be used\n     */\n\n  }, {\n    key: \"get\",\n    value: function () {\n      var _ref3 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee3() {\n        return _regenerator2.default.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                return _context3.abrupt(\"return\", this.setup());\n\n              case 1:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function get() {\n        return _ref3.apply(this, arguments);\n      }\n\n      return get;\n    }()\n    /**\n     * searches for the token in the this._tokenDB\n     * if present, the it sends the current _rev\n     * if not present (404), it creates a new document in the created this._tokenDB\n     * @param {string} _token\n     */\n\n  }, {\n    key: \"put\",\n    value: function () {\n      var _ref4 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee4(_token) {\n        var TOKEN, response, _response;\n\n        return _regenerator2.default.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                // get token from local cache\n                TOKEN = this.checkTokenDB();\n                _context4.prev = 1;\n\n                if (!TOKEN) {\n                  _context4.next = 9;\n                  break;\n                }\n\n                _context4.next = 5;\n                return this._tokenDB.put({\n                  _id: this._id,\n                  _rev: this._rev,\n                  token: _token\n                });\n\n              case 5:\n                response = _context4.sent;\n                this.token = _token;\n                _context4.next = 13;\n                break;\n\n              case 9:\n                _context4.next = 11;\n                return this._tokenDB.put({\n                  _id: this._id,\n                  token: _token\n                });\n\n              case 11:\n                _response = _context4.sent;\n                this.token = _token;\n\n              case 13:\n                _context4.next = 17;\n                break;\n\n              case 15:\n                _context4.prev = 15;\n                _context4.t0 = _context4[\"catch\"](1);\n\n              case 17:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this, [[1, 15]]);\n      }));\n\n      function put(_x3) {\n        return _ref4.apply(this, arguments);\n      }\n\n      return put;\n    }() //put\n\n  }, {\n    key: \"renew\",\n    value: function () {\n      var _ref5 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee5() {\n        return _regenerator2.default.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                this._isSet = false;\n                return _context5.abrupt(\"return\", this.setup(true));\n\n              case 2:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function renew() {\n        return _ref5.apply(this, arguments);\n      }\n\n      return renew;\n    }()\n  }, {\n    key: \"cleanUp\",\n    value: function () {\n      var _ref6 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee6() {\n        return _regenerator2.default.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.prev = 0;\n                _context6.next = 3;\n                return this._tokenDB.destroy();\n\n              case 3:\n                //await this._tokenDB.close();\n                this._isSet = false;\n                _context6.next = 8;\n                break;\n\n              case 6:\n                _context6.prev = 6;\n                _context6.t0 = _context6[\"catch\"](0);\n\n              case 8:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this, [[0, 6]]);\n      }));\n\n      function cleanUp() {\n        return _ref6.apply(this, arguments);\n      }\n\n      return cleanUp;\n    }() //cleanUp\n\n  }, {\n    key: \"isSet\",\n    value: function isSet() {\n      return this._isSet;\n    }\n  }]);\n  return Token;\n}(); //class\n\n/* exporting the module */\n\n\nmodule.exports = Token;","import React from \"react\";\n\nimport { withStyles } from \"@material-ui/core/styles\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport Typography from \"@material-ui/core/Typography\";\nimport Toolbar from \"@material-ui/core/Toolbar\";\n//import TextField from '@material-ui/core/TextField';\nimport MyLocationIcon from \"@material-ui/icons/MyLocation\";\nimport MenuIcon from \"@material-ui/icons/Menu\";\n\nimport { connect } from \"@cerebral/react\";\nimport { state, signal } from \"cerebral/tags\";\n\nconst styles = theme => ({\n  flex: {\n    flex: 1,\n  },\n  icon: {\n    color: \"#FFFFFF\",\n    [theme.breakpoints.up(\"xs\")]: {\n      width: 5 * theme.spacing.unit,\n      height: 5 * theme.spacing.unit,\n      marginRight: theme.spacing.unit,\n    },\n    [theme.breakpoints.down(\"xs\")]: {\n      width: 4 * theme.spacing.unit,\n      height: 4 * theme.spacing.unit,\n      marginRight: theme.spacing.unit,\n    },\n  },\n});\n\nclass AppBarContent extends React.Component {\n  render() {\n    const { classes } = this.props;\n\n    var userLocationButton;\n    if (this.props.userLocationAvailable) {\n      userLocationButton = (\n        <IconButton onClick={() => this.props.centerOnUser({})}>\n          <MyLocationIcon className={classes.icon} />\n        </IconButton>\n      );\n    } else {\n      userLocationButton = null;\n    }\n\n    return (\n      <Toolbar>\n        <IconButton\n          color=\"inherit\"\n          aria-label=\"Open Drawer\"\n          onClick={() => this.props.toggleDrawerOpen({})}\n        >\n          <MenuIcon className={classes.icon} />\n        </IconButton>\n        <Typography variant=\"h6\" color=\"inherit\" className={classes.flex}>\n          ISOBlueApp [1.1.0]\n        </Typography>\n        {userLocationButton}\n      </Toolbar>\n    );\n  }\n}\n\nexport default connect(\n  {\n    userLocationAvailable: state`map.userLocationAvailable`,\n\n    centerOnUser: signal`map.centerOnUser`,\n    toggleDrawerOpen: signal`session.toggleDrawerOpen`,\n  },\n  withStyles(styles)(AppBarContent),\n);\n","import React from \"react\";\nimport _ from \"lodash\";\nimport { connect } from \"@cerebral/react\";\nimport { state } from \"cerebral/tags\";\nimport uuid from \"uuid\";\n//import Leaflet from 'leaflet';\nimport { Polyline } from \"react-leaflet\";\nimport { withStyles } from \"@material-ui/core/styles\";\n\nconst styles = theme => ({});\n\nclass Lines extends React.Component {\n  constructor(props) {\n    super(props);\n    this.dataLines = [];\n  }\n\n  render() {\n    // get connection id\n    const conn_id = this.props.connection_id;\n\n    // do not render lines if data is not ready\n    if (!this.props.ready) return null;\n\n    this.dataLines = [];\n\n    if (!this.props.oada[conn_id].bookmarks.hasOwnProperty(\"isoblue\")) {\n      return null;\n    }\n\n    const devices =\n      this.props.oada[conn_id].bookmarks.isoblue[\"device-index\"] || {};\n\n    // Unit is selected\n    if (this.props.selectedUnit && this.props.date && this.props.hour) {\n      // ensure that the target resource actually exists\n      var gps_data = null;\n      try {\n        gps_data =\n          devices[this.props.selectedUnit][\"location\"][\"day-index\"][\n            this.props.date\n          ][\"hour-index\"][this.props.hour][\"sec-index\"];\n      } catch (e) {\n        console.error(\"hmm\");\n        return null;\n      }\n\n      // make a line\n      var points = [];\n      _.forEach(gps_data, instance => {\n        if (\n          instance.hasOwnProperty(\"lat\") &&\n          instance.hasOwnProperty(\"lng\") &&\n          instance.lat &&\n          instance.lng\n        ) {\n          points.push([instance.lat, instance.lng]);\n        }\n      });\n\n      // add line\n      this.dataLines.push(points);\n    }\n\n    // None of the units is selected\n    else {\n      _.forEach(devices, (unit_resource, unit) => {\n        // get the most recent date\n        if (!unit_resource.hasOwnProperty(\"location\")) return;\n        if (!unit_resource.location.hasOwnProperty(\"day-index\")) return;\n        const date_list = Object.keys(unit_resource[\"location\"][\"day-index\"]);\n        if (date_list.length === 0) return;\n        const last_date = _.maxBy(date_list, function(o) {\n          return new Date(o);\n        });\n\n        // get hours\n        if (\n          !unit_resource[\"location\"][\"day-index\"][last_date].hasOwnProperty(\n            \"hour-index\",\n          )\n        )\n          return;\n        const hour_list = Object.keys(\n          unit_resource[\"location\"][\"day-index\"][last_date][\"hour-index\"],\n        );\n\n        const current_hour = _.max(hour_list);\n        const last_hour = _.max(\n          _.remove(hour_list, n => {\n            return n !== current_hour;\n          }),\n        );\n        var current_time_sec = Math.round(new Date().getTime() / 1000);\n        var positions = [];\n\n        if (\n          last_hour !== undefined &&\n          unit_resource[\"location\"][\"day-index\"][last_date][\"hour-index\"][\n            last_hour\n          ].hasOwnProperty(\"sec-index\")\n        ) {\n          const prev_gps_data =\n            unit_resource[\"location\"][\"day-index\"][last_date][\"hour-index\"][\n              last_hour\n            ][\"sec-index\"];\n          var prev_gps_ts = Object.keys(prev_gps_data || {});\n          prev_gps_ts.forEach(o => {\n            if (\n              current_time_sec - o <= 15 * 60 &&\n              prev_gps_data[o].hasOwnProperty(\"lat\") &&\n              prev_gps_data[o].hasOwnProperty(\"lng\") &&\n              prev_gps_data[o].lat &&\n              prev_gps_data[o].lng\n            ) {\n              positions.push([prev_gps_data[o].lat, prev_gps_data[o].lng]);\n            }\n          });\n        }\n\n        if (\n          unit_resource[\"location\"][\"day-index\"][last_date][\"hour-index\"][\n            current_hour\n          ].hasOwnProperty(\"sec-index\")\n        ) {\n          const current_gps_data =\n            unit_resource[\"location\"][\"day-index\"][last_date][\"hour-index\"][\n              current_hour\n            ][\"sec-index\"];\n          var current_gps_ts = Object.keys(current_gps_data || {});\n          current_gps_ts.forEach(o => {\n            if (\n              current_time_sec - o <= 15 * 60 &&\n              current_gps_data[o].hasOwnProperty(\"lat\") &&\n              current_gps_data[o].hasOwnProperty(\"lng\") &&\n              current_gps_data[o].lat &&\n              current_gps_data[o].lng\n            ) {\n              positions.push([\n                current_gps_data[o].lat,\n                current_gps_data[o].lng,\n              ]);\n            }\n          });\n        }\n\n        // FIXME: currentGPS and lastGPS are not guaranteed to be sorted\n\n        this.dataLines.push(positions);\n      });\n    }\n\n    return (\n      <div>\n        {this.dataLines.map(positions => (\n          <Polyline positions={positions} color=\"#ffffff\" />\n        ))}\n      </div>\n    );\n  }\n}\n\nexport default connect(\n  {\n    connection_id: state`data.connection_id`,\n    ready: state`data.ready`,\n    oada: state`oada`,\n    date: state`diagnostics.date`,\n    hour: state`diagnostics.hour`,\n    selectedUnit: state`diagnostics.selectedUnit`,\n  },\n  withStyles(styles, { withTheme: true })(Lines),\n);\n","import React from \"react\";\nimport _ from \"lodash\";\nimport { connect } from \"@cerebral/react\";\nimport { state, signal } from \"cerebral/tags\";\nimport { CircleMarker, Tooltip } from \"react-leaflet\";\nimport { withStyles } from \"@material-ui/core/styles\";\n\nconst styles = theme => ({});\n\nclass Markers extends React.Component {\n  render() {\n    const unitMarkers = [];\n    _.forEach(Object.keys(this.props.snapshots) || {}, unit => {\n      var tempGPS = this.props.snapshots[unit].location;\n      if (\n        tempGPS &&\n        tempGPS.hasOwnProperty(\"lat\") &&\n        tempGPS.hasOwnProperty(\"lng\") &&\n        tempGPS.lat &&\n        tempGPS.lng\n      ) {\n        unitMarkers.push(\n          <CircleMarker\n            ref={unit => {\n              this.unit = unit;\n            }}\n            key={unit}\n            center={[\n              this.props.snapshots[unit].location.lat,\n              this.props.snapshots[unit].location.lng,\n            ]}\n            color={\"#ffffff\"}\n            fillColor={(() => {\n              switch (this.props.snapshots[unit].health) {\n                case \"Healthy\":\n                  return \"#008000\";\n                case \"Sick\":\n                  return \"#ffbf00\";\n                case \"Down\":\n                  return \"#707070\";\n                default:\n                  return \"#707070\";\n              }\n            })()}\n            fillOpacity={1}\n            radius={12}\n            zIndexOffset={1}\n            onClick={e => this.props.selectUnit({ unit: unit })}\n          >\n            <Tooltip direction=\"top\" offset={[0, -10]}>\n              <b>Unit: {unit}</b>\n              <br />\n              <center>\n                <b>{this.props.snapshots[unit].health}</b>\n              </center>\n            </Tooltip>\n          </CircleMarker>,\n        );\n      }\n    });\n\n    return <div>{unitMarkers}</div>;\n  }\n}\n\nexport default connect(\n  {\n    snapshots: state`snapshots`,\n    selectUnit: signal`diagnostics.selectUnit`,\n  },\n  withStyles(styles, { withTheme: true })(Markers),\n);\n","import React from \"react\";\nimport { connect } from \"@cerebral/react\";\nimport { state, signal } from \"cerebral/tags\";\nimport { Map, Marker, TileLayer } from \"react-leaflet\";\nimport PropTypes from \"prop-types\";\nimport { withStyles } from \"@material-ui/core/styles\";\n\nimport \"./Map.css\";\nimport Lines from \"./Lines/\";\nimport Markers from \"./Markers/\";\n\nconst styles = theme => ({\n  map: {\n    position: \"relative\",\n    display: \"flex\",\n    width: \"100%\",\n    height: \"calc(100% - 56px)\",\n  },\n});\n\nconst mapTiles =\n  \"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}\";\nconst attrib =\n  \"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community\";\n\nclass map extends React.Component {\n  componentDidMount() {\n    this.refs.map.leafletElement.locate();\n  }\n\n  render() {\n    const { classes } = this.props;\n\n    const currentMarker = [];\n    if (this.props.userLocationAvailable) {\n      currentMarker.push(\n        <Marker\n          key={\"user\"}\n          position={[this.props.userLocation.lat, this.props.userLocation.lng]}\n        >\n          zIndexOffset={1}\n        </Marker>,\n      );\n    }\n\n    return (\n      <div className={classes.map}>\n        <Map\n          dragging={true}\n          center={[this.props.targetCenter.lat, this.props.targetCenter.lng]}\n          ref=\"map\"\n          zoom={18}\n          onlocationfound={e =>\n            this.props.storeUserLocation({\n              lat: e.latlng.lat,\n              lng: e.latlng.lng,\n            })\n          }\n          style={{ height: \"100%\", width: \"100%\", position: \"relative\" }}\n        >\n          <TileLayer url={mapTiles} attribution={attrib} />\n          <Markers />\n          <Lines />\n          {currentMarker}\n        </Map>\n      </div>\n    );\n  }\n}\n\nmap.propTypes = {\n  classes: PropTypes.object.isRequired,\n  theme: PropTypes.object.isRequired,\n};\n\nexport default connect(\n  {\n    // states\n    targetCenter: state`map.targetCenter`,\n    userLocation: state`map.userLocation`,\n    userLocationAvailable: state`map.userLocationAvailable`,\n    // signals\n    storeUserLocation: signal`map.storeUserLocation`,\n    selectUnit: signal`diagnostics.selectUnit`,\n  },\n  withStyles(styles, { withTheme: true })(map),\n);\n","import React from \"react\";\nimport { connect } from \"@cerebral/react\";\nimport { state } from \"cerebral/tags\";\nimport {\n  LineChart,\n  Line,\n  CartesianGrid,\n  XAxis,\n  YAxis,\n  ResponsiveContainer,\n  Tooltip,\n} from \"recharts\";\nimport _ from \"lodash\";\nimport { withStyles } from \"@material-ui/core/styles\";\n\nconst styles = theme => ({});\n\nclass Graph extends React.Component {\n  render() {\n    var rawData;\n    if (this.props.selectedUnit && this.props.date && this.props.hour) {\n      rawData = this.props.oada[this.props.connection_id].bookmarks.isoblue[\n        \"device-index\"\n      ][this.props.selectedUnit][\"day-index\"][this.props.date][\"hour-index\"][\n        this.props.hour\n      ];\n    } else {\n      // this should not happen\n      return null;\n    }\n\n    var data = [];\n    var chart;\n    if (this.props.measurement === \"Latency\" && rawData) {\n      _.forEach(Object.values(rawData.heartbeats || {}), value => {\n        value.latency = value.recTime - value.genTime;\n        value.time = new Date(value.genTime * 1000).toLocaleTimeString(\n          \"en-US\",\n          { hour: \"numeric\", minute: \"numeric\" },\n        );\n        data.push(value);\n      });\n\n      chart = (\n        <LineChart\n          data={data}\n          margin={{ top: 20, right: 30, left: 0, bottom: 80 }}\n        >\n          <Line\n            type=\"step\"\n            isAnimationActive={false}\n            dataKey={\"latency\"}\n            stroke=\"#8884d8\"\n          />\n          <CartesianGrid stroke=\"#ccc\" strokeDasharray=\"5 5\" />\n          <XAxis\n            dataKey={\"time\"}\n            label={{ value: \"Time\", position: \"insideBottom\", dy: 20 }}\n          />\n          <YAxis\n            dataKey={\"latency\"}\n            label={{\n              value: \"Latency (sec)\",\n              position: \"insideLeft\",\n              angle: -90,\n            }}\n          />\n          <Tooltip />\n        </LineChart>\n      );\n    } else if (this.props.measurement === \"Wifi RSSI\" && rawData) {\n      _.forEach(Object.values(rawData.heartbeats || {}), value => {\n        _.forEach(value.interfaces, connection => {\n          if (connection.type === \"wifi\") {\n            connection.time = new Date(value.genTime * 1000).toLocaleTimeString(\n              \"en-US\",\n              { hour: \"numeric\", minute: \"numeric\" },\n            );\n            data.push(connection);\n          }\n        });\n      });\n\n      chart = (\n        <LineChart\n          data={data}\n          margin={{ top: 20, right: 30, left: 0, bottom: 80 }}\n        >\n          <Line\n            type=\"step\"\n            isAnimationActive={false}\n            dataKey={\"rssi\"}\n            stroke=\"#8884d8\"\n          />\n          <CartesianGrid stroke=\"#ccc\" strokeDasharray=\"5 5\" />\n          <XAxis dataKey={\"time\"} />\n          <YAxis\n            dataKey={\"rssi\"}\n            label={{\n              value: \"WiFi RSSI (dB)\",\n              position: \"insideLeft\",\n              angle: -90,\n            }}\n          />\n          <Tooltip />\n        </LineChart>\n      );\n    } else if (this.props.measurement === \"Cellular RSSI\" && rawData) {\n      _.forEach(Object.values(rawData.heartbeats || {}), value => {\n        _.forEach(value.interfaces, connection => {\n          if (connection.type === \"cellular\") {\n            connection.time = new Date(value.genTime * 1000).toLocaleTimeString(\n              \"en-US\",\n              { hour: \"numeric\", minute: \"numeric\" },\n            );\n            data.push(connection);\n          }\n        });\n      });\n\n      chart = (\n        <LineChart\n          data={data}\n          margin={{ top: 20, right: 30, left: 0, bottom: 80 }}\n        >\n          <Line\n            type=\"step\"\n            isAnimationActive={false}\n            dataKey={\"rssi\"}\n            stroke=\"#8884d8\"\n          />\n          <CartesianGrid stroke=\"#ccc\" strokeDasharray=\"5 5\" />\n          <XAxis dataKey={\"time\"} />\n          <YAxis\n            dataKey={\"rssi\"}\n            label={{\n              value: \"Cellular RSSI (dB)\",\n              position: \"insideLeft\",\n              angle: -90,\n            }}\n          />\n          <Tooltip />\n        </LineChart>\n      );\n    } else {\n      chart = (\n        <LineChart margin={{ top: 20, right: 30, left: 0, bottom: 80 }} />\n      );\n    }\n\n    return (\n      <ResponsiveContainer width={\"100%\"} height={\"100%\"}>\n        {chart}\n      </ResponsiveContainer>\n    );\n  }\n}\n\nexport default connect(\n  {\n    connection_id: state`data.connection_id`,\n    date: state`diagnostics.date`,\n    hour: state`diagnostics.hour`,\n    selectedUnit: state`diagnostics.selectedUnit`,\n    measurement: state`diagnostics.measurement`,\n    oada: state`oada`,\n    data: state`data`,\n  },\n  withStyles(styles, { withTheme: true })(Graph),\n);\n","import React from \"react\";\nimport { connect } from \"@cerebral/react\";\nimport { state } from \"cerebral/tags\";\n\nimport Map from \"./Map/\";\nimport Graph from \"./Graph/\";\n\nclass Visualization extends React.Component {\n  render() {\n    var graphic;\n    if (this.props.mode === \"map\") {\n      graphic = <Map />;\n    } else {\n      graphic = <Graph />;\n    }\n\n    return graphic;\n  }\n}\n\nexport default connect(\n  {\n    mode: state`diagnostics.mode`,\n  },\n  Visualization,\n);\n","import React from \"react\";\n\nimport { withStyles } from \"@material-ui/core/styles\";\nimport Divider from \"@material-ui/core/Divider\";\nimport List from \"@material-ui/core/List\";\nimport ListItem from \"@material-ui/core/ListItem\";\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\nimport ListItemText from \"@material-ui/core/ListItemText\";\nimport SyncIcon from \"@material-ui/icons/Sync\";\nimport SyncProblemIcon from \"@material-ui/icons/SyncProblem\";\nimport SyncDisabledIcon from \"@material-ui/icons/SyncDisabled\";\n\nimport { connect } from \"@cerebral/react\";\nimport { state, signal } from \"cerebral/tags\";\n\nconst styles = theme => ({\n  list: {\n    width: \"90%\",\n    backgroundColor: theme.palette.background.paper,\n    //position: 'relative',\n    overflow: \"auto\",\n    height: 300,\n    margin: 1.5 * theme.spacing.unit,\n  },\n  textField: {\n    margin: 1.5 * theme.spacing.unit,\n  },\n  healthy: { color: \"#008000\" },\n  sick: { color: \"#ffbf00\" },\n  down: { color: \"#ff0000\" },\n});\n\nclass Summary extends React.Component {\n  render() {\n    const { classes } = this.props;\n\n    // create unit list\n    var units;\n    if (Object.keys(this.props.health || {}).length > 0) {\n      units = (\n        <List className={classes.list} component=\"nav\">\n          {Object.keys(this.props.health).map(unit => (\n            <ListItem\n              button\n              key={`-${unit}`}\n              onClick={() => this.props.selectUnit({ unit: unit })}\n            >\n              <ListItemText primary={unit} />\n              <ListItemIcon>\n                {(() => {\n                  switch (this.props.health[unit]) {\n                    case \"Healthy\":\n                      return <SyncIcon className={classes.healthy} />;\n                    case \"Sick\":\n                      return <SyncProblemIcon className={classes.sick} />;\n                    case \"Down\":\n                      return <SyncDisabledIcon />;\n                    default:\n                      return <SyncDisabledIcon />;\n                  }\n                })()}\n              </ListItemIcon>\n            </ListItem>\n          ))}\n        </List>\n      );\n    } else {\n      units = <List className={classes.list} component=\"nav\" />;\n    }\n\n    // wrapper for unit list\n    return (\n      <List>\n        <ListItem>\n          <ListItemText align=\"center\" primary={\"My ISOBlues:\"} />\n        </ListItem>\n        {units}\n        <Divider />\n      </List>\n    );\n  }\n}\n\nexport default connect(\n  {\n    health: state`health`,\n    selectUnit: signal`diagnostics.selectUnit`,\n  },\n  withStyles(styles)(Summary),\n);\n","import React from \"react\";\nimport { withStyles } from \"@material-ui/core/styles\";\nimport Divider from \"@material-ui/core/Divider\";\nimport List from \"@material-ui/core/List\";\nimport ListItem from \"@material-ui/core/ListItem\";\nimport ListItemText from \"@material-ui/core/ListItemText\";\nimport Button from \"@material-ui/core/Button\";\nimport Select from \"@material-ui/core/Select\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\n\nimport { connect } from \"@cerebral/react\";\nimport { state, signal } from \"cerebral/tags\";\n\nconst styles = theme => ({});\n\nclass Diagnostics extends React.Component {\n  render() {\n    const visualizing = (\n      <ListItem>\n        <ListItemText align=\"center\">\n          <Button onClick={() => this.props.toggleMode({})} variant=\"contained\">\n            {this.props.mode === \"map\" ? \"Show Statistics\" : \"Show Map\"}\n          </Button>\n        </ListItemText>\n      </ListItem>\n    );\n\n    var measurements;\n    if (this.props.mode === \"map\") {\n      measurements = [\"GPS\"];\n    } else {\n      measurements = [\"Latency\", \"Wifi RSSI\", \"Cellular RSSI\"];\n    }\n    const measurementSelect = (\n      <Select\n        value={this.props.measurement}\n        renderValue={value => `${value}`}\n        onChange={value =>\n          this.props.setMeasurement({ measurement: value.target.value })\n        }\n      >\n        {measurements.map(measurement => (\n          <MenuItem key={measurement} value={measurement}>\n            {measurement}\n          </MenuItem>\n        ))}\n      </Select>\n    );\n\n    const dateSelect = (\n      <Select\n        value={this.props.date}\n        renderValue={value => `${value}`}\n        onChange={value => this.props.setDate({ date: value.target.value })}\n      >\n        {Object.keys(\n          this.props.oada[this.props.connection_id].bookmarks.isoblue[\n            \"device-index\"\n          ][this.props.selectedUnit][\"location\"][\"day-index\"],\n        ).map(date => (\n          <MenuItem key={date} value={date}>\n            {date}\n          </MenuItem>\n        ))}\n        ;\n      </Select>\n    );\n\n    const hourSelect = (\n      <Select\n        value={this.props.hour}\n        renderValue={value => `${value}`}\n        onChange={value => this.props.setHour({ hour: value.target.value })}\n      >\n        {Object.keys(\n          this.props.oada[this.props.connection_id].bookmarks.isoblue[\n            \"device-index\"\n          ][this.props.selectedUnit][\"location\"][\"day-index\"][this.props.date][\n            \"hour-index\"\n          ],\n        ).map(hour => (\n          <MenuItem key={hour} value={hour}>\n            {hour}\n          </MenuItem>\n        ))}\n        ;\n      </Select>\n    );\n\n    return (\n      <List>\n        <ListItem>\n          <ListItemText align=\"center\" primary={\"Selected Unit:\"} />\n        </ListItem>\n        <ListItem>\n          <ListItemText align=\"center\" primary={this.props.selectedUnit} />\n        </ListItem>\n        <Divider />\n        <ListItem>\n          <ListItemText align=\"center\" primary=\"ISOBlue Status:\" />\n        </ListItem>\n        <ListItem>\n          <ListItemText align=\"center\" primary={\"Health:\"} />\n          <ListItemText\n            align=\"center\"\n            primary={this.props.snapshots[this.props.selectedUnit].health}\n          />\n        </ListItem>\n        <ListItem>\n          <ListItemText align=\"center\" primary={\"Last Report:\"} />\n          <ListItemText\n            align=\"center\"\n            primary={\n              this.props.snapshots[this.props.selectedUnit].lastReport === \"NA\"\n                ? \"NA\"\n                : this.props.snapshots[this.props.selectedUnit]\n                    .lastLocationReport + \" min\"\n            }\n          />\n        </ListItem>\n        <Divider />\n        <ListItem>\n          <ListItemText align=\"center\" primary={\"Available Data:\"} />\n        </ListItem>\n        <ListItem>\n          <ListItemText align=\"center\">{measurementSelect}</ListItemText>\n        </ListItem>\n        <ListItem>\n          <ListItemText align=\"center\">{dateSelect}</ListItemText>\n        </ListItem>\n        <ListItem>\n          <ListItemText align=\"center\">{hourSelect}</ListItemText>\n        </ListItem>\n        {visualizing}\n        <Divider />\n        <ListItem>\n          <ListItemText align=\"center\">\n            <Button\n              variant=\"contained\"\n              onClick={() => this.props.unselectUnit({})}\n            >\n              Back to Main\n            </Button>\n          </ListItemText>\n        </ListItem>\n      </List>\n    );\n  }\n}\n\nexport default connect(\n  {\n    date: state`diagnostics.date`,\n    hour: state`diagnostics.hour`,\n    measurement: state`diagnostics.measurement`,\n    selectedUnit: state`diagnostics.selectedUnit`,\n    snapshots: state`snapshots`,\n    data: state`data`,\n    mode: state`diagnostics.mode`,\n    oada: state`oada`,\n    connection_id: state`data.connection_id`,\n\n    selectUnit: signal`diagnostics.selectUnit`,\n    unselectUnit: signal`diagnostics.unselectUnit`,\n    setDate: signal`diagnostics.setDate`,\n    setHour: signal`diagnostics.setHour`,\n    setMeasurement: signal`diagnostics.setMeasurement`,\n    toggleMode: signal`diagnostics.toggleMode`,\n  },\n  withStyles(styles)(Diagnostics),\n);\n","import React from \"react\";\nimport { connect } from \"@cerebral/react\";\nimport { state, signal } from \"cerebral/tags\";\n\nimport { withStyles } from \"@material-ui/core/styles\";\nimport Drawer from \"@material-ui/core/Drawer\";\n\nimport Summary from \"./Summary/\";\nimport Diagnostics from \"./Diagnostics/\";\n\nconst styles = theme => ({\n  drawerPaper: {\n    position: \"relative\",\n    width: 240,\n    backgroundColor: \"#eeeeee\",\n  },\n  toolbar: theme.mixins.toolbar,\n});\n\nclass DrawerContent extends React.Component {\n  render() {\n    const { classes } = this.props;\n\n    var content;\n    if (this.props.selectedUnit) {\n      content = <Diagnostics />;\n    } else {\n      content = <Summary />;\n    }\n\n    return (\n      <Drawer\n        open={this.props.drawerOpen}\n        onClose={() => this.props.toggleDrawerOpen({})}\n        classes={{\n          paper: classes.drawerPaper,\n        }}\n      >\n        <div className={classes.toolbar} />\n        {content}\n      </Drawer>\n    );\n  }\n}\n\nexport default connect(\n  {\n    selectedUnit: state`diagnostics.selectedUnit`,\n    drawerOpen: state`session.drawerOpen`,\n\n    toggleDrawerOpen: signal`session.toggleDrawerOpen`,\n  },\n  withStyles(styles)(DrawerContent),\n);\n","import React from \"react\";\nimport { connect } from \"@cerebral/react\";\nimport {\n  TextField,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n} from \"@material-ui/core\";\nimport Dialog from \"@material-ui/core/Dialog\";\nimport Button from \"@material-ui/core/Button\";\nimport { state, signal } from \"cerebral/tags\";\n\nexport default connect(\n  {\n    oadaDomainText: state`connection.oada_domain_text`,\n    open: state`connection.dialog_open`,\n\n    submitClicked: signal`connection.setConnection`,\n    oadaDomainChanged: signal`connection.updateOadaDomain`,\n  },\n\n  class ConnectDialog extends React.Component {\n    render() {\n      return (\n        <Dialog open={this.props.open} className={\"connection-dialog\"}>\n          <DialogTitle id=\"form-dialog-title\">\n            Connect to OADA Server\n          </DialogTitle>\n          <DialogContent>Please enter the domain of OADA server.</DialogContent>\n          <DialogContent>\n            <TextField\n              autoFocus\n              label=\"Domain\"\n              value={this.props.oadaDomainText}\n              onChange={e =>\n                this.props.oadaDomainChanged({ value: e.target.value })\n              }\n              margin=\"dense\"\n              fullwidth=\"true\"\n            />\n          </DialogContent>\n          <DialogActions>\n            <Button\n              onClick={() => {\n                this.props.open = false;\n              }}\n              color=\"secondary\"\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={() => {\n                this.props.submitClicked({});\n              }}\n              color=\"secondary\"\n            >\n              Submit\n            </Button>\n          </DialogActions>\n        </Dialog>\n      );\n    }\n  },\n);\n","import React from \"react\";\nimport { connect } from \"@cerebral/react\";\nimport { signal } from \"cerebral/tags\";\n\nimport { withStyles } from \"@material-ui/core/styles\";\nimport AppBar from \"@material-ui/core/AppBar\";\n\nimport AppBarContent from \"../AppBarContent/\";\nimport Visualization from \"../Visualization/\";\nimport DrawerContent from \"../DrawerContent/index.js\";\nimport ConnectDialog from \"../ConnectDialog/index.js\";\n\nconst styles = theme => ({\n  root: {\n    flexGrow: 1,\n    height: \"100vh\",\n    zIndex: 1,\n    overflow: \"hidden\",\n    position: \"relative\",\n    display: \"flex\",\n  },\n  appBar: {\n    zIndex: theme.zIndex.drawer + 1,\n  },\n  content: {\n    flexGrow: 1,\n  },\n  toolbar: theme.mixins.toolbar,\n});\n\nclass App extends React.Component {\n  componentWillMount() {\n    this.props.init({});\n  }\n\n  render() {\n    const { classes } = this.props;\n\n    return (\n      <div className={classes.root}>\n        <AppBar position=\"absolute\" className={classes.appBar}>\n          <AppBarContent />\n        </AppBar>\n        <DrawerContent />\n        <main className={classes.content}>\n          <div className={classes.toolbar} />\n          <Visualization />\n        </main>\n        <ConnectDialog />\n      </div>\n    );\n  }\n}\n\nexport default connect(\n  {\n    init: signal`init`,\n  },\n  withStyles(styles, { withTheme: true })(App),\n);\n","import { sequence } from \"cerebral\";\nimport { state } from \"cerebral/tags\";\nimport { toggle } from \"cerebral/operators\";\n\nexport const toggleDrawerOpen = sequence(\"toggleDrawerOpen\", [\n  toggle(state`session.drawerOpen`),\n]);\n","import { Module } from \"cerebral\";\nimport * as signals from \"./sequences\";\n\nexport default Module({\n  state: {\n    drawerOpen: false,\n    dataReady: false,\n  },\n  signals,\n});\n","import { sequence } from \"cerebral\";\nimport { state } from \"cerebral/tags\";\nimport { set, debounce } from \"cerebral/operators\";\nimport _ from \"lodash\";\n\nexport const storeUserLocation = sequence(\"storeUserLocation\", [\n  ({ state, props }) =>\n    state.set(\"map.userLocation\", { lat: props.lat, lng: props.lng }),\n  set(state`map.userLocationAvailable`, true),\n]);\n\nexport const centerOnUser = sequence(\"centerOnUser\", [\n  set(state`map.targetCenter`, { lat: 40.428641, lng: -86.913783 }),\n  debounce(1),\n  {\n    continue: [set(state`map.targetCenter`, state`map.userLocation`)],\n    discard: [],\n  },\n]);\n\nexport const centerOnUnit = sequence(\"centerOnUnit\", [\n  set(state`map.targetCenter`, { lat: 40.428641, lng: -86.913783 }),\n  debounce(1),\n  {\n    continue: [\n      set(\n        state`map.targetCenter`,\n        state`snapshots.${state`diagnostics.selectedUnit`}.location`,\n      ),\n    ],\n    discard: [],\n  },\n]);\n","import { sequence } from \"cerebral\";\nimport { state, props } from \"cerebral/tags\";\nimport { set } from \"cerebral/operators\";\nimport _ from \"lodash\";\nimport oada from \"@oada/cerebral-module/sequences\";\n\nvar masterTree = {\n  bookmarks: {\n    _type: \"application/vnd.oada.bookmarks.1+json\",\n    _rev: \"0-0\",\n    isoblue: {\n      _type: \"application/vnd.oada.isoblue.1+json\",\n      _rev: \"0-0\",\n      \"device-index\": {\n        \"*\": {\n          _type: \"application/vnd.oada.isoblue.device.1+json\",\n          _rev: \"0-0\",\n          \"*\": {\n            _type: \"application/vnd.oada.isoblue.dataset.1+json\",\n            _rev: \"0-0\",\n            \"day-index\": {\n              \"*\": {\n                _type: \"application/vnd.oada.isoblue.day.1+json\",\n                _rev: \"0-0\",\n                \"hour-index\": {\n                  \"*\": {\n                    _type: \"application/vnd.oada.isoblue.hour.1+json\",\n                  },\n                },\n              },\n            },\n          },\n        },\n      },\n    },\n  },\n};\n\nvar dayTree = {\n  bookmarks: {\n    _type: \"applications/vnd.oada.bookmarks.1+json\",\n    _rev: \"0-0\",\n    isoblue: {\n      _type: \"applications/vnd.oada.isoblue.1+json\",\n      _rev: \"0-0\",\n      \"device-index\": {\n        \"*\": {\n          _type: \"applications/vnd.oada.isoblue.device.1+json\",\n          _rev: \"0-0\",\n          \"*\": {\n            _type: \"application/vnd.oada.isoblue.dataset.1+json\",\n            _rev: \"0-0\",\n            \"day-index\": {\n              \"*\": {\n                _type: \"applications/vnd.oada.isoblue.day.1+json\",\n                _rev: \"0-0\",\n              },\n            },\n          },\n        },\n      },\n    },\n  },\n};\n\nvar deviceTree = {\n  bookmarks: {\n    _type: \"applications/vnd.oada.bookmarks.1+json\",\n    _rev: \"0-0\",\n    isoblue: {\n      _type: \"applications/vnd.oada.isoblue.1+json\",\n      _rev: \"0-0\",\n      \"device-index\": {\n        \"*\": {\n          _type: \"applications/vnd.oada.isoblue.device.1+json\",\n          _rev: \"0-0\",\n          \"*\": {\n            _type: \"application/vnd.oada.isoblue.dataset.1+json\",\n            _rev: \"0-0\",\n          },\n        },\n      },\n    },\n  },\n};\n\n/* Set requests */\nfunction setRequestLastHour({ state, props }) {\n  const devices = Object.keys(\n    state.get(`oada.${props.connection_id}.bookmarks.isoblue.device-index`) ||\n      {},\n  );\n\n  var requests = []; // OADA requests\n\n  devices.forEach(device_name => {\n    var device_data =\n      state.get(\n        `oada.${\n          props.connection_id\n        }.bookmarks.isoblue.device-index.${device_name}.location.day-index`,\n      ) || {};\n\n    // find the most recent day\n    const date_list = Object.keys(device_data);\n    if (date_list.length === 0) {\n      return;\n    }\n    const last_date = _.maxBy(date_list, function(o) {\n      return new Date(o);\n    });\n\n    //find the most recent hour\n    const last_hour = _.max(\n      Object.keys(device_data[last_date][\"hour-index\"] || {}),\n    );\n\n    // add request\n    requests.push({\n      path: `/bookmarks/isoblue/device-index/${device_name}/location/day-index/${last_date}/hour-index/${last_hour}`,\n      watch: { signals: [\"snapshots.createSnapshots\"] },\n      tree: masterTree,\n    });\n  });\n\n  return { requests };\n}\n\n/* Called when the device list was modified */\nexport const handleDeviceUpdate = sequence(\"data.handleDeviceUpdate\", [\n  set(state`data.ready`, false),\n  setRequestLastHour,\n  oada.get,\n  set(state`data.ready`, true),\n]);\n\n// Get devices and watch for changes\nexport const getDevices = sequence(\"data.getDevices\", [\n  // get devices\n  ({ state, props }) => ({\n    requests: [\n      {\n        path: \"/bookmarks/isoblue\",\n        tree: dayTree,\n        watch: { signals: [\"data.handleDeviceUpdate\"] },\n      },\n    ],\n  }),\n  oada.get,\n]);\n\n/* Initial sequence. Only called at startup. */\nexport const init = sequence(\"data.init\", [\n  set(state`data.ready`, false),\n  set(state`health`, {}),\n  // connect to server\n  set(state`data.connection_id`, props`connection_id`),\n\n  // get most recent data\n  getDevices,\n  setRequestLastHour,\n  oada.get,\n  set(state`data.ready`, true),\n]);\n\n/* Set request to OADA server based on currently selected device, date, and hour */\nexport const getHour = sequence(\"data.getHour\", [\n  ({ state, props }) => ({\n    requests: [\n      {\n        connection_id: state.get(\"data.connection_id\"),\n        path: `/bookmarks/isoblue/device-index/${state.get(\n          `diagnostics.selectedUnit`,\n        )}/location/day-index/${state.get(\n          `diagnostics.date`,\n        )}/hour-index/${state.get(`diagnostics.hour`)}`,\n        tree: masterTree,\n      },\n    ],\n  }),\n  oada.get,\n]);\n","import { sequence } from \"cerebral\";\nimport { state, props } from \"cerebral/tags\";\nimport { set, when } from \"cerebral/operators\";\nimport _ from \"lodash\";\nimport * as map from \"../map/sequences\";\nimport * as data from \"../data/sequences\";\n\nexport const setDate = sequence(\"setDate\", [\n  set(state`diagnostics.date`, props`date`),\n  ({ state, props }) =>\n    state.set(\n      \"diagnostics.hour\",\n      _.max(\n        Object.keys(\n          state.get(\n            `oada.${state.get(\n              \"data.connection_id\",\n            )}.bookmarks.isoblue.device-index.${state.get(\n              \"diagnostics.selectedUnit\",\n            )}.location.day-index.${state.get(\"diagnostics.date\")}.hour-index`,\n          ),\n        ),\n      ),\n    ),\n  data.getHour,\n  map.centerOnUnit,\n]);\n\nexport const setHour = sequence(\"setHour\", [\n  set(state`diagnostics.hour`, props`hour`),\n  data.getHour,\n  map.centerOnUnit,\n]);\n\nexport const setMeasurement = sequence(\"setMeasurement\", [\n  ({ state, props }) => state.set(\"diagnostics.measurement\", props.measurement),\n]);\n\n/* Set the selected unit, default date, and hour */\nexport const selectUnit = sequence(\"selectUnit\", [\n  ({ state, props }) => ({ connection_id: state.get(\"data.connection_id\") }),\n  set(state`diagnostics.selectedUnit`, props`unit`),\n\n  // set default date and hour\n  ({ state, props }) => {\n    const date = Object.keys(\n      state.get(\n        `oada.${props.connection_id}.bookmarks.isoblue.device-index.${\n          props.unit\n        }.location.day-index`,\n      ),\n    ).sort((a, b) => {\n      return new Date(b) - new Date(a);\n    })[0];\n\n    const hour = _.max(\n      Object.keys(\n        state.get(\n          `oada.${props.connection_id}.bookmarks.isoblue.device-index.${\n            props.unit\n          }.location.day-index.${date}.hour-index`,\n        ),\n      ),\n    );\n\n    state.set(\"diagnostics.date\", date);\n    state.set(\"diagnostics.hour\", hour);\n  },\n\n  // center the map\n  map.centerOnUnit,\n]);\n\nexport const unselectUnit = sequence(\"unselectUnit\", [\n  set(state`diagnostics.selectedUnit`, null),\n  set(state`diagnostics.date`, null),\n  set(state`diagnostics.hour`, null),\n]);\n\n/* Toggle map view and graph view */\nexport const toggleMode = sequence(\"toggleMode\", [\n  when(state`diagnostics.mode`, value => value === \"map\"),\n  {\n    true: [\n      set(state`diagnostics.mode`, \"graph\"),\n      set(state`diagnostics.measurement`, \"Latency\"),\n    ],\n    false: [\n      set(state`diagnostics.mode`, \"map\"),\n      set(state`diagnostics.measurement`, \"GPS\"),\n    ],\n  },\n]);\n","import { Module } from 'cerebral';\nimport * as signals from './sequences';\n\nexport default Module({\n  state: {\n    hour: null,\n    measurement: 'GPS',\n    selectedUnit: null,\n    date: null,\n    mode: \"map\",\n  },\n  signals,\n});\n","import { Module } from 'cerebral';\nimport * as signals from './sequences';\n\nexport default Module({\n\n  state: {\n    targetCenter: { lat: 40.428641, lng: -86.913783 },\n    userLocation: { lat: 40.428641, lng: -86.913783 },\n    userLocationAvailable: false,\n  },\n\n  signals,\n\n});\n","import { Module } from \"cerebral\";\nimport * as signals from \"./sequences\";\n\nexport default Module({\n  //state: stateTree,\n  //state: {},\n\n  signals,\n});\n","import { sequence } from \"cerebral\";\nimport { state, props } from \"cerebral/tags\";\nimport { set } from \"cerebral/operators\";\nimport _ from \"lodash\";\n\nexport const createSnapshots = sequence(\"createSnapshots\", [\n  ({ state, props }) => ({\n    units: _.reduce(\n      Object.keys(\n        state.get(\n          `oada.${props.connection_id}.bookmarks.isoblue.device-index`,\n        ) || {},\n      ),\n      (acc, unit, unitkey) => {\n        // iterate over all the ISOBlue units\n        var unitLocationData = state.get(\n          `oada.${\n            props.connection_id\n          }.bookmarks.isoblue.device-index.${unit}.location.day-index`,\n        );\n        //var health, location, connection, lastReport;\n        const lastDate = _.maxBy(Object.keys(unitLocationData || {}), function(\n          o,\n        ) {\n          return new Date(o);\n        });\n\n        if (!lastDate) return acc;\n        if (!unitLocationData[lastDate].hasOwnProperty(\"hour-index\"))\n          return acc;\n\n        const lastHour = _.max(\n          Object.keys(unitLocationData[lastDate][\"hour-index\"] || {}),\n        );\n\n        if (!lastHour) return acc;\n        var lastGPS =\n          _.max(\n            Object.keys(\n              unitLocationData[lastDate][\"hour-index\"][lastHour][\"sec-index\"] ||\n                {},\n            ),\n          ) || null;\n\n        // get messages\n        const msg_gps = lastGPS\n          ? unitLocationData[lastDate][\"hour-index\"][lastHour][\"sec-index\"][\n              lastGPS\n            ]\n          : null;\n        // const msg_hb = lastHeartbeat\n        //   ? unitData[lastDate][\"hour-index\"][lastTime][\"heartbeats\"][\n        //       lastHeartbeat\n        //     ]\n        //   : null;\n        if (msg_gps) {\n          var lastLocationReport = Math.round(\n            (Math.round(new Date().getTime() / 1000) - lastGPS) / 60,\n          );\n\n          var latency = null;\n          // if (\n          //   msg_hb.hasOwnProperty(\"recTime\") &&\n          //   msg_hb.hasOwnProperty(\"genTime\")\n          // ) {\n          //   latency = msg_hb.recTime - msg_hb.genTime;\n          // }\n\n          var health = null;\n          if (lastLocationReport < 2) {\n            if (latency < 20) {\n              health = \"Healthy\";\n            } else {\n              health = \"Sick\";\n            }\n          } else if (lastLocationReport < 10) {\n            health = \"Sick\";\n          } else {\n            health = \"Down\";\n          }\n\n          var location = null;\n          if (msg_gps.hasOwnProperty(\"lat\") && msg_gps.hasOwnProperty(\"lng\")) {\n            location = msg_gps;\n          }\n\n          var connection = null;\n\n          acc[unit] = {\n            health,\n            connection,\n            location,\n            lastLocationReport,\n            lastHeartbeatTime: lastLocationReport,\n          };\n          state.set(`health.${unit}`, health);\n        } else {\n          acc[unit] = {\n            health: \"Down\",\n            connection: null,\n            location: null,\n            lastReport: \"NA\",\n            lastHeartbeatTime: 60,\n          };\n          state.set(`health.${unit}`, \"Down\");\n        }\n        return acc;\n      },\n      {},\n    ),\n  }),\n  set(state`snapshots`, props`units`),\n]);\n","import { Module } from 'cerebral';\nimport * as signals from './sequences'\n\nexport default Module({\n  state: {\n  },\n  signals,\n});\n\n\n","/* cerebral imports */\nimport { state, props } from \"cerebral/tags\";\nimport { set } from \"cerebral/operators\";\nimport oada from \"@oada/cerebral-module/sequences\";\nimport * as data from \"../data/sequences\";\nimport * as snapshots from \"../snapshots/sequences\";\n\nconst _SCOPE = \"oada.isoblue:all\";\nconst _OPENATK_METADATA =\n  \"eyJqa3UiOiJodHRwczovL2lkZW50aXR5Lm9hZGEtZGV2LmNvbS9jZXJ0cyIsImtpZCI6ImtqY1NjamMzMmR3SlhYTEpEczNyMTI0c2ExIiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJyZWRpcmVjdF91cmlzIjpbImh0dHBzOi8vb3BlbmF0ay5jb20vSVNPQmx1ZUFwcC9vYXV0aDIvcmVkaXJlY3QuaHRtbCIsImh0dHA6Ly9sb2NhbGhvc3Q6ODAwMC9vYXV0aDIvcmVkaXJlY3QuaHRtbCJdLCJ0b2tlbl9lbmRwb2ludF9hdXRoX21ldGhvZCI6InVybjppZXRmOnBhcmFtczpvYXV0aDpjbGllbnQtYXNzZXJ0aW9uLXR5cGU6and0LWJlYXJlciIsImdyYW50X3R5cGVzIjpbImF1dGhvcml6YXRpb25fY29kZSJdLCJyZXNwb25zZV90eXBlcyI6WyJ0b2tlbiIsImNvZGUiLCJpZF90b2tlbiIsImlkX3Rva2VuIHRva2VuIiwiY29kZSBpZF90b2tlbiIsImNvZGUgdG9rZW4iLCJjb2RlIGlkX3Rva2VuIHRva2VuIl0sImNsaWVudF9uYW1lIjoiSVNPQmx1ZSBIZWFsdGggTW9uaXRvciIsImNsaWVudF91cmkiOiJodHRwOi8vb2FkYS5vcGVuYXRrLmNvbS9JU09CbHVlQXBwIiwiY29udGFjdHMiOlsiU2FtIE5vZWwgPHNhbm9lbEBwdXJkdWUuZWR1PiJdLCJqd2tzIjp7ImtleXMiOlt7Imt0eSI6IlJTQSIsIm4iOiJ6YXVaRkJ1TWRsdjFrWWp6VWI0cS1fM200c21GeG5mdzRTWW9hSHE3Y2k4U2N0WTN4ajdyZEFIeWtRcG5RVnJqNktPOG1hSHYtMEJ2VzVNaGNnaXZrdVlzLXpIRXZmWUJlVkJuY3ZIZ09rSlBiYzkxQ3dfaXdPWTdFSFdCOGhNN1ZpTFFWY19EdjBoOG5KeWJCdmhMMDRDSFF0N0NwTXRWWUc2Zm9KWGMzZHE1MmpOUWJCSElaNW03VnoxS3R5em9MY3A4TzJtaGFMcDQ1VXIzQ18xZUd0djhuNU56OWJXX0JoNVhGWWJEeHY3Qm5oWk5JdzFHQ2JqakF3bXRibm5MN0dnZjRDeTYwd1JIbVI0dm9lMjFPSWpvQVNxMmpaMDN4MTJtWHM3SFBJM1lCNHkyOXd2Wk13MmdMek9kVG9ycnFPLXRsbW4xYm9Qa1dLSkpTWG9BdnciLCJlIjoiQVFBQiJ9XX0sInNvZnR3YXJlX2lkIjoiNzY1ZjFlZjctMzExNy00NjhhLTgwYjMtMDExYzQ1MjhkMGExIiwicmVnaXN0cmF0aW9uX3Byb3ZpZGVyIjoiaHR0cHM6Ly9pZGVudGl0eS5vYWRhLWRldi5jb20iLCJpYXQiOjE1NDcxNDYxOTF9.seH7eMsR1218IgEEbiq3T5ASGQAr7vqvy54_Yu8-6TIoAoVfslG-dSYWE2dXZ_P65kElqCKZLizVxyR1732vcFnOdzp6jE_pgpLg-eWZfVnIvNQdGK8Dh-5t1gVbPs1ME-j_GMCb2Un-mpDS8LAw4Nig_r-monjKyKbcPBN6gc4\";\n\nconst _REDIRECT_OPENATK = \"https://openatk.com/ISOBlueApp/oauth2/redirect.html\"; // for production\nconst _REDIRECT_LOCALHOST = \"http://localhost:8000/oauth2/redirect.html\"; // for local test\n\nconst _CURRENT_METADATA = _OPENATK_METADATA;\nconst _CURRENT_REDIRECT =\n  process.env.NODE_ENV === \"production\"\n    ? _REDIRECT_OPENATK\n    : _REDIRECT_LOCALHOST;\n\nexport var signOut = [\n  set(state`Connections.oada_token`, \"\"),\n  set(state`Connections.oada_domain`, \"\"),\n  set(state`Connections.oada_fields_domain`, \"\"),\n  set(state`Connections.oada_domain_text`, \"\"),\n  set(state`Connections.oada_fields_domain_text`, \"\"),\n];\n\nexport var updateOadaDomain = [\n  set(state`connection.oada_domain_text`, props`value`),\n];\n\nexport var connect = [\n  ({ state }) => ({\n    domain: state.get(\"connection.oada_domain\"),\n    options: {\n      redirect: _CURRENT_REDIRECT,\n      metadata: _CURRENT_METADATA,\n      scope: _SCOPE,\n    },\n    //    connection_id: state.get(\"operations.connection_id\"),\n    //    signals: [\"fields.handleWatchUpdate\"],\n  }),\n  oada.connect,\n  set(state`data.connection_id`, props`connection_id`), // FIXME: remove this line\n  set(state`connection.connection_id`, props`connection_id`),\n  set(state`connection.dialog_open`, false),\n];\n\nexport var setConnection = [\n  set(state`connection.oada_domain`, state`connection.oada_domain_text`),\n  connect,\n  data.init,\n  snapshots.createSnapshots,\n];\n\nfunction clearConnection({ state, props }) {\n  const connection_id = state.get(\"connection.connection_id\");\n  /* cleaning up connections from oada state */\n  state.unset(\"oada.connections\");\n  /* cleaning up previous connection_id from oada state */\n  state.unset(\"oada.\" + connection_id);\n}\n","import { Module } from \"cerebral\";\nimport oadaProvider from \"@oada/cerebral-provider\";\nimport * as signals from \"./sequences\";\n\nlet _OADA_HOST = \"https://oada.openatk.com\";\nlet _CURRENT_HOST = _OADA_HOST;\n\nexport default Module({\n  state: {\n    dialog_open: true,\n    oada_domain_text: _CURRENT_HOST,\n    oada_domain: _CURRENT_HOST,\n  },\n  signals,\n  providers: {\n    oada: oadaProvider,\n  },\n});\n","import { sequence } from \"cerebral\";\n\nexport const init = sequence(\"init\", []);\n","import { Module } from \"cerebral\";\n\nimport session from \"../session/\";\nimport diagnostics from \"../diagnostics/\";\nimport map from \"../map/\";\nimport data from \"../data/\";\nimport snapshots from \"../snapshots/\";\nimport connection from \"../connection/\";\nimport oadaModule from \"@oada/cerebral-module\";\nimport oadaProvider from \"@oada/cerebral-provider\";\nimport * as signals from \"./sequences\";\n\nexport default Module({\n  modules: {\n    connection,\n    session,\n    oada: oadaModule,\n    diagnostics,\n    map,\n    data,\n    snapshots,\n  },\n  signals,\n  providers: {\n    oada: oadaProvider,\n  },\n});\n","import { Controller } from \"cerebral\";\nimport root from \"./modules/root\";\nimport Devtools from \"cerebral/devtools\";\n\nexport default Controller(root, {\n  // devtools:\n  //   process.env.NODE_ENV === \"production\"\n  //     ? null\n  //     : Devtools({ host: \"local host:8787\" }),\n  devtools: null,\n});\n","import React from \"react\";\nimport { render } from \"react-dom\";\nimport { MuiThemeProvider, createMuiTheme } from \"@material-ui/core/styles\";\nimport App from \"./components/App/\";\n\nimport { Container } from \"@cerebral/react\";\nimport controller from \"./controller\";\n\nconst theme = createMuiTheme({\n  typography: {\n    useNextVariants: true,\n  },\n});\n\nrender(\n  <Container controller={controller}>\n    <MuiThemeProvider theme={theme}>\n      <App />\n    </MuiThemeProvider>\n  </Container>,\n  document.getElementById(\"root\"),\n);\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _keys = require(\"babel-runtime/core-js/object/keys\");\n\nvar _keys2 = _interopRequireDefault(_keys);\n\nvar _typeof2 = require(\"babel-runtime/helpers/typeof\");\n\nvar _typeof3 = _interopRequireDefault(_typeof2);\n\nvar _asyncToGenerator2 = require(\"babel-runtime/helpers/asyncToGenerator\");\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _cache = require(\"./cache\");\n\nvar _cache2 = _interopRequireDefault(_cache);\n\nvar _uuid = require(\"uuid\");\n\nvar _uuid2 = _interopRequireDefault(_uuid);\n\nvar _lodash = require(\"lodash\");\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar Promise = require(\"bluebird\");\n\nvar pretty = require(\"prettyjson\");\n\nvar urlLib = require(\"url\");\n\nvar pointer = require(\"json-pointer\");\n\nvar ws = require(\"./websocket\");\n\nvar axios = require(\"axios\");\n\nvar _TOKEN = require(\"./token\"); //const error = require('debug')('oada-cache:index:error');\n//const info = require('debug')('oada-cache:index:info');\n\n\nvar connect = function () {\n  var _ref2 = (0, _asyncToGenerator3.default)(\n  /*#__PURE__*/\n  _regenerator2.default.mark(function _callee18(_ref) {\n    var _makeResourceAndLink = function () {\n      var _ref4 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee(_ref3, waitTime) {\n        var path = _ref3.path,\n            data = _ref3.data,\n            headers = _ref3.headers;\n        var linkReq, resReq, link, pathPieces, parentPath, response, newHeaders, resource;\n        return _regenerator2.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                //info('_makeResourceAndLink', path, data)\n                data._id = _lodash2.default.clone(data._id) || \"resources/\" + (0, _uuid2.default)();\n                linkReq = {\n                  path: path,\n                  type: data._type,\n                  headers: headers,\n                  data: {\n                    _id: data._id\n                  }\n                }; // Create a versioned link if the tree specifies one.\n\n                if ('_rev' in data) {\n                  linkReq.data._rev = 0;\n                } // We don't want to attempt to set the rev when we put the resource\n\n\n                resReq = {\n                  path: \"/\" + data._id,\n                  type: data._type,\n                  data: data\n                };\n                _context.prev = 4;\n                _context.next = 7;\n                return put(linkReq);\n\n              case 7:\n                link = _context.sent;\n                _context.next = 50;\n                break;\n\n              case 10:\n                _context.prev = 10;\n                _context.t0 = _context[\"catch\"](4);\n\n                if (!(_context.t0.response && _context.t0.response.status === 412)) {\n                  _context.next = 49;\n                  break;\n                }\n\n                pathPieces = path.split(\"/\");\n                parentPath = pathPieces.splice(0, pathPieces.length - 1).join(\"/\"); // Wait time increases: 1s, 2s, 4s, 8s, 16s. Throw after 16s.\n\n                if (!(waitTime > 16000)) {\n                  _context.next = 17;\n                  break;\n                }\n\n                throw _context.t0;\n\n              case 17:\n                _context.prev = 17;\n                _context.next = 20;\n                return NOCACHEREQUEST({\n                  method: \"get\",\n                  url: DOMAIN + parentPath,\n                  headers: {\n                    Authorization: \"Bearer \" + TOKEN\n                  }\n                });\n\n              case 20:\n                response = _context.sent;\n                _context.next = 29;\n                break;\n\n              case 23:\n                _context.prev = 23;\n                _context.t1 = _context[\"catch\"](17);\n                waitTime = waitTime || 1000;\n                _context.next = 28;\n                return Promise.delay(waitTime);\n\n              case 28:\n                return _context.abrupt(\"return\", _makeResourceAndLink({\n                  path: path,\n                  data: data,\n                  headers: headers\n                }, waitTime * 2));\n\n              case 29:\n                if (!response.data[pathPieces[pathPieces.length - 1]]) {\n                  _context.next = 41;\n                  break;\n                }\n\n                resReq.data._id = response.data[pathPieces[pathPieces.length - 1]]._id;\n                resReq.path = '/' + resReq.data._id; // Concurrent put, delete, put (delete.test.js #15) can produce situations where _id is undefined\n\n                if (resReq.data._id) {\n                  _context.next = 39;\n                  break;\n                }\n\n                waitTime = waitTime || 1000;\n                _context.next = 36;\n                return Promise.delay(waitTime);\n\n              case 36:\n                newHeaders = _lodash2.default.cloneDeep(headers); //TODO: use if-match headers???\n\n                newHeaders['if-match'] = parseInt(response.headers['x-oada-rev']);\n                return _context.abrupt(\"return\", _makeResourceAndLink({\n                  path: path,\n                  data: data,\n                  headers: newHeaders\n                }, waitTime * 2));\n\n              case 39:\n                _context.next = 47;\n                break;\n\n              case 41:\n                // The key does not yet exist, adjust the if-match and try again.\n                waitTime = waitTime || 1000;\n                _context.next = 44;\n                return Promise.delay(waitTime);\n\n              case 44:\n                newHeaders = _lodash2.default.cloneDeep(headers);\n                newHeaders['if-match'] = parseInt(response.headers['x-oada-rev']);\n                return _context.abrupt(\"return\", _makeResourceAndLink({\n                  path: path,\n                  data: data,\n                  headers: newHeaders\n                }, waitTime * 2));\n\n              case 47:\n                _context.next = 50;\n                break;\n\n              case 49:\n                throw _context.t0;\n\n              case 50:\n                // Delete the _rev  and _id keys. No need for them in the resource object. They will break things.\n                if ('_rev' in data) delete resReq.data._rev;\n                _context.next = 53;\n                return put(resReq);\n\n              case 53:\n                resource = _context.sent;\n                return _context.abrupt(\"return\", {\n                  link: link,\n                  resource: resource\n                });\n\n              case 55:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[4, 10], [17, 23]]);\n      }));\n\n      return function _makeResourceAndLink(_x2, _x3) {\n        return _ref4.apply(this, arguments);\n      };\n    }(); // Construct the request object and catch any 401s (expired token)\n\n\n    var _buildRequest = function () {\n      var _ref8 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee3(_ref7) {\n        var method = _ref7.method,\n            url = _ref7.url,\n            path = _ref7.path,\n            headers = _ref7.headers,\n            data = _ref7.data,\n            type = _ref7.type;\n        var req;\n        return _regenerator2.default.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!(!path && !url)) {\n                  _context3.next = 2;\n                  break;\n                }\n\n                throw new Error(\"Either path or url must be specified.\");\n\n              case 2:\n                if (!url) {\n                  _context3.next = 9;\n                  break;\n                }\n\n                if (!/^\\//.test(url)) {\n                  _context3.next = 7;\n                  break;\n                }\n\n                url = domain + url;\n                _context3.next = 9;\n                break;\n\n              case 7:\n                if (!(url.indexOf(domain) !== 0)) {\n                  _context3.next = 9;\n                  break;\n                }\n\n                throw new Error(\"'url' key must begin with the domain used to connect\");\n\n              case 9:\n                method = method.toLowerCase();\n                req = {\n                  method: method,\n                  url: url || DOMAIN + path,\n                  headers: {\n                    authorization: \"Bearer \" + TOKEN\n                  }\n                };\n                if (/\\/$/.test(req.url)) req.url = req.url.slice(0, req.url.length - 1); //handle headers\n\n                (0, _keys2.default)(headers || {}).forEach(function (header) {\n                  req.headers[header.toLowerCase()] = headers[header];\n                });\n\n                if (method === \"put\" || method === \"post\") {\n                  req.headers[\"content-type\"] = req.headers[\"content-type\"] || type || data._type;\n                  req.data = data;\n                }\n\n                if (method === \"delete\") {\n                  req.headers[\"content-type\"] = req.headers[\"content-type\"] || type;\n                }\n\n                return _context3.abrupt(\"return\", req);\n\n              case 16:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      return function _buildRequest(_x5) {\n        return _ref8.apply(this, arguments);\n      };\n    }();\n\n    var _sendRequest = function () {\n      var _ref9 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee4(req) {\n        return _regenerator2.default.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.prev = 0;\n                return _context4.abrupt(\"return\", REQUEST(req));\n\n              case 4:\n                _context4.prev = 4;\n                _context4.t0 = _context4[\"catch\"](0);\n\n                if (!(_context4.t0 && _context4.t0.response.status === 401)) {\n                  _context4.next = 10;\n                  break;\n                }\n\n                _context4.next = 9;\n                return reconnect();\n\n              case 9:\n                return _context4.abrupt(\"return\", REQUEST(req));\n\n              case 10:\n                throw _context4.t0;\n\n              case 11:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this, [[0, 4]]);\n      }));\n\n      return function _sendRequest(_x6) {\n        return _ref9.apply(this, arguments);\n      };\n    }();\n\n    var get = function () {\n      var _ref11 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee5(_ref10) {\n        var url = _ref10.url,\n            path = _ref10.path,\n            headers = _ref10.headers,\n            watch = _ref10.watch,\n            tree = _ref10.tree;\n        var req, watchResponse, response, pieces, treePath, subTree, stuff;\n        return _regenerator2.default.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.next = 2;\n                return _buildRequest({\n                  method: \"get\",\n                  url: url,\n                  path: path,\n                  headers: headers\n                });\n\n              case 2:\n                req = _context5.sent; // If a tree is supplied, recursively GET data according to the data tree\n                // The tree must be rooted at /bookmarks.\n\n                watchResponse = void 0; // TODO: shouldn't request twice for normal tree get...\n\n                _context5.next = 6;\n                return _sendRequest(req);\n\n              case 6:\n                response = _context5.sent;\n\n                if (!watch) {\n                  _context5.next = 15;\n                  break;\n                }\n\n                path = path || urlLib.parse(url).path;\n                req.headers[\"x-oada-rev\"] = response.data._rev;\n                console.log('SENDING THIS REEVVVVVVVVVVVVVVV', response.data._rev);\n                _context5.next = 13;\n                return _watch({\n                  headers: req.headers,\n                  path: path,\n                  func: watch.function,\n                  payload: watch.payload\n                });\n\n              case 13:\n                watchResponse = _context5.sent;\n                console.log('WATCH RESPONSE', watchResponse);\n\n              case 15:\n                if (!tree) {\n                  _context5.next = 45;\n                  break;\n                }\n\n                console.log('IS TREE');\n                pieces = urlLib.parse(req.url).path.replace(/^\\//, \"\").split(\"/\");\n                treePath = _convertSetupTreePath(pieces, tree);\n                console.log(tree, treePath);\n\n                if (pointer.has(tree, treePath)) {\n                  _context5.next = 22;\n                  break;\n                }\n\n                throw new Error(\"The path does not exist on the given tree.\");\n\n              case 22:\n                //return get({url: req.url})\n                subTree = pointer.get(tree, treePath);\n                _context5.prev = 23;\n\n                if (!(watch && watchResponse.resource)) {\n                  _context5.next = 31;\n                  break;\n                }\n\n                console.log('tree getting', watch, watchResponse.resource);\n                _context5.next = 28;\n                return _recursiveGet(req.url, subTree, watchResponse.resource, true);\n\n              case 28:\n                stuff = _context5.sent;\n                _context5.next = 34;\n                break;\n\n              case 31:\n                _context5.next = 33;\n                return _recursiveGet(req.url, subTree, {}, true);\n\n              case 33:\n                stuff = _context5.sent;\n\n              case 34:\n                response.data = stuff.data;\n                response.cached = stuff.cached;\n                _context5.next = 45;\n                break;\n\n              case 38:\n                _context5.prev = 38;\n                _context5.t0 = _context5[\"catch\"](23); // catch 404s because ... ?\n\n                console.log('ERA', _context5.t0);\n\n                if (!(_context5.t0.response && _context5.t0.response.status === 404)) {\n                  _context5.next = 44;\n                  break;\n                }\n\n                _context5.next = 45;\n                break;\n\n              case 44:\n                throw _context5.t0;\n\n              case 45:\n                return _context5.abrupt(\"return\", response);\n\n              case 46:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this, [[23, 38]]);\n      }));\n\n      return function get(_x7) {\n        return _ref11.apply(this, arguments);\n      };\n    }(); //get\n\n\n    var _recursiveGet = function () {\n      var _ref12 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee7(url, tree, data, cached) {\n        var got;\n        return _regenerator2.default.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                if (!tree._type) {\n                  _context7.next = 6;\n                  break;\n                }\n\n                _context7.next = 3;\n                return get({\n                  url: url,\n                  headers: '_rev' in data ? {\n                    'x-oada-rev': data._rev\n                  } : {}\n                });\n\n              case 3:\n                got = _context7.sent; //info('_recursiveGet GET data:', got.data)\n\n                data = got.data;\n                cached = got.cached ? got.cached : false;\n\n              case 6:\n                return _context7.abrupt(\"return\", Promise.map((0, _keys2.default)(data || {}), function () {\n                  var _ref13 = (0, _asyncToGenerator3.default)(\n                  /*#__PURE__*/\n                  _regenerator2.default.mark(function _callee6(key) {\n                    var res;\n                    return _regenerator2.default.wrap(function _callee6$(_context6) {\n                      while (1) {\n                        switch (_context6.prev = _context6.next) {\n                          case 0:\n                            if (!((0, _typeof3.default)(data[key]) === \"object\")) {\n                              _context6.next = 20;\n                              break;\n                            }\n\n                            if (!tree[key]) {\n                              _context6.next = 9;\n                              break;\n                            }\n\n                            _context6.next = 4;\n                            return _recursiveGet(url + \"/\" + key, tree[key], data[key], cached);\n\n                          case 4:\n                            res = _context6.sent;\n                            cached = res.cached;\n                            return _context6.abrupt(\"return\", data[key] = res.data);\n\n                          case 9:\n                            if (!tree[\"*\"]) {\n                              _context6.next = 17;\n                              break;\n                            }\n\n                            _context6.next = 12;\n                            return _recursiveGet(url + \"/\" + key, tree[\"*\"], data[key], cached);\n\n                          case 12:\n                            res = _context6.sent;\n                            cached = res.cached;\n                            return _context6.abrupt(\"return\", data[key] = res.data);\n\n                          case 17:\n                            return _context6.abrupt(\"return\");\n\n                          case 18:\n                            _context6.next = 21;\n                            break;\n\n                          case 20:\n                            return _context6.abrupt(\"return\");\n\n                          case 21:\n                          case \"end\":\n                            return _context6.stop();\n                        }\n                      }\n                    }, _callee6, this);\n                  }));\n\n                  return function (_x12) {\n                    return _ref13.apply(this, arguments);\n                  };\n                }()).then(function () {\n                  return {\n                    data: data,\n                    cached: cached\n                  };\n                }));\n\n              case 7:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      return function _recursiveGet(_x8, _x9, _x10, _x11) {\n        return _ref12.apply(this, arguments);\n      };\n    }(); // Identify the stored resources vs those that need to be setup.\n    // Walk down the given path using the tree as a guide to create the necessary\n    // resource breaks along the way.\n\n\n    var _ensureTree = function () {\n      var _ref15 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee9(_ref14) {\n        var url = _ref14.url,\n            tree = _ref14.tree,\n            data = _ref14.data;\n        var path, pieces, firstPath, storedTree, responses, ret, parentRev;\n        return _regenerator2.default.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                path = urlLib.parse(url).path.replace(/^\\//, \"\");\n                pieces = path.replace(/\\/$/, \"\").split(\"/\"); // replace trailing slashes\n\n                if (data._id) {\n                  firstPath = _convertSetupTreePath(pieces, tree);\n                  pointer.set(tree, firstPath + \"/_id\", data._id);\n                } //    if (pointer.has(tree, treePath)) pointer.set(tree, treePath, _.merge(pointer.get(tree, treePath),data))\n\n\n                storedTree = {};\n                responses = []; // Find the deepest part of the path that exists. Once found, work back down.\n\n                _context9.next = 7;\n                return _findDeepestResources(pieces, tree, storedTree);\n\n              case 7:\n                ret = _context9.sent; // Create all the resources on the way down. ret.stored is an index. Slice\n                // takes the length to slice, so no need to subtract 1.\n\n                parentRev = ret._rev;\n                _context9.next = 11;\n                return Promise.mapSeries(pieces.slice(0, pieces.length - ret.stored), function () {\n                  var _ref16 = (0, _asyncToGenerator3.default)(\n                  /*#__PURE__*/\n                  _regenerator2.default.mark(function _callee8(piece, j) {\n                    var i, urlPath, treePath, content, resp;\n                    return _regenerator2.default.wrap(function _callee8$(_context8) {\n                      while (1) {\n                        switch (_context8.prev = _context8.next) {\n                          case 0:\n                            i = ret.stored + 1 + j;\n                            urlPath = \"/\" + pieces.slice(0, i + 1).join(\"/\");\n                            treePath = _convertSetupTreePath(pieces.slice(0, i + 1), tree);\n\n                            if (!(pointer.has(tree, treePath + \"/_type\") && i <= ret.setup)) {\n                              _context8.next = 14;\n                              break;\n                            }\n\n                            _context8.next = 6;\n                            return _replaceLinks(pointer.get(tree, treePath));\n\n                          case 6:\n                            content = _context8.sent;\n                            _context8.next = 9;\n                            return _makeResourceAndLink({\n                              path: urlPath,\n                              data: _lodash2.default.cloneDeep(content),\n                              headers: {\n                                \"if-match\": parentRev\n                              }\n                            });\n\n                          case 9:\n                            resp = _context8.sent;\n                            parentRev = resp.resource.headers[\"x-oada-rev\"];\n                            pointer.set(storedTree, urlPath, content);\n                            resp.path = urlPath;\n                            responses.push(resp);\n\n                          case 14:\n                          case \"end\":\n                            return _context8.stop();\n                        }\n                      }\n                    }, _callee8, this);\n                  }));\n\n                  return function (_x14, _x15) {\n                    return _ref16.apply(this, arguments);\n                  };\n                }());\n\n              case 11:\n                return _context9.abrupt(\"return\", responses);\n\n              case 12:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      return function _ensureTree(_x13) {\n        return _ref15.apply(this, arguments);\n      };\n    }();\n\n    var _recursiveDelete = function () {\n      var _ref19 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee12(url, tree, data) {\n        var got;\n        return _regenerator2.default.wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                if (!tree._type) {\n                  _context12.next = 13;\n                  break;\n                }\n\n                _context12.prev = 1;\n                _context12.next = 4;\n                return get({\n                  url: url\n                });\n\n              case 4:\n                got = _context12.sent;\n                data = got.data;\n                _context12.next = 13;\n                break;\n\n              case 8:\n                _context12.prev = 8;\n                _context12.t0 = _context12[\"catch\"](1);\n\n                if (!(_context12.t0.status === 404)) {\n                  _context12.next = 13;\n                  break;\n                }\n\n                data = {};\n                return _context12.abrupt(\"return\");\n\n              case 13:\n                return _context12.abrupt(\"return\", Promise.map((0, _keys2.default)(data || {}), function () {\n                  var _ref20 = (0, _asyncToGenerator3.default)(\n                  /*#__PURE__*/\n                  _regenerator2.default.mark(function _callee10(key) {\n                    var res;\n                    return _regenerator2.default.wrap(function _callee10$(_context10) {\n                      while (1) {\n                        switch (_context10.prev = _context10.next) {\n                          case 0:\n                            if (!((0, _typeof3.default)(data[key]) === \"object\")) {\n                              _context10.next = 18;\n                              break;\n                            }\n\n                            if (!tree[key]) {\n                              _context10.next = 8;\n                              break;\n                            }\n\n                            _context10.next = 4;\n                            return _recursiveDelete(url + \"/\" + key, tree[key], data[key]);\n\n                          case 4:\n                            res = _context10.sent;\n                            return _context10.abrupt(\"return\", data[key] = res.data);\n\n                          case 8:\n                            if (!tree[\"*\"]) {\n                              _context10.next = 15;\n                              break;\n                            }\n\n                            _context10.next = 11;\n                            return _recursiveDelete(url + \"/\" + key, tree[\"*\"], data[key]);\n\n                          case 11:\n                            res = _context10.sent;\n                            return _context10.abrupt(\"return\", data[key] = res.data);\n\n                          case 15:\n                            return _context10.abrupt(\"return\");\n\n                          case 16:\n                            _context10.next = 19;\n                            break;\n\n                          case 18:\n                            return _context10.abrupt(\"return\");\n\n                          case 19:\n                          case \"end\":\n                            return _context10.stop();\n                        }\n                      }\n                    }, _callee10, this);\n                  }));\n\n                  return function (_x19) {\n                    return _ref20.apply(this, arguments);\n                  };\n                }()).then((0, _asyncToGenerator3.default)(\n                /*#__PURE__*/\n                _regenerator2.default.mark(function _callee11() {\n                  var link;\n                  return _regenerator2.default.wrap(function _callee11$(_context11) {\n                    while (1) {\n                      switch (_context11.prev = _context11.next) {\n                        case 0:\n                          if (!tree._type) {\n                            _context11.next = 23;\n                            break;\n                          }\n\n                          _context11.prev = 1;\n\n                          if (!data._id) {\n                            _context11.next = 11;\n                            break;\n                          }\n\n                          _context11.prev = 3;\n                          _context11.next = 6;\n                          return del({\n                            path: '/' + data._id,\n                            headers: {\n                              'content-type': tree._type\n                            }\n                          });\n\n                        case 6:\n                          _context11.next = 11;\n                          break;\n\n                        case 8:\n                          _context11.prev = 8;\n                          _context11.t0 = _context11[\"catch\"](3);\n                          console.log('aaaaaaaa', '/' + data._id, url, _context11.t0);\n\n                        case 11:\n                          _context11.next = 13;\n                          return del({\n                            url: url,\n                            headers: {\n                              'content-type': tree._type\n                            }\n                          });\n\n                        case 13:\n                          link = _context11.sent;\n                          _context11.next = 21;\n                          break;\n\n                        case 16:\n                          _context11.prev = 16;\n                          _context11.t1 = _context11[\"catch\"](1);\n\n                          if (!(_context11.t1.response && _context11.t1.response.status === 404)) {\n                            _context11.next = 21;\n                            break;\n                          }\n\n                          data = {};\n                          return _context11.abrupt(\"return\", {\n                            link: link || {},\n                            data: data || {}\n                          });\n\n                        case 21:\n                          _context11.next = 26;\n                          break;\n\n                        case 23:\n                          if (!CACHE) {\n                            _context11.next = 26;\n                            break;\n                          }\n\n                          _context11.next = 26;\n                          return CACHE.removeLookup({\n                            url: url\n                          });\n\n                        case 26:\n                          return _context11.abrupt(\"return\", {\n                            link: link || {},\n                            data: data || {}\n                          });\n\n                        case 27:\n                        case \"end\":\n                          return _context11.stop();\n                      }\n                    }\n                  }, _callee11, this, [[1, 16], [3, 8]]);\n                }))));\n\n              case 14:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12, this, [[1, 8]]);\n      }));\n\n      return function _recursiveDelete(_x16, _x17, _x18) {\n        return _ref19.apply(this, arguments);\n      };\n    }();\n\n    var del = function () {\n      var _ref23 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee13(_ref22) {\n        var url = _ref22.url,\n            path = _ref22.path,\n            type = _ref22.type,\n            headers = _ref22.headers,\n            tree = _ref22.tree,\n            unwatch = _ref22.unwatch;\n        var req, pieces, treePath, subTree, result;\n        return _regenerator2.default.wrap(function _callee13$(_context13) {\n          while (1) {\n            switch (_context13.prev = _context13.next) {\n              case 0:\n                _context13.next = 2;\n                return _buildRequest({\n                  method: \"delete\",\n                  url: url,\n                  path: path,\n                  type: type,\n                  headers: headers\n                });\n\n              case 2:\n                req = _context13.sent;\n\n                if (!unwatch) {\n                  _context13.next = 6;\n                  break;\n                }\n\n                path = path || urlLib.parse(url).path;\n                return _context13.abrupt(\"return\", SOCKET.unwatch({\n                  path: path,\n                  headers: req.headers\n                }));\n\n              case 6:\n                if (!tree) {\n                  _context13.next = 16;\n                  break;\n                }\n\n                pieces = urlLib.parse(req.url).path.replace(/^\\//, \"\").split(\"/\");\n                treePath = _convertSetupTreePath(pieces, tree);\n\n                if (pointer.has(tree, treePath)) {\n                  _context13.next = 11;\n                  break;\n                }\n\n                throw new Error(\"The path does not exist on the given tree.\");\n\n              case 11:\n                //return get({url: req.url})\n                subTree = pointer.get(tree, treePath);\n                _context13.next = 14;\n                return _recursiveDelete(req.url, subTree, {}, true);\n\n              case 14:\n                result = _context13.sent;\n                return _context13.abrupt(\"return\", result.link);\n\n              case 16:\n                if (req.headers[\"content-type\"]) {\n                  _context13.next = 18;\n                  break;\n                }\n\n                throw new Error(\"content-type header must be specified.\");\n\n              case 18:\n                return _context13.abrupt(\"return\", _sendRequest(req));\n\n              case 19:\n              case \"end\":\n                return _context13.stop();\n            }\n          }\n        }, _callee13, this);\n      }));\n\n      return function del(_x20) {\n        return _ref23.apply(this, arguments);\n      };\n    }(); // Ensure all resources down to the deepest resource are created before\n    // performing a PUT.\n\n\n    var put = function () {\n      var _ref25 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee14(_ref24) {\n        var url = _ref24.url,\n            path = _ref24.path,\n            data = _ref24.data,\n            type = _ref24.type,\n            headers = _ref24.headers,\n            tree = _ref24.tree;\n        var req, responses, pieces, treePath;\n        return _regenerator2.default.wrap(function _callee14$(_context14) {\n          while (1) {\n            switch (_context14.prev = _context14.next) {\n              case 0:\n                _context14.next = 2;\n                return _buildRequest({\n                  method: \"put\",\n                  url: url,\n                  path: path,\n                  data: data,\n                  type: type,\n                  headers: headers\n                });\n\n              case 2:\n                req = _context14.sent;\n\n                if (!tree) {\n                  _context14.next = 10;\n                  break;\n                }\n\n                _context14.next = 6;\n                return _ensureTree({\n                  url: req.url,\n                  tree: _lodash2.default.cloneDeep(tree),\n                  data: data\n                });\n\n              case 6:\n                responses = _context14.sent;\n                pieces = responses.length > 0 ? responses[responses.length - 1].path.replace(/^\\//, \"\").split(\"/\") : urlLib.parse(req.url).path.replace(/^\\//, \"\").split(\"/\");\n                treePath = _convertSetupTreePath(pieces, tree) + \"/_type\";\n                if (!req.headers[\"content-type\"] && pointer.has(tree, treePath)) req.headers[\"content-type\"] = _lodash2.default.clone(pointer.get(tree, treePath));\n\n              case 10:\n                if (req.headers[\"content-type\"]) {\n                  _context14.next = 12;\n                  break;\n                }\n\n                throw new Error(\"content-type header must be specified.\");\n\n              case 12:\n                return _context14.abrupt(\"return\", _sendRequest(req).then(function (result) {\n                  return result;\n                }));\n\n              case 13:\n              case \"end\":\n                return _context14.stop();\n            }\n          }\n        }, _callee14, this);\n      }));\n\n      return function put(_x21) {\n        return _ref25.apply(this, arguments);\n      };\n    }();\n\n    var resetCache = function () {\n      var _ref26 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee15(name, expires) {\n        return _regenerator2.default.wrap(function _callee15$(_context15) {\n          while (1) {\n            switch (_context15.prev = _context15.next) {\n              case 0:\n                if (CACHE) {\n                  _context15.next = 2;\n                  break;\n                }\n\n                return _context15.abrupt(\"return\");\n\n              case 2:\n                _context15.next = 4;\n                return CACHE.resetCache();\n\n              case 4:\n              case \"end\":\n                return _context15.stop();\n            }\n          }\n        }, _callee15, this);\n      }));\n\n      return function resetCache(_x22, _x23) {\n        return _ref26.apply(this, arguments);\n      };\n    }();\n\n    var disconnect = function () {\n      var _ref27 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee16() {\n        return _regenerator2.default.wrap(function _callee16$(_context16) {\n          while (1) {\n            switch (_context16.prev = _context16.next) {\n              case 0:\n                if (!CACHE) {\n                  _context16.next = 3;\n                  break;\n                }\n\n                _context16.next = 3;\n                return CACHE.db.close();\n\n              case 3:\n                //if (CACHE) await CACHE.db.destroy();\n                if (SOCKET) SOCKET.close(); //if (_token.isSet()) {\n\n                _token.cleanUp();\n\n              //}\n\n              case 5:\n              case \"end\":\n                return _context16.stop();\n            }\n          }\n        }, _callee16, this);\n      }));\n\n      return function disconnect() {\n        return _ref27.apply(this, arguments);\n      };\n    }();\n\n    var reconnect = function () {\n      var _ref28 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee17() {\n        return _regenerator2.default.wrap(function _callee17$(_context17) {\n          while (1) {\n            switch (_context17.prev = _context17.next) {\n              case 0:\n                _context17.next = 2;\n                return _token.renew();\n\n              case 2:\n                TOKEN = _context17.sent;\n\n              case 3:\n              case \"end\":\n                return _context17.stop();\n            }\n          }\n        }, _callee17, this);\n      }));\n\n      return function reconnect() {\n        return _ref28.apply(this, arguments);\n      };\n    }(); // get a token\n\n\n    var domain = _ref.domain,\n        options = _ref.options,\n        cache = _ref.cache,\n        token = _ref.token,\n        websocket = _ref.websocket;\n\n    var OFFLINE, CACHE, REQUEST, NOCACHEREQUEST, SOCKET, TOKEN, _token, DOMAIN, NAME, EXPIRES, _replaceLinks, _watch, _findDeepestResources, _convertSetupTreePath, _configureCache, post, socketApi, _getMemoryCache;\n\n    return _regenerator2.default.wrap(function _callee18$(_context18) {\n      while (1) {\n        switch (_context18.prev = _context18.next) {\n          case 0:\n            _getMemoryCache = function _getMemoryCache() {\n              if (CACHE) {\n                return CACHE._getMemoryCache();\n              } else {\n                return {};\n              }\n            };\n\n            post = function post(_ref18) {\n              var url = _ref18.url,\n                  path = _ref18.path,\n                  data = _ref18.data,\n                  type = _ref18.type,\n                  headers = _ref18.headers,\n                  tree = _ref18.tree;\n              url = url || DOMAIN + path;\n              url = url[url.length - 1] === \"/\" ? url + (0, _uuid2.default)() : url + \"/\" + (0, _uuid2.default)();\n              return put({\n                url: url,\n                data: data,\n                type: type,\n                headers: headers,\n                tree: tree\n              });\n            };\n\n            _configureCache = function _configureCache(_ref17) {\n              var name = _ref17.name,\n                  req = _ref17.req,\n                  expires = _ref17.expires;\n              var res = (0, _cache2.default)({\n                name: name,\n                req: req,\n                expires: expires\n              });\n              REQUEST = res.api;\n              CACHE = res;\n              return;\n            };\n\n            _convertSetupTreePath = function _convertSetupTreePath(pathPieces, tree) {\n              var newPieces = _lodash2.default.clone(pathPieces);\n\n              newPieces = pathPieces.map(function (piece, i) {\n                if (pointer.has(tree, \"/\" + newPieces.slice(0, i).join(\"/\") + \"/*\")) {\n                  newPieces[i] = \"*\";\n                  return \"*\";\n                } else {\n                  return piece;\n                }\n              });\n              return \"/\" + newPieces.join(\"/\");\n            };\n\n            _findDeepestResources = function _findDeepestResources(pieces, tree, storedTree) {\n              var stored = 0;\n              var setup = void 0;\n\n              var _rev; // Walk down the url in reverse order\n\n\n              return Promise.mapSeries(pieces, function (piece, i) {\n                var z = pieces.length - 1 - i; //use z to create paths in reverse order\n\n                var urlPath = \"/\" + pieces.slice(0, z + 1).join(\"/\");\n\n                var treePath = _convertSetupTreePath(pieces.slice(0, z + 1), tree); // Check that its in the stored tree then look for deepest _resource_.\n                // If successful, break from the loop by throwing\n\n\n                if (pointer.has(tree, treePath + \"/_type\")) {\n                  setup = setup || z;\n\n                  if (pointer.has(storedTree, urlPath)) {\n                    stored = _lodash2.default.clone(z);\n                    throw new Error(\"stored\");\n                  }\n\n                  return get({\n                    path: urlPath\n                  }).then(function (response) {\n                    //TODO: Detect whether the returned data matches the given tree\n                    pointer.set(storedTree, urlPath, {});\n                    stored = _lodash2.default.clone(z);\n                    _rev = response.headers[\"x-oada-rev\"];\n                    throw new Error(\"stored\");\n                  }).catch(function (err) {\n                    if (/^stored/.test(err.message)) throw err;\n                    return;\n                  });\n                } else return;\n              }).catch(function (err) {\n                // Throwing with a number error only should occur on success.\n                if (/^stored/.test(err.message)) return {\n                  stored: stored,\n                  setup: setup\n                };\n              }).then(function () {\n                return {\n                  stored: stored,\n                  setup: setup || 0,\n                  _rev: _rev\n                };\n              });\n            };\n\n            _watch = function _watch(_ref5) {\n              var headers = _ref5.headers,\n                  path = _ref5.path,\n                  func = _ref5.func,\n                  payload = _ref5.payload;\n\n              if (SOCKET) {\n                return SOCKET.watch({\n                  path: path,\n                  headers: headers\n                }, function () {\n                  var _ref6 = (0, _asyncToGenerator3.default)(\n                  /*#__PURE__*/\n                  _regenerator2.default.mark(function _callee2(response) {\n                    var watchPayload;\n                    return _regenerator2.default.wrap(function _callee2$(_context2) {\n                      while (1) {\n                        switch (_context2.prev = _context2.next) {\n                          case 0:\n                            watchPayload = _lodash2.default.cloneDeep(payload) || {};\n                            watchPayload.response = response;\n                            watchPayload.request = {\n                              url: DOMAIN + path,\n                              headers: headers,\n                              method: response.change.type\n                            };\n                            _context2.prev = 3;\n\n                            if (!CACHE) {\n                              _context2.next = 8;\n                              break;\n                            }\n\n                            _context2.next = 7;\n                            return CACHE.handleWatchChange(watchPayload);\n\n                          case 7:\n                            watchPayload = _context2.sent;\n\n                          case 8:\n                            _context2.next = 13;\n                            break;\n\n                          case 10:\n                            _context2.prev = 10;\n                            _context2.t0 = _context2[\"catch\"](3);\n                            console.log(_context2.t0);\n\n                          case 13:\n                            if (!func) {\n                              _context2.next = 16;\n                              break;\n                            }\n\n                            _context2.next = 16;\n                            return func(watchPayload);\n\n                          case 16:\n                            return _context2.abrupt(\"return\");\n\n                          case 17:\n                          case \"end\":\n                            return _context2.stop();\n                        }\n                      }\n                    }, _callee2, this, [[3, 10]]);\n                  }));\n\n                  function handleWatchResponse(_x4) {\n                    return _ref6.apply(this, arguments);\n                  }\n\n                  return handleWatchResponse;\n                }());\n              } else {\n                return;\n                /*\n                // Ping a normal GET every 5 seconds in the absense of a websocket\n                return setInterval(() => {\n                  get({ url: DOMAIN + path }).then(result => {\n                    func(payload);\n                  });\n                }, 5000);\n                */\n              }\n            };\n\n            _replaceLinks = function _replaceLinks(obj) {\n              var ret = Array.isArray(obj) ? [] : {};\n              if (!obj) return obj; // no defined objriptors for this level\n\n              return Promise.map((0, _keys2.default)(obj || {}), function (key) {\n                if (key === \"*\") {\n                  // Don't put *s into oada. Ignore them\n                  return;\n                }\n\n                var val = obj[key];\n\n                if ((typeof val === \"undefined\" ? \"undefined\" : (0, _typeof3.default)(val)) !== \"object\" || !val) {\n                  ret[key] = val; // keep it asntType: 'application/vnd.oada.harvest.1+json'\n\n                  return;\n                }\n\n                if (val._type) {\n                  // If it has a '_type' key, don't worry about it.\n                  //It'll get created in future iterations of ensureTree\n                  return;\n                }\n\n                if (val._id) {\n                  // If it's an object, and has an '_id', make it a link from descriptor\n                  ret[key] = {\n                    _id: val._id\n                  };\n                  if ('_rev' in val) ret[key]._rev = val._rev;\n                  return;\n                } // otherwise, recurse into the object looking for more links\n\n\n                return _replaceLinks(val).then(function (result) {\n                  ret[key] = result;\n                  return;\n                });\n              }).then(function () {\n                return ret;\n              });\n            };\n\n            if (domain) {\n              _context18.next = 9;\n              break;\n            }\n\n            throw new Error(\"domain undefined\");\n\n          case 9:\n            if (!(typeof domain !== \"string\")) {\n              _context18.next = 11;\n              break;\n            }\n\n            throw new Error(\"domain must be a string\");\n\n          case 11:\n            if (!(!options && !token)) {\n              _context18.next = 13;\n              break;\n            }\n\n            throw new Error(\"options and token undefined\");\n\n          case 13:\n            if (!(token && typeof token !== \"string\")) {\n              _context18.next = 15;\n              break;\n            }\n\n            throw new Error(\"token must be a string\");\n\n          case 15:\n            if (!(cache !== undefined && typeof cache !== \"boolean\" && (typeof cache === \"undefined\" ? \"undefined\" : (0, _typeof3.default)(cache)) !== \"object\")) {\n              _context18.next = 17;\n              break;\n            }\n\n            throw new Error(\"cache must be either a boolean or an object with 'name' and/or 'expires' keys\");\n\n          case 17:\n            if (!(cache && cache.name && typeof cache.name !== \"string\")) {\n              _context18.next = 19;\n              break;\n            }\n\n            throw new Error(\"cache name must be a string\");\n\n          case 19:\n            if (!(typeof websocket !== \"undefined\" && typeof websocket !== \"boolean\")) {\n              _context18.next = 21;\n              break;\n            }\n\n            throw new Error(\"websocket must be boolean\");\n\n          case 21:\n            REQUEST = axios;\n            NOCACHEREQUEST = axios;\n            _token = new _TOKEN({\n              domain: domain,\n              token: token,\n              options: options\n            });\n\n            if (domain) {\n              _context18.next = 26;\n              break;\n            }\n\n            throw new Error(\"domain undefined\");\n\n          case 26:\n            DOMAIN = domain;\n            NAME = cache && cache.name ? cache.name : urlLib.parse(domain).hostname.replace(/\\./g, \"_\");\n            EXPIRES = cache && cache.expires ? cache.expires : undefined; // Loop over the keys of the path and determine whether the object at that level\n            // contains a * key. The path must be updated along the way, replacing *s as\n            // necessary.\n\n            _context18.next = 31;\n            return _token.get();\n\n          case 31:\n            TOKEN = _context18.sent;\n\n            if (!(websocket !== false)) {\n              _context18.next = 41;\n              break;\n            }\n\n            _context18.next = 35;\n            return ws(domain);\n\n          case 35:\n            socketApi = _context18.sent;\n            NOCACHEREQUEST = socketApi.http;\n            REQUEST = socketApi.http;\n            _context18.next = 40;\n            return socketApi;\n\n          case 40:\n            SOCKET = _context18.sent;\n\n          case 41:\n            if (!(cache !== false)) {\n              _context18.next = 44;\n              break;\n            }\n\n            _context18.next = 44;\n            return _configureCache({\n              name: NAME || (0, _uuid2.default)(),\n              req: REQUEST,\n              expires: EXPIRES\n            });\n\n          case 44:\n            return _context18.abrupt(\"return\", {\n              token: TOKEN,\n              cache: CACHE ? CACHE : false,\n              websocket: SOCKET ? SOCKET : false,\n              get: get,\n              put: put,\n              post: post,\n              delete: del,\n              resetCache: resetCache,\n              disconnect: disconnect,\n              reconnect: reconnect,\n              _getMemoryCache: _getMemoryCache\n            });\n\n          case 45:\n          case \"end\":\n            return _context18.stop();\n        }\n      }\n    }, _callee18, this);\n  }));\n\n  function connect(_x) {\n    return _ref2.apply(this, arguments);\n  }\n\n  return connect;\n}();\n\nexports.default = {\n  connect: connect\n};","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _defineProperty2 = require(\"babel-runtime/helpers/defineProperty\");\n\nvar _defineProperty3 = _interopRequireDefault(_defineProperty2);\n\nvar _typeof2 = require(\"babel-runtime/helpers/typeof\");\n\nvar _typeof3 = _interopRequireDefault(_typeof2);\n\nvar _keys = require(\"babel-runtime/core-js/object/keys\");\n\nvar _keys2 = _interopRequireDefault(_keys);\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require(\"babel-runtime/helpers/asyncToGenerator\");\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nexports.default = setupCache;\n\nvar _pouchdb = require(\"pouchdb\");\n\nvar _pouchdb2 = _interopRequireDefault(_pouchdb);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar cq = require(\"concurrent-queue\");\n\nvar pretty = require(\"prettyjson\");\n\nvar Promise = require(\"bluebird\");\n\nvar url = require(\"url\");\n\nvar _ = require(\"lodash\");\n\nvar pointer = require(\"json-pointer\");\n\nvar OFFLINE = false;\nvar REVLIMIT = 10;\nvar memoryCache = {};\nvar timeThreshold = 30000;\nvar cleanMemoryTimer = 10000;\nvar dbPutDelay = 5000; // 5 sec\n\nPromise.config({\n  cancellation: true\n}); //const error = require('debug')('oada-cache:cache:error');\n//const info = require('debug')('oada-cache:cache:info');\n\nfunction setupCache(_ref) {\n  var _ref20;\n  /** Get the resource and merge data if its already in the db. */\n\n  /**\n   * Store (upsert) resource to local DB\n   * @param req request\n   * @param waitTime wait time\n   */\n\n\n  var dbUpsert = function () {\n    var _ref3 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee2(req, waitTime) {\n      var urlObj, pieces, resourceId, pathLeftover, dbPut, memoryResult, result, curData, newData;\n      return _regenerator2.default.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              urlObj = url.parse(req.url);\n              pieces = urlObj.path.split(\"/\");\n              resourceId = pieces.slice(1, 3).join(\"/\"); //returns resources/abc\n\n              pathLeftover = pieces.length > 3 ? \"/\" + pieces.slice(3, pieces.length).join(\"/\") : \"\"; // Create the content to put in the cache\n\n              dbPut = {\n                _id: resourceId,\n                valid: req.valid === undefined ? true : req.valid,\n                // TODO: This current resets this access date for e.g., every put\n                // while offline. This doesn't seem right. I think this should only\n                // get updated when we know we're upserting a new value from the server\n                accessed: Date.now(),\n                doc: {}\n              }; // ALL updates to existing docs (upserts) need to supply the current _rev.\n\n              memoryResult = memoryCache[resourceId]; // Try to get resource from in-memory cache\n\n              result = {\n                doc: {}\n              };\n\n              if (memoryResult) {\n                _context2.next = 23;\n                break;\n              }\n\n              _context2.prev = 8;\n              _context2.next = 11;\n              return db.get(resourceId);\n\n            case 11:\n              result = _context2.sent;\n              _context2.next = 21;\n              break;\n\n            case 14:\n              _context2.prev = 14;\n              _context2.t0 = _context2[\"catch\"](8);\n\n              if (!(req.method && req.method.toLowerCase() === \"delete\")) {\n                _context2.next = 20;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 20:\n              if (pathLeftover) {\n                dbPut.INCOMPLETE_RESOURCE = true;\n              }\n\n            case 21:\n              _context2.next = 25;\n              break;\n\n            case 23:\n              result = memoryResult.data; // If in memory, result._rev might be undefined (409 errors)\n\n              if (result._rev !== undefined) dbPut._rev = result._rev;\n\n            case 25:\n              if (!(req.method && req.method.toLowerCase() === \"delete\")) {\n                _context2.next = 35;\n                break;\n              }\n\n              if (pathLeftover) {\n                _context2.next = 32;\n                break;\n              }\n\n              if (memoryCache[resourceId] && memoryCache[resourceId].promise) memoryCache[resourceId].promise.cancel();\n              delete memoryCache[resourceId];\n              return _context2.abrupt(\"return\", db.remove(result).then(function (response) {\n                return {\n                  response: response\n                };\n              }).catch(function (error) {\n                //its okay if it already doesn't exist\n                if (error.status === 404) return;\n                throw error;\n              }));\n\n            case 32:\n              if (pointer.has(result.doc, pathLeftover)) {\n                dbPut.doc = result.doc;\n                pointer.remove(dbPut.doc, pathLeftover);\n              }\n\n            case 33:\n              _context2.next = 36;\n              break;\n\n            case 35:\n              //handle \"merge\" type operations\n              if (pathLeftover) {\n                curData = pointer.has(result.doc, pathLeftover) ? pointer.get(result.doc, pathLeftover) : {};\n                newData = _.merge(curData, req.data || {});\n                pointer.set(result.doc, pathLeftover, newData);\n                dbPut.doc = result.doc;\n              } else {\n                dbPut.doc = _.merge(result.doc, req.data);\n              }\n\n            case 36:\n              if (req._rev != undefined) dbPut.doc._rev = req._rev;\n              return _context2.abrupt(\"return\", handleMemoryCache(resourceId, dbPut, waitTime, req));\n\n            case 38:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, this, [[8, 14]]);\n    }));\n\n    return function dbUpsert(_x2, _x3) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  /**\n   * Get resource from the server\n   * @param req request\n   */\n\n\n  var getResFromServer = function () {\n    var _ref4 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee3(req) {\n      var res;\n      return _regenerator2.default.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return request({\n                method: \"GET\",\n                url: req.url,\n                headers: req.headers\n              });\n\n            case 2:\n              res = _context3.sent;\n              res.cached = false;\n              req.data = res.data;\n              _context3.prev = 5;\n              _context3.next = 8;\n              return dbUpsert(req);\n\n            case 8:\n              _context3.next = 13;\n              break;\n\n            case 10:\n              _context3.prev = 10;\n              _context3.t0 = _context3[\"catch\"](5);\n              console.log('getResFromServerError', _context3.t0);\n\n            case 13:\n              return _context3.abrupt(\"return\", res);\n\n            case 14:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, this, [[5, 10]]);\n    }));\n\n    return function getResFromServer(_x4) {\n      return _ref4.apply(this, arguments);\n    };\n  }(); // Create a queue of actual PUTs to make when online.\n  // Resource breaks are known via setupTree.\n  // Do the puts, save out the resource IDs, and return to client\n  // Create an index on the data to find those that need synced\n  // Create a service that other apps can run which starts up and periodically\n  // checks if a connections has yet been made. A periodic service may also\n  // concievably check for updates to cached things.\n  //\n  // The cache should go \"stale\" after some period of time; However, if it cannot\n  // establish a connection, it should remain valid, usable data.\n\n  /**\n   * Get resource from local DB. If the specified resource does not exist, try to get it from the server.\n   * @param {any} req request\n   * @param {any} offline default is false (online)\n   */\n\n\n  var getResFromDb = function () {\n    var _ref6 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee5(req) {\n      var offline = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var revLimit = arguments[2];\n      var urlObj, pieces, resourceId, pathLeftover, resource, rev, res_inmemory, res_localdb, data;\n      return _regenerator2.default.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              urlObj = url.parse(req.url);\n              pieces = urlObj.path.split(\"/\");\n              resourceId = pieces.slice(1, 3).join(\"/\"); //returns resources/abc\n\n              pathLeftover = pieces.length > 3 ? \"/\" + pieces.slice(3, pieces.length).join(\"/\") : \"\";\n              resource = undefined;\n              rev = undefined; // 1) Get resource from in-memory cache\n\n              res_inmemory = memoryCache[resourceId];\n\n              if (res_inmemory) {\n                resource = res_inmemory.data.doc;\n              } // 2) Get resource from local DB\n\n\n              if (resource) {\n                _context5.next = 19;\n                break;\n              }\n\n              _context5.prev = 9;\n              _context5.next = 12;\n              return db.get(resourceId);\n\n            case 12:\n              res_localdb = _context5.sent;\n              resource = res_localdb.doc;\n              _context5.next = 19;\n              break;\n\n            case 16:\n              _context5.prev = 16;\n              _context5.t0 = _context5[\"catch\"](9); // Oops\n\n              console.log('getResFromDbErr', _context5.t0);\n\n            case 19:\n              if (!(!resource && !offline)) {\n                _context5.next = 23;\n                break;\n              }\n\n              return _context5.abrupt(\"return\", getResFromServer(req));\n\n            case 23:\n              if (!(!resource && offline)) {\n                _context5.next = 25;\n                break;\n              }\n\n              throw \"Offline and resource not found in local db.\";\n\n            case 25:\n              if (!(resource.accessed + expiration <= Date.now() || !resource.valid === \"false\")) {\n                _context5.next = 30;\n                break;\n              }\n\n              if (!offline) {\n                _context5.next = 29;\n                break;\n              }\n\n              _context5.next = 30;\n              break;\n\n            case 29:\n              return _context5.abrupt(\"return\", getResFromServer(req));\n\n            case 30:\n              if (!(req.headers && req.headers['x-oada-rev'] && parseInt(req.headers['x-oada-rev']) - parseInt(resource._rev) >= revLimit)) {\n                _context5.next = 32;\n                break;\n              }\n\n              return _context5.abrupt(\"return\", getResFromServer(req));\n\n            case 32:\n              if (!pointer.has(resource, pathLeftover)) {\n                _context5.next = 37;\n                break;\n              }\n\n              data = pointer.get(resource, pathLeftover);\n              return _context5.abrupt(\"return\", {\n                data: data,\n                headers: {\n                  \"x-oada-rev\": resource._rev,\n                  \"content-location\": resourceId + pathLeftover\n                },\n                status: 200,\n                cached: true\n              });\n\n            case 37:\n              return _context5.abrupt(\"return\", getResFromServer(req));\n\n            case 38:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, this, [[9, 16]]);\n    }));\n\n    return function getResFromDb(_x6) {\n      return _ref6.apply(this, arguments);\n    };\n  }(); // Accepts an axios-style request. Returns:\n  // {\n  //\n  //   data: the data requested,\n  //\n  //   _rev: the rev of the parent resource requested\n  //\n  //   location: e.g.: /resources/abc123/some/path/leftover\n  //\n  // }\n\n\n  var get = function () {\n    var _ref7 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee6(req, revLimit) {\n      var urlObj, newReq, lookup;\n      return _regenerator2.default.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              urlObj = url.parse(req.url);\n              newReq = _.cloneDeep(req);\n\n              if (!(!/^\\/resources/.test(urlObj.path) || !/^\\/users/.test(urlObj.path))) {\n                _context6.next = 7;\n                break;\n              }\n\n              _context6.next = 5;\n              return getLookup(req);\n\n            case 5:\n              lookup = _context6.sent;\n              newReq.url = urlObj.protocol + \"//\" + urlObj.host + \"/\" + lookup.resourceId + lookup.pathLeftover;\n\n            case 7:\n              return _context6.abrupt(\"return\", getResFromDb(newReq, OFFLINE, revLimit || REVLIMIT).then(function (response) {\n                return response;\n              }));\n\n            case 8:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6, this);\n    }));\n\n    return function get(_x7, _x8) {\n      return _ref7.apply(this, arguments);\n    };\n  }(); // TODO: Need to update the cache for both the parent resource and child new\n  // resource if one is created\n\n\n  var put = function () {\n    var _ref8 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee7(req) {\n      var offline = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var urlObj, lookup, response;\n      return _regenerator2.default.wrap(function _callee7$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              urlObj = url.parse(req.url);\n\n              if (!offline) {\n                _context7.next = 7;\n                break;\n              }\n\n              _context7.next = 4;\n              return getLookup({\n                url: urlObj.protocol + \"//\" + urlObj.host + reqPieces.slice(0, reqPieces.length - 1).join(\"/\"),\n                headers: req.headers\n              });\n\n            case 4:\n              lookup = _context7.sent;\n              _context7.next = 13;\n              break;\n\n            case 7:\n              _context7.next = 9;\n              return request(req);\n\n            case 9:\n              response = _context7.sent;\n              _context7.next = 12;\n              return dbUpsert({\n                url: response.headers[\"content-location\"],\n                data: req.data,\n                _rev: parseInt(response.headers[\"x-oada-rev\"]),\n                // TODO: should it be invalidated until pulled from server?\n                valid: false\n              });\n\n            case 12:\n              return _context7.abrupt(\"return\", response);\n\n            case 13:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee7, this);\n    }));\n\n    return function put(_x10) {\n      return _ref8.apply(this, arguments);\n    };\n  }(); // Remove the deleted key from the parent resource optimistically using\n  // put(). Also mark the parent invalid as the _rev update will affect it\n\n\n  var updateParent = function () {\n    var _ref9 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee8(req) {\n      var urlObj, reqPieces, lookup;\n      return _regenerator2.default.wrap(function _callee8$(_context8) {\n        while (1) {\n          switch (_context8.prev = _context8.next) {\n            case 0:\n              urlObj = url.parse(req.url); // Try to get the parent document\n\n              reqPieces = urlObj.path.split(\"/\");\n              _context8.next = 4;\n              return getLookup({\n                url: urlObj.protocol + \"//\" + urlObj.host + reqPieces.slice(0, reqPieces.length - 1).join(\"/\"),\n                headers: req.headers\n              });\n\n            case 4:\n              lookup = _context8.sent;\n              _context8.next = 7;\n              return dbUpsert({\n                url: \"/\" + lookup.resourceId + lookup.pathLeftover + \"/\" + reqPieces[reqPieces.length - 1],\n                method: \"delete\",\n                valid: false\n              });\n\n            case 7:\n              return _context8.abrupt(\"return\");\n\n            case 8:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n      }, _callee8, this);\n    }));\n\n    return function updateParent(_x11) {\n      return _ref9.apply(this, arguments);\n    };\n  }();\n\n  var removeLookup = function () {\n    var _ref10 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee9(lookup) {\n      return _regenerator2.default.wrap(function _callee9$(_context9) {\n        while (1) {\n          switch (_context9.prev = _context9.next) {\n            case 0:\n              // Clear the in-memory cache\n              if (memoryCache[lookup._id]) {\n                if (memoryCache[lookup._id].promise) memoryCache[lookup._id].promise.cancel();\n                delete memoryCache[lookup._id];\n              }\n\n              _context9.prev = 1;\n              _context9.next = 4;\n              return db.remove(lookup);\n\n            case 4:\n              _context9.next = 11;\n              break;\n\n            case 6:\n              _context9.prev = 6;\n              _context9.t0 = _context9[\"catch\"](1);\n\n              if (!(_context9.t0.status === 404)) {\n                _context9.next = 10;\n                break;\n              }\n\n              return _context9.abrupt(\"return\");\n\n            case 10:\n              throw _context9.t0;\n\n            case 11:\n            case \"end\":\n              return _context9.stop();\n          }\n        }\n      }, _callee9, this, [[1, 6]]);\n    }));\n\n    return function removeLookup(_x12) {\n      return _ref10.apply(this, arguments);\n    };\n  }(); // Issue DELETE to server then update the db\n\n\n  var del = function () {\n    var _ref11 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee10(req, offline) {\n      var urlObj, lookup, response;\n      return _regenerator2.default.wrap(function _callee10$(_context10) {\n        while (1) {\n          switch (_context10.prev = _context10.next) {\n            case 0:\n              //info('delete:', req.url, req);\n              urlObj = url.parse(req.url); // Handle resource deletion\n\n              if (!(/^\\/resources/.test(urlObj.path) || /^\\/users/.test(urlObj.path))) {\n                _context10.next = 6;\n                break;\n              }\n\n              _context10.next = 4;\n              return dbUpsert({\n                url: req.url,\n                method: req.method,\n                valid: false\n              });\n\n            case 4:\n              _context10.next = 31;\n              break;\n\n            case 6:\n              _context10.prev = 6;\n              _context10.next = 9;\n              return getLookup(req);\n\n            case 9:\n              lookup = _context10.sent;\n              _context10.next = 12;\n              return dbUpsert({\n                url: '/' + lookup.resourceId + lookup.pathLeftover,\n                method: req.method,\n                valid: false\n              });\n\n            case 12:\n              _context10.next = 14;\n              return removeLookup(lookup);\n\n            case 14:\n              _context10.prev = 14;\n              _context10.next = 17;\n              return updateParent(req);\n\n            case 17:\n              _context10.next = 23;\n              break;\n\n            case 19:\n              _context10.prev = 19;\n              _context10.t0 = _context10[\"catch\"](14);\n              console.log('was a problem updating parent doc');\n              throw _context10.t0;\n\n            case 23:\n              _context10.next = 31;\n              break;\n\n            case 25:\n              _context10.prev = 25;\n              _context10.t1 = _context10[\"catch\"](6);\n\n              if (!(_context10.t1.response && _context10.t1.response.status === 404)) {\n                _context10.next = 30;\n                break;\n              }\n\n              _context10.next = 31;\n              break;\n\n            case 30:\n              throw _context10.t1;\n\n            case 31:\n              if (offline) {\n                _context10.next = 37;\n                break;\n              }\n\n              _context10.next = 34;\n              return request(req);\n\n            case 34:\n              response = _context10.sent;\n              _context10.next = 37;\n              break;\n\n            case 37:\n              return _context10.abrupt(\"return\", response);\n\n            case 38:\n            case \"end\":\n              return _context10.stop();\n          }\n        }\n      }, _callee10, this, [[6, 25], [14, 19]]);\n    }));\n\n    return function del(_x13, _x14) {\n      return _ref11.apply(this, arguments);\n    };\n  }();\n\n  var _recursiveUpsert = function () {\n    var _ref13 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee13(req, body) {\n      var lookup, newBody;\n      return _regenerator2.default.wrap(function _callee13$(_context13) {\n        while (1) {\n          switch (_context13.prev = _context13.next) {\n            case 0:\n              if (!(body._rev !== undefined)) {\n                _context13.next = 7;\n                break;\n              }\n\n              _context13.next = 3;\n              return getLookup({\n                url: req.url,\n                headers: req.headers,\n                resourceId: body._id\n              });\n\n            case 3:\n              lookup = _context13.sent;\n              newBody = replaceLinks(body, {\n                url: req.url,\n                headers: req.headers\n              });\n              _context13.next = 7;\n              return dbUpsert({\n                url: \"/\" + (body._id || lookup.resourceId),\n                data: newBody\n              });\n\n            case 7:\n              if (!((typeof body === \"undefined\" ? \"undefined\" : (0, _typeof3.default)(body)) === \"object\")) {\n                _context13.next = 11;\n                break;\n              }\n\n              return _context13.abrupt(\"return\", Promise.map((0, _keys2.default)(body || {}), function () {\n                var _ref14 = (0, _asyncToGenerator3.default)(\n                /*#__PURE__*/\n                _regenerator2.default.mark(function _callee12(key) {\n                  return _regenerator2.default.wrap(function _callee12$(_context12) {\n                    while (1) {\n                      switch (_context12.prev = _context12.next) {\n                        case 0:\n                          if (!(key.charAt(0) === \"_\")) {\n                            _context12.next = 2;\n                            break;\n                          }\n\n                          return _context12.abrupt(\"return\");\n\n                        case 2:\n                          if (body[key]) {\n                            _context12.next = 4;\n                            break;\n                          }\n\n                          return _context12.abrupt(\"return\");\n\n                        case 4:\n                          _context12.next = 6;\n                          return _recursiveUpsert({\n                            url: req.url + \"/\" + key,\n                            headers: req.headers\n                          }, body[key]);\n\n                        case 6:\n                        case \"end\":\n                          return _context12.stop();\n                      }\n                    }\n                  }, _callee12, this);\n                }));\n\n                return function (_x19) {\n                  return _ref14.apply(this, arguments);\n                };\n              }()));\n\n            case 11:\n              return _context13.abrupt(\"return\");\n\n            case 12:\n            case \"end\":\n              return _context13.stop();\n          }\n        }\n      }, _callee13, this);\n    }));\n\n    return function _recursiveUpsert(_x17, _x18) {\n      return _ref13.apply(this, arguments);\n    };\n  }();\n  /*\n  async function _recursiveUpsert(req, body, oldBody) {\n  if (body._rev) {\n      let lookup = await getLookup({\n        url: req.url,\n        headers: req.headers,\n        _id: body._id\n      })\n      let newBody = replaceLinks(body, {\n        url: req.url,\n        headers: req.headers\n      });\n    var result = await dbUpsert({\n        url: '/'+(body._id || lookup.resourceId),\n        data: newBody,\n      })\n      oldBody = result.oldBody;\n    }\n  \n    if (typeof body === 'object') {\n      return Promise.map(Object.keys(body || {}), async function(key) {\n        if (key.charAt(0) === '_') return\n        if (!body[key]) return\n        var oldPiece = await _recursiveUpsert({\n          url: req.url+'/'+key,\n          headers: req.headers\n        }, body[key], oldBody[key])\n        oldBody[key] = oldPiece;\n      }).then(() => {\n        return oldBody\n      })\n    } else return;\n  }*/\n\n\n  var resetCache = function () {\n    var _ref18 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee18() {\n      return _regenerator2.default.wrap(function _callee18$(_context18) {\n        while (1) {\n          switch (_context18.prev = _context18.next) {\n            case 0:\n              _context18.prev = 0;\n\n              if (!db) {\n                _context18.next = 6;\n                break;\n              }\n\n              _context18.next = 4;\n              return db.destroy();\n\n            case 4:\n              (0, _keys2.default)(memoryCache).forEach(function () {\n                var _ref19 = (0, _asyncToGenerator3.default)(\n                /*#__PURE__*/\n                _regenerator2.default.mark(function _callee17(key) {\n                  return _regenerator2.default.wrap(function _callee17$(_context17) {\n                    while (1) {\n                      switch (_context17.prev = _context17.next) {\n                        case 0:\n                          if (!memoryCache[key].promise) {\n                            _context17.next = 3;\n                            break;\n                          }\n\n                          _context17.next = 3;\n                          return memoryCache[key].promise.cancel();\n\n                        case 3:\n                        case \"end\":\n                          return _context17.stop();\n                      }\n                    }\n                  }, _callee17, this);\n                }));\n\n                return function (_x22) {\n                  return _ref19.apply(this, arguments);\n                };\n              }());\n              memoryCache = {};\n\n            case 6:\n              _context18.next = 11;\n              break;\n\n            case 8:\n              _context18.prev = 8;\n              _context18.t0 = _context18[\"catch\"](0);\n              return _context18.abrupt(\"return\");\n\n            case 11:\n            case \"end\":\n              return _context18.stop();\n          }\n        }\n      }, _callee18, this, [[0, 8]]);\n    }));\n\n    return function resetCache() {\n      return _ref18.apply(this, arguments);\n    };\n  }();\n\n  var name = _ref.name,\n      req = _ref.req,\n      expires = _ref.expires; // name should be made unique across domains and users\n\n  var db = db || new _pouchdb2.default(name); // This fixes concurrent accesses\n\n  _pouchdb2.default.on(\"destroyed\", function () {\n    var _ref2 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee(dbName) {\n      return _regenerator2.default.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (dbName === name) {\n                db = new _pouchdb2.default(name);\n              }\n\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this);\n    }));\n\n    return function (_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }());\n\n  var request = req;\n  var expiration = expires || 1000 * 60 * 60 * 24 * 2; //(ms/s)*(s/min)*(min/hr)*(hr/days)*days\n  // Clean in-memory cache periodically\n\n  setInterval(cleanMemoryCache, cleanMemoryTimer);\n\n  function cleanMemoryCache() {\n    var now = Date.now();\n    var oldest = {\n      key: undefined,\n      time: now\n    };\n    var deleteCount = 0;\n    (0, _keys2.default)(memoryCache).forEach(function (key) {\n      if (!memoryCache[key].promise && now - memoryCache[key].access < timeThreshold) {\n        if (memoryCache[key].access < oldest) {\n          oldest = {\n            key: key,\n            time: memoryCache[key].access\n          };\n        }\n\n        delete memoryCache[key];\n        deleteCount++;\n      }\n    });\n\n    if (deleteCount === 0 && oldest.key) {\n      delete memoryCache[oldest.key];\n    }\n  }\n  /** Save resource to in-memory cache and schedule PUT */\n\n\n  function handleMemoryCache(resourceId, data, waitTime, req) {\n    var now = Date.now();\n\n    if (resourceId in memoryCache) {\n      // resource exists in in-cache memory\n      // update data and access time\n      memoryCache[resourceId].data = data;\n      memoryCache[resourceId].access = now;\n    } else {\n      // resource does not exist\n      // add new resource\n      memoryCache[resourceId] = {\n        data: data,\n        access: now,\n        promise: undefined\n      };\n    } // Schedule db.put\n\n\n    if (!memoryCache[resourceId].promise) {\n      // Schedule put\n      memoryCache[resourceId].promise = Promise.delay(dbPutDelay).then(function () {\n        doPut(resourceId, waitTime, req);\n      }).catch(function (error) {\n        console.log('handleMemoryCacheError', error);\n      });\n    }\n\n    return Promise.resolve();\n  }\n  /**  Get resource from in-memory cache and do put to Pouch DB */\n\n\n  function doPut(resourceId, waitTime, req) {\n    return db.put(memoryCache[resourceId].data).then(function (response) {\n      memoryCache[resourceId].data._rev = response.rev;\n      delete memoryCache[resourceId].promise;\n    }).catch(function (err) {\n      console.log(\"Error doPut\", memoryCache[resourceId].data._rev, err); // TODO: Handle this error\n      // retry 409s\n      // if (err.status === 409) {\n      //   waitTime = waitTime || 1000;\n      //   return Promise.delay(waitTime).then(() => {\n      //     if (waitTime > 16000) throw err;\n      //     return dbUpsert(req, waitTime * 2);\n      //   });\n      // }\n      //throw err;\n    });\n  }\n\n  function _getMemoryCache() {\n    return memoryCache;\n  } // Perform lookup from bookmarks to resource id (and path leftover) mapping.\n  // If the lookup fails, use a HEAD request to get it from the server and put\n  // it in the cache. An optional _id can be passed into req to force creation\n  // of a particular lookup in the event that the resource doesn't yet exist but will.\n  // This is primarily for when links are created before the resource itself has been.\n\n\n  function getLookup(req) {\n    var urlObj = url.parse(req.url);\n    var res_inmemory = memoryCache[urlObj.path];\n\n    if (res_inmemory) {\n      return res_inmemory.data;\n    } else {\n      // not in memory  \n      return db.get(urlObj.path).catch((0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee4() {\n        var resourceId, pathLeftover, response, pieces, data;\n        return _regenerator2.default.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                if (!req.resourceId) {\n                  _context4.next = 5;\n                  break;\n                }\n\n                resourceId = req.resourceId;\n                pathLeftover = \"\";\n                _context4.next = 11;\n                break;\n\n              case 5:\n                _context4.next = 7;\n                return request({\n                  method: \"HEAD\",\n                  url: req.url,\n                  headers: req.headers\n                });\n\n              case 7:\n                response = _context4.sent; //info('getLookup - HEAD response:', response)\n                //Save the url lookup for future use\n\n                pieces = response.headers[\"content-location\"].split(\"/\");\n                resourceId = pieces.slice(1, 3).join(\"/\"); //returns resources/abc\n\n                pathLeftover = pieces.length > 3 ? \"/\" + pieces.slice(3, pieces.length).join(\"/\") : \"\";\n\n              case 11:\n                // Put the new lookup\n                data = {\n                  _id: urlObj.path,\n                  resourceId: resourceId,\n                  pathLeftover: pathLeftover\n                };\n                return _context4.abrupt(\"return\", handleMemoryCache(urlObj.path, data, undefined, req).then(function () {\n                  return getLookup(req);\n                }));\n\n              case 13:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      })));\n    }\n  }\n\n  function replaceLinks(obj, req) {\n    var ret = Array.isArray(obj) ? [] : {};\n    if (!obj) return obj;\n    (0, _keys2.default)(obj || {}).forEach(function () {\n      var _ref12 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee11(key, i) {\n        var val, lookup;\n        return _regenerator2.default.wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                val = obj[key];\n\n                if (!((typeof val === \"undefined\" ? \"undefined\" : (0, _typeof3.default)(val)) !== \"object\" || !val)) {\n                  _context11.next = 4;\n                  break;\n                }\n\n                ret[key] = val; // keep it asntType: 'application/vnd.oada.harvest.1+json'\n\n                return _context11.abrupt(\"return\");\n\n              case 4:\n                if (!val._meta) {\n                  _context11.next = 11;\n                  break;\n                }\n\n                _context11.next = 7;\n                return getLookup({\n                  url: req.url + \"/\" + key,\n                  headers: req.headers\n                });\n\n              case 7:\n                lookup = _context11.sent;\n                ret[key] = {\n                  _id: lookup.resourceId\n                };\n                if (obj[key]._rev !== undefined) ret[key]._rev = obj[key]._rev;\n                return _context11.abrupt(\"return\");\n\n              case 11:\n                ret[key] = replaceLinks(obj[key], {\n                  url: req.url + \"/\" + key,\n                  headers: req.headers\n                });\n              // otherwise, recurse into the object\n\n              case 12:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n\n      return function (_x15, _x16) {\n        return _ref12.apply(this, arguments);\n      };\n    }());\n    return ret;\n  }\n\n  function findNullValue(obj, path, nullPath) {\n    if ((typeof obj === \"undefined\" ? \"undefined\" : (0, _typeof3.default)(obj)) === \"object\") {\n      return Promise.map((0, _keys2.default)(obj || {}), function (key) {\n        if (obj[key] === null) {\n          nullPath = path + \"/\" + key;\n          return nullPath;\n        }\n\n        return findNullValue(obj[key], path + \"/\" + key, nullPath).then(function (res) {\n          nullPath = res || nullPath;\n          return res || nullPath;\n        });\n      }, {\n        concurrency: 1\n      }).then(function () {\n        return nullPath;\n      }).catch(function (err) {\n        return;\n      });\n    } else {\n      return Promise.resolve(undefined);\n    }\n  }\n  /*\n  async function _upsertChangeArray(payload) {\n    let urlObj = url.parse(payload.request.url);\n    return Promise.map(payload.response.changes || [], async (change) => {\n      if (change.type === 'merge') {\n        return dbUpsert({\n          url: urlObj.protocol+'//'+urlObj.host+'/'+change._id,\n          data: change.body,\n        })\n      } else if (change.type === 'delete') {\n        var nullPath = await findNullValue(change.body, '', '')\n        return dbUpsert({\n          url: urlObj.protocol+'//'+urlObj.host+'/'+change._id+nullPath,\n          data: change.body,\n        })\n      }\n    })\n  }\n  */\n  // Will this handle watches put on keys of a resource? i.e., no _id to be found\n\n\n  function findDeepestResource(obj, path, deepestResource) {\n    if ((typeof obj === \"undefined\" ? \"undefined\" : (0, _typeof3.default)(obj)) === \"object\") {\n      return Promise.map((0, _keys2.default)(obj || {}), function (key) {\n        // _rev updates guaranteed to be present in change docs for affected resources\n        if (key === \"_rev\") {\n          deepestResource.path = path;\n          deepestResource.data = obj;\n        } else if (key.charAt(0) === \"_\") return deepestResource;\n\n        return findDeepestResource(obj[key], path + \"/\" + key, deepestResource).then(function () {\n          return deepestResource;\n        });\n      }).then(function () {\n        return deepestResource;\n      });\n    }\n\n    return Promise.resolve(deepestResource);\n  }\n\n  var queue = cq().limit({\n    concurrency: 1\n  }).process(function () {\n    var _ref15 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee16(payload) {\n      var _this = this;\n\n      var urlObj;\n      return _regenerator2.default.wrap(function _callee16$(_context16) {\n        while (1) {\n          switch (_context16.prev = _context16.next) {\n            case 0:\n              urlObj = url.parse(payload.request.url); // Give the change body an _id so the deepest resource can be found\n\n              payload.response.change.body._id = payload.response.resourceId; //TODO: This should be unnecessary. The payload ought to specify the root\n              //of the watch as a resource.\n\n              return _context16.abrupt(\"return\", findDeepestResource(payload.response.change.body, \"\", {\n                path: \"\",\n                data: payload.response.change.body\n              }).then(function () {\n                var _ref16 = (0, _asyncToGenerator3.default)(\n                /*#__PURE__*/\n                _regenerator2.default.mark(function _callee15(deepestResource) {\n                  var nullPath, deletedPath;\n                  return _regenerator2.default.wrap(function _callee15$(_context15) {\n                    while (1) {\n                      switch (_context15.prev = _context15.next) {\n                        case 0:\n                          if (!payload.response.change.wasDelete) {\n                            _context15.next = 9;\n                            break;\n                          }\n\n                          _context15.next = 3;\n                          return findNullValue(deepestResource.data, \"\", \"\");\n\n                        case 3:\n                          nullPath = _context15.sent;\n                          deletedPath = deepestResource.path + nullPath;\n                          payload.nullPath = deletedPath;\n                          return _context15.abrupt(\"return\", dbUpsert({\n                            url: payload.request.url + deletedPath,\n                            headers: payload.request.headers,\n                            method: \"delete\",\n                            valid: true\n                          }).then((0, _asyncToGenerator3.default)(\n                          /*#__PURE__*/\n                          _regenerator2.default.mark(function _callee14() {\n                            return _regenerator2.default.wrap(function _callee14$(_context14) {\n                              while (1) {\n                                switch (_context14.prev = _context14.next) {\n                                  case 0:\n                                    return _context14.abrupt(\"return\", payload);\n\n                                  case 1:\n                                  case \"end\":\n                                    return _context14.stop();\n                                }\n                              }\n                            }, _callee14, this);\n                          }))));\n\n                        case 9:\n                          _context15.next = 11;\n                          return _recursiveUpsert(payload.request, payload.response.change.body, {});\n\n                        case 11:\n                          return _context15.abrupt(\"return\", payload);\n\n                        case 12:\n                        case \"end\":\n                          return _context15.stop();\n                      }\n                    }\n                  }, _callee15, _this);\n                }));\n\n                return function (_x21) {\n                  return _ref16.apply(this, arguments);\n                };\n              }()).catch(function (err) {\n                return payload;\n              }));\n\n            case 3:\n            case \"end\":\n              return _context16.stop();\n          }\n        }\n      }, _callee16, this);\n    }));\n\n    return function (_x20) {\n      return _ref15.apply(this, arguments);\n    };\n  }());\n\n  function handleWatchChange(payload) {\n    return queue(payload);\n  }\n\n  var api = function handleRequest(req) {\n    switch (req.method) {\n      case \"get\":\n        return get(req);\n\n      case \"delete\":\n        return del(req);\n\n      case \"put\":\n        return put(req);\n    }\n  };\n\n  return _ref20 = {\n    api: api,\n    db: db,\n    resetCache: resetCache,\n    handleWatchChange: handleWatchChange,\n    removeLookup: removeLookup,\n    findDeepestResource: findDeepestResource,\n    findNullValue: findNullValue,\n    getLookup: getLookup,\n    dbUpsert: dbUpsert,\n    handleMemoryCache: handleMemoryCache,\n    doPut: doPut\n  }, (0, _defineProperty3.default)(_ref20, \"findDeepestResource\", findDeepestResource), (0, _defineProperty3.default)(_ref20, \"_recursiveUpsert\", _recursiveUpsert), (0, _defineProperty3.default)(_ref20, \"findNullValue\", findNullValue), (0, _defineProperty3.default)(_ref20, \"replaceLinks\", replaceLinks), (0, _defineProperty3.default)(_ref20, \"removeLookup\", removeLookup), (0, _defineProperty3.default)(_ref20, \"updateParent\", updateParent), (0, _defineProperty3.default)(_ref20, \"getResFromDb\", getResFromDb), (0, _defineProperty3.default)(_ref20, \"getResFromServer\", getResFromServer), (0, _defineProperty3.default)(_ref20, \"_getMemoryCache\", _getMemoryCache), _ref20;\n}","'use strict';\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _defineProperty2 = require('babel-runtime/helpers/defineProperty');\n\nvar _defineProperty3 = _interopRequireDefault(_defineProperty2);\n\nvar _slicedToArray2 = require('babel-runtime/helpers/slicedToArray');\n\nvar _slicedToArray3 = _interopRequireDefault(_slicedToArray2);\n\nvar _entries = require('babel-runtime/core-js/object/entries');\n\nvar _entries2 = _interopRequireDefault(_entries);\n\nvar _stringify = require('babel-runtime/core-js/json/stringify');\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar Promise = require('bluebird');\n\nvar urlLib = require('url');\n\nvar uuid = require('uuid/v4');\n\nvar WebSocket = require('isomorphic-ws'); //const error = require('debug')('oada-cache:websocket:error');\n//const info = require('debug')('oada-cache:websocket:info');\n\n\nPromise.config({\n  warnings: false\n});\n\nfunction websocket(url) {\n  //Create the message queue\n  var messages = []; //Create the socket\n\n  url = url.replace('https://', 'wss://').replace('http://', 'ws://');\n  var socket = new WebSocket(url);\n  var connected = false;\n  var httpCallbacks = {};\n  var watchCallbacks = {};\n\n  function sendMessages() {\n    if (!connected) return;\n    messages.forEach(function (message) {\n      socket.send((0, _stringify2.default)(message));\n    });\n    messages = [];\n  }\n\n  return new Promise(function (resolve, reject) {\n    socket.onopen = function (event) {\n      connected = true;\n      sendMessages();\n      resolve(socket);\n    };\n\n    socket.onclose = function (event) {};\n\n    socket.onmessage = function (event) {\n      var response = JSON.parse(event.data); //Look for id in httpCallbacks\n\n      if (response.requestId) {\n        if (httpCallbacks[response.requestId]) {\n          //Resolve Promise\n          if (response.status >= 200 && response.status < 300) {\n            httpCallbacks[response.requestId].resolve(response);\n          } else {\n            //Create error like axios\n            var err = new Error('Request failed with status code ' + response.status);\n            err.request = httpCallbacks[response.requestId].request;\n            err.response = {\n              status: response.status,\n              statusText: response.statusText,\n              headers: response.headers,\n              data: response.data\n            };\n            httpCallbacks[response.requestId].reject(err);\n          }\n\n          delete httpCallbacks[response.requestId];\n        } else if (watchCallbacks[response.requestId]) {\n          if (watchCallbacks[response.requestId].resolve) {\n            if (response.status === 'success') {\n              //Successfully setup websocket, resolve promise\n              watchCallbacks[response.requestId].resolve(response);\n            } else {\n              //error(watchCallbacks[response.requestId].request, response);\n              var _err = new Error('Request failed with status code ' + response.status);\n\n              _err.response = response;\n              _err.request = watchCallbacks[response.requestId].request;\n              watchCallbacks[response.requestId].reject(_err);\n            } //Remove resolve and reject so we process change as a signal next time\n\n\n            delete watchCallbacks[response.requestId]['resolve'];\n            delete watchCallbacks[response.requestId]['reject'];\n          } else {\n            if (watchCallbacks[response.requestId].callback == null) throw new Error('The given watch function has an undefined callback:', watchCallbacks[response.requestId]);\n            watchCallbacks[response.requestId].callback(response);\n          }\n        }\n      }\n    };\n  }).then(function () {\n    function _http(request) {\n      //Do a HTTP request\n      return new Promise(function (resolve, reject) {\n        var urlObj = urlLib.parse(request.url);\n        var message = {\n          requestId: uuid(),\n          method: request.method.toLowerCase(),\n          path: urlObj.path,\n          data: request.data,\n          headers: (0, _entries2.default)(request.headers).map(function (_ref) {\n            var _ref2 = (0, _slicedToArray3.default)(_ref, 2),\n                key = _ref2[0],\n                value = _ref2[1];\n\n            return (0, _defineProperty3.default)({}, key.toLowerCase(), value);\n          }).reduce(function (a, b) {\n            return (0, _extends3.default)({}, a, b);\n          })\n        };\n        messages.push(message);\n        httpCallbacks[message.requestId] = {\n          request: request,\n          resolve: resolve,\n          reject: reject\n        };\n        sendMessages();\n      });\n    }\n\n    function _unwatch(request, callback) {\n      //Watch for changes on requested resource and trigger provided signal\n      return new Promise(function (resolve, reject) {\n        var message = {\n          requestId: uuid(),\n          method: 'unwatch',\n          path: request.path,\n          headers: (0, _entries2.default)(request.headers).map(function (_ref4) {\n            var _ref5 = (0, _slicedToArray3.default)(_ref4, 2),\n                key = _ref5[0],\n                value = _ref5[1];\n\n            return (0, _defineProperty3.default)({}, key.toLowerCase(), value);\n          }).reduce(function (a, b) {\n            return (0, _extends3.default)({}, a, b);\n          })\n        };\n        messages.push(message);\n        watchCallbacks[message.requestId] = {\n          request: request,\n          resolve: resolve,\n          reject: reject,\n          callback: callback\n        };\n        sendMessages();\n      });\n    }\n\n    function _watch(request, callback) {\n      //Watch for changes on requested resource and trigger provided signal\n      return new Promise(function (resolve, reject) {\n        var message = {\n          requestId: uuid(),\n          method: 'watch',\n          path: request.path,\n          headers: (0, _entries2.default)(request.headers).map(function (_ref7) {\n            var _ref8 = (0, _slicedToArray3.default)(_ref7, 2),\n                key = _ref8[0],\n                value = _ref8[1];\n\n            return (0, _defineProperty3.default)({}, key.toLowerCase(), value);\n          }).reduce(function (a, b) {\n            return (0, _extends3.default)({}, a, b);\n          })\n        };\n        messages.push(message);\n        watchCallbacks[message.requestId] = {\n          request: request,\n          resolve: resolve,\n          reject: reject,\n          callback: callback\n        };\n        sendMessages();\n      });\n    }\n\n    function _close() {\n      //TODO reject all callbacks that have not resolved\n      //Clear everything\n      messages = [];\n      httpCallbacks = {};\n      watchCallbacks = {}; //Close socket\n\n      socket.close();\n    }\n\n    return {\n      url: url,\n      http: _http,\n      close: _close,\n      watch: _watch,\n      unwatch: _unwatch\n    };\n  });\n}\n\nmodule.exports = websocket;"],"sourceRoot":""}