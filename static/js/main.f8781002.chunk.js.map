{"version":3,"sources":["../../oada-cache/build/token.js","components/AppBarContent/index.js","components/Visualization/Map/Lines/index.js","components/Visualization/Map/Markers/index.js","components/Visualization/Map/index.js","components/Visualization/Graph/index.js","components/Visualization/index.js","components/DrawerContent/Summary/index.js","components/DrawerContent/Diagnostics/index.js","components/DrawerContent/index.js","components/ConnectDialog/index.js","components/App/index.js","modules/session/sequences.js","modules/session/index.js","modules/map/sequences.js","modules/data/sequences.js","modules/diagnostics/sequences.js","modules/diagnostics/index.js","modules/map/index.js","modules/data/index.js","modules/snapshots/sequences.js","modules/snapshots/index.js","modules/connection/sequences.js","modules/connection/index.js","modules/root/sequences.js","modules/root/index.js","controller.js","index.js","../../oada-cache/build/index.js","../../oada-cache/build/cache.js","../../oada-cache/build/websocket.js"],"names":["_regenerator2","_interopRequireDefault","__webpack_require__","_asyncToGenerator3","_classCallCheck3","_createClass3","_pouchdb2","obj","__esModule","default","Promise","urlLib","crypto","oadaIdClient","Token","param","arguments","length","undefined","this","_token","token","_domain","domain","_options","options","hash","createHash","update","_name","digest","_isSet","_tokenDB","_id","_rev","key","value","_ref","mark","_callee","result","doc","wrap","_context","prev","next","get","sent","t0","abrupt","stop","apply","_ref2","_callee2","_expired","TOKEN","urlObj","gat","_context2","isSet","checkTokenDB","parse","window","node","host","promisify","getAccessToken","access_token","put","_x2","_ref3","_callee3","_context3","setup","_ref4","_callee4","_context4","_x3","_ref5","_callee5","_context5","_ref6","_callee6","_context6","destroy","module","exports","AppBarContent","userLocationButton","_this","classes","props","userLocationAvailable","react_default","a","createElement","IconButton_default","onClick","centerOnUser","MyLocation_default","className","icon","Toolbar_default","color","aria-label","toggleDrawerOpen","Menu_default","Typography_default","variant","flex","React","Component","connect","state","_templateObject","signal","_templateObject2","_templateObject3","withStyles","theme","_icon","Object","defineProperty","breakpoints","up","width","spacing","unit","height","marginRight","down","Lines","conn_id","connection_id","ready","dataLines","oada","bookmarks","hasOwnProperty","devices","isoblue","selectedUnit","date","hour","gps_data","e","console","error","points","_","forEach","instance","lat","lng","push","positions","unit_resource","location","date_list","keys","last_date","maxBy","o","Date","hour_list","current_hour","max","last_hour","remove","n","current_time_sec","Math","round","getTime","prev_gps_data","current_gps_data","map","posobj","Polyline","Lines_templateObject","Lines_templateObject2","Lines_templateObject3","_templateObject4","_templateObject5","_templateObject6","withTheme","Markers","unitMarkers","snapshots","tempGPS","CircleMarker","ref","center","fillColor","health","fillOpacity","radius","zIndexOffset","selectUnit","Tooltip","direction","offset","Markers_templateObject","Markers_templateObject2","refs","leafletElement","locate","currentMarker","Marker","position","userLocation","Map","dragging","targetCenter","zoom","onlocationfound","storeUserLocation","latlng","style","TileLayer","url","attribution","Map_Markers","Map_Lines","Map_templateObject","Map_templateObject2","Map_templateObject3","Map_templateObject4","Map_templateObject5","display","Graph","rawData","chart","data","measurement","values","heartbeats","latency","recTime","genTime","time","toLocaleTimeString","minute","es6","margin","top","right","left","bottom","type","isAnimationActive","dataKey","stroke","strokeDasharray","label","dy","angle","interfaces","connection","Graph_templateObject","Graph_templateObject2","Graph_templateObject3","Graph_templateObject4","Graph_templateObject5","Graph_templateObject6","_templateObject7","Visualization","mode","Visualization_Map","Visualization_Graph","Visualization_templateObject","Summary","units","List_default","list","component","ListItem_default","button","concat","ListItemText_default","primary","ListItemIcon_default","Sync_default","healthy","SyncProblem_default","sick","SyncDisabled_default","align","Divider_default","Summary_templateObject","Summary_templateObject2","backgroundColor","palette","background","paper","overflow","textField","Diagnostics","measurements","visualizing","Button_default","toggleMode","measurementSelect","Select_default","renderValue","onChange","setMeasurement","target","MenuItem_default","dateSelect","setDate","tzOffsetMinutes","getTimezoneOffset","genTimeLabel","hhmm","split","localMinutes","parseInt","msg","localMM","floor","toString","padStart","hourSelect","setHour","lastReport","lastLocationReport","unselectUnit","Diagnostics_templateObject","Diagnostics_templateObject2","Diagnostics_templateObject3","Diagnostics_templateObject4","Diagnostics_templateObject5","Diagnostics_templateObject6","Diagnostics_templateObject7","_templateObject8","_templateObject9","_templateObject10","_templateObject11","_templateObject12","_templateObject13","_templateObject14","_templateObject15","DrawerContent","content","DrawerContent_Diagnostics","DrawerContent_Summary","Drawer_default","open","drawerOpen","onClose","drawerPaper","toolbar","DrawerContent_templateObject","DrawerContent_templateObject2","DrawerContent_templateObject3","mixins","oadaDomainText","ConnectDialog_templateObject","ConnectDialog_templateObject2","submitClicked","ConnectDialog_templateObject3","oadaDomainChanged","ConnectDialog_templateObject4","_React$Component","ConnectDialog","classCallCheck","possibleConstructorReturn","getPrototypeOf","inherits","createClass","Dialog_default","index_es","id","autoFocus","fullwidth","App","init","root","AppBar_default","appBar","components_AppBarContent","components_DrawerContent","components_Visualization","components_ConnectDialog","App_templateObject","flexGrow","zIndex","drawer","sequence","toggle","sequences_templateObject","Module","dataReady","signals","set","map_sequences_templateObject","sequences_templateObject2","debounce","continue","sequences_templateObject3","sequences_templateObject4","discard","centerOnUnit","sequences_templateObject5","sequences_templateObject6","sequences_templateObject7","sequences_templateObject8","masterTree","_type","device-index","*","day-index","hour-index","dayTree","setRequestLastHour","requests","device_name","device_data","path","watch","tree","handleDeviceUpdate","data_sequences_templateObject","data_sequences_templateObject2","getDevices","data_sequences_templateObject3","data_sequences_templateObject4","data_sequences_templateObject5","data_sequences_templateObject6","data_sequences_templateObject7","getHour","diagnostics_sequences_templateObject","diagnostics_sequences_templateObject2","diagnostics_sequences_templateObject3","diagnostics_sequences_templateObject4","diagnostics_sequences_templateObject5","diagnostics_sequences_templateObject6","sort","b","diagnostics_sequences_templateObject7","diagnostics_sequences_templateObject8","sequences_templateObject9","when","sequences_templateObject10","true","sequences_templateObject11","sequences_templateObject12","false","sequences_templateObject13","sequences_templateObject14","createSnapshots","reduce","acc","unitkey","unitLocationData","lastDate","lastHour","lastGPS","msg_gps","lastHeartbeatTime","snapshots_sequences_templateObject","snapshots_sequences_templateObject2","signOut","connection_sequences_templateObject","connection_sequences_templateObject2","connection_sequences_templateObject3","connection_sequences_templateObject4","connection_sequences_templateObject5","updateOadaDomain","connection_sequences_templateObject6","connection_sequences_templateObject7","redirect","metadata","scope","connection_sequences_templateObject8","connection_sequences_templateObject9","connection_sequences_templateObject10","connection_sequences_templateObject11","connection_sequences_templateObject12","setConnection","connection_sequences_templateObject13","connection_sequences_templateObject14","dialog_open","oada_domain_text","oada_domain","providers","oadaProvider","modules","session","oadaModule","diagnostics","Controller","devtools","createMuiTheme","typography","useNextVariants","render","_cerebral_react","controller","core_styles","components_App","document","getElementById","_keys2","_typeof3","_cache2","_uuid2","_lodash2","pointer","ws","axios","_TOKEN","_callee18","CACHE","REQUEST","NOCACHEREQUEST","SOCKET","DOMAIN","NAME","EXPIRES","_replaceLinks","_watch","_findDeepestResources","_convertSetupTreePath","_configureCache","post","socketApi","_getMemoryCache","_makeResourceAndLink","waitTime","linkReq","resReq","link","pathPieces","parentPath","response","newHeaders","resource","headers","clone","status","splice","join","method","Authorization","t1","delay","cloneDeep","_buildRequest","_ref8","_ref7","req","Error","test","indexOf","toLowerCase","authorization","slice","header","_x5","_sendRequest","_ref9","reconnect","_x6","_ref11","_ref10","watchResponse","pieces","treePath","subTree","stuff","log","func","function","payload","replace","has","_recursiveGet","cached","_x7","_ref12","_callee7","got","_context7","x-oada-rev","_ref13","res","_x12","then","_x8","_x9","_x10","_x11","_ensureTree","_ref15","_callee9","_ref14","firstPath","storedTree","responses","ret","parentRev","_context9","mapSeries","stored","_ref16","_callee8","piece","j","i","urlPath","resp","_context8","if-match","_x14","_x15","_x13","_recursiveDelete","_ref19","_callee12","_context12","_ref20","_callee10","_context10","_x19","_callee11","_context11","del","content-type","removeLookup","_x16","_x17","_x18","_ref23","_callee13","_ref22","unwatch","_context13","_x20","_ref25","_callee14","_ref24","_context14","_x21","resetCache","_ref26","_callee15","name","expires","_context15","_x22","_x23","disconnect","_ref27","_callee16","_context16","db","close","cleanUp","_ref28","_callee17","_context17","renew","cache","websocket","_context18","_ref18","_ref17","api","newPieces","z","catch","err","message","watchPayload","request","change","handleWatchChange","_x4","Array","isArray","val","hostname","http","delete","_x","_defineProperty3","dbUpsert","resourceId","pathLeftover","dbPut","memoryResult","curData","newData","valid","accessed","now","memoryCache","INCOMPLETE_RESOURCE","promise","cancel","merge","handleMemoryCache","getResFromServer","getResFromDb","res_inmemory","res_localdb","offline","revLimit","expiration","content-location","newReq","lookup","getLookup","protocol","OFFLINE","REVLIMIT","reqPieces","updateParent","_recursiveUpsert","body","newBody","replaceLinks","charAt","on","dbName","access","dbPutDelay","doPut","resolve","rev","_meta","findNullValue","nullPath","concurrency","findDeepestResource","deepestResource","setInterval","oldest","deleteCount","timeThreshold","cleanMemoryTimer","queue","cq","limit","process","deletedPath","wasDelete","config","cancellation","_extends3","_slicedToArray3","_entries2","_stringify2","uuid","WebSocket","warnings","messages","socket","connected","httpCallbacks","watchCallbacks","sendMessages","send","reject","onopen","event","onclose","onmessage","JSON","requestId","statusText","_err","callback"],"mappings":"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","file":"static/js/main.f8781002.chunk.js","sourcesContent":["\"use strict\";\n/* Copyright 2018 Open Ag Data Alliance\n *\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @author Servio Palacios, Samuel Noel\n * Token API for Handling Tokens in the Cache Library - Super Class.\n * @module src/token\n */\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require(\"babel-runtime/helpers/asyncToGenerator\");\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require(\"babel-runtime/helpers/createClass\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _pouchdb = require(\"pouchdb\");\n\nvar _pouchdb2 = _interopRequireDefault(_pouchdb);\n\nvar _http = require(\"http\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar Promise = require(\"bluebird\");\n\nvar urlLib = require(\"url\");\n\nvar _ = require(\"lodash\"); //const debug = require(\"debug\")(\"oada-cache:token\");\n\n\nvar crypto = require(\"crypto\");\n\nvar oadaIdClient = require(\"@oada/oada-id-client\"); //const error = require('debug')('oada-cache:index:error');\n//const info = require('debug')('oada-cache:index:info');\n\n\nvar Token = function () {\n  function Token() {\n    var param = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    (0, _classCallCheck3.default)(this, Token);\n    var self = this;\n    self._token = param.token || null;\n    self._domain = param.domain || \"localhost\";\n    self._options = param.options; // creating database nae based on the domain\n    // ensured one to one correspondence with the domain\n    // i.e., token belongs to that domain\n\n    var hash = crypto.createHash(\"sha256\");\n    hash.update(self._domain);\n    self._name = hash.digest(\"hex\");\n    self._isSet = self._token ? true : false;\n    self._tokenDB = new _pouchdb2.default(this._name);\n    self._id = \"OadaTokenID\";\n    self._rev = null;\n    self.token = self._token ? self._token : \"\";\n  } //constructor\n\n  /**\n   * searches for a local db and a doc\n   */\n\n\n  (0, _createClass3.default)(Token, [{\n    key: \"checkTokenDB\",\n    value: function () {\n      var _ref = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee() {\n        var result, doc;\n        return _regenerator2.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                result = null;\n                _context.prev = 1;\n                _context.next = 4;\n                return this._tokenDB.get(this._id);\n\n              case 4:\n                doc = _context.sent; //      debug(\"received document ->\", doc);\n\n                result = doc.token;\n                this._rev = doc._rev;\n                _context.next = 12;\n                break;\n\n              case 9:\n                _context.prev = 9;\n                _context.t0 = _context[\"catch\"](1);\n                return _context.abrupt(\"return\", result);\n\n              case 12:\n                return _context.abrupt(\"return\", result);\n\n              case 13:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[1, 9]]);\n      }));\n\n      function checkTokenDB() {\n        return _ref.apply(this, arguments);\n      }\n\n      return checkTokenDB;\n    }() //checkTokenDB\n\n    /**\n     * if token was provided then it sets the .token in the constructor -> returns that value\n     * sets the pouch db if it does not exist\n     */\n\n  }, {\n    key: \"setup\",\n    value: function () {\n      var _ref2 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee2(_expired) {\n        var TOKEN, urlObj, result, gat;\n        return _regenerator2.default.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                // Get a token\n                TOKEN = null; //returned to the chache library\n\n                if (!this.isSet()) {\n                  _context2.next = 5;\n                  break;\n                }\n\n                TOKEN = this.token;\n                _context2.next = 23;\n                break;\n\n              case 5:\n                _context2.next = 7;\n                return this.checkTokenDB();\n\n              case 7:\n                TOKEN = _context2.sent;\n\n                if (!(!TOKEN || _expired)) {\n                  _context2.next = 23;\n                  break;\n                } //local cache does not have a token\n\n\n                urlObj = urlLib.parse(this._domain);\n                result = void 0; // Open the browser and the login popup\n\n                if (!(typeof window === \"undefined\")) {\n                  _context2.next = 17;\n                  break;\n                }\n\n                _context2.next = 14;\n                return oadaIdClient.node(urlObj.host, this._options);\n\n              case 14:\n                result = _context2.sent;\n                _context2.next = 21;\n                break;\n\n              case 17:\n                // the library itself detects a browser environment and delivers .browser\n                gat = Promise.promisify(oadaIdClient.getAccessToken);\n                _context2.next = 20;\n                return gat(urlObj.host, this._options);\n\n              case 20:\n                result = _context2.sent;\n\n              case 21:\n                TOKEN = result.access_token; //        debug(\"setup token -> access token:\", result.access_token);\n\n                this.put(TOKEN);\n\n              case 23:\n                return _context2.abrupt(\"return\", TOKEN);\n\n              case 24:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function setup(_x2) {\n        return _ref2.apply(this, arguments);\n      }\n\n      return setup;\n    }() //setup\n\n    /**\n     * fetches the token from the this._tokenDB or\n     * setups the new database and retrieves the new token to be used\n     */\n\n  }, {\n    key: \"get\",\n    value: function () {\n      var _ref3 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee3() {\n        return _regenerator2.default.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                return _context3.abrupt(\"return\", this.setup());\n\n              case 1:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function get() {\n        return _ref3.apply(this, arguments);\n      }\n\n      return get;\n    }()\n    /**\n     * searches for the token in the this._tokenDB\n     * if present, the it sends the current _rev\n     * if not present (404), it creates a new document in the created this._tokenDB\n     * @param {string} _token\n     */\n\n  }, {\n    key: \"put\",\n    value: function () {\n      var _ref4 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee4(_token) {\n        var TOKEN, response, _response;\n\n        return _regenerator2.default.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                // get token from local cache\n                TOKEN = this.checkTokenDB();\n                _context4.prev = 1;\n\n                if (!TOKEN) {\n                  _context4.next = 9;\n                  break;\n                }\n\n                _context4.next = 5;\n                return this._tokenDB.put({\n                  _id: this._id,\n                  _rev: this._rev,\n                  token: _token\n                });\n\n              case 5:\n                response = _context4.sent;\n                this.token = _token;\n                _context4.next = 13;\n                break;\n\n              case 9:\n                _context4.next = 11;\n                return this._tokenDB.put({\n                  _id: this._id,\n                  token: _token\n                });\n\n              case 11:\n                _response = _context4.sent;\n                this.token = _token;\n\n              case 13:\n                _context4.next = 17;\n                break;\n\n              case 15:\n                _context4.prev = 15;\n                _context4.t0 = _context4[\"catch\"](1);\n\n              case 17:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this, [[1, 15]]);\n      }));\n\n      function put(_x3) {\n        return _ref4.apply(this, arguments);\n      }\n\n      return put;\n    }() //put\n\n  }, {\n    key: \"renew\",\n    value: function () {\n      var _ref5 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee5() {\n        return _regenerator2.default.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                this._isSet = false;\n                return _context5.abrupt(\"return\", this.setup(true));\n\n              case 2:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function renew() {\n        return _ref5.apply(this, arguments);\n      }\n\n      return renew;\n    }()\n  }, {\n    key: \"cleanUp\",\n    value: function () {\n      var _ref6 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee6() {\n        return _regenerator2.default.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.prev = 0;\n                _context6.next = 3;\n                return this._tokenDB.destroy();\n\n              case 3:\n                //await this._tokenDB.close();\n                this._isSet = false;\n                _context6.next = 8;\n                break;\n\n              case 6:\n                _context6.prev = 6;\n                _context6.t0 = _context6[\"catch\"](0);\n\n              case 8:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this, [[0, 6]]);\n      }));\n\n      function cleanUp() {\n        return _ref6.apply(this, arguments);\n      }\n\n      return cleanUp;\n    }() //cleanUp\n\n  }, {\n    key: \"isSet\",\n    value: function isSet() {\n      return this._isSet;\n    }\n  }]);\n  return Token;\n}(); //class\n\n/* exporting the module */\n\n\nmodule.exports = Token;","import React from \"react\";\n\nimport { withStyles } from \"@material-ui/core/styles\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport Typography from \"@material-ui/core/Typography\";\nimport Toolbar from \"@material-ui/core/Toolbar\";\n//import TextField from '@material-ui/core/TextField';\nimport MyLocationIcon from \"@material-ui/icons/MyLocation\";\nimport MenuIcon from \"@material-ui/icons/Menu\";\n\nimport { connect } from \"@cerebral/react\";\nimport { state, signal } from \"cerebral/tags\";\n\nconst styles = theme => ({\n  flex: {\n    flex: 1,\n  },\n  icon: {\n    color: \"#FFFFFF\",\n    [theme.breakpoints.up(\"xs\")]: {\n      width: 5 * theme.spacing.unit,\n      height: 5 * theme.spacing.unit,\n      marginRight: theme.spacing.unit,\n    },\n    [theme.breakpoints.down(\"xs\")]: {\n      width: 4 * theme.spacing.unit,\n      height: 4 * theme.spacing.unit,\n      marginRight: theme.spacing.unit,\n    },\n  },\n});\n\nclass AppBarContent extends React.Component {\n  render() {\n    const { classes } = this.props;\n\n    var userLocationButton;\n    if (this.props.userLocationAvailable) {\n      userLocationButton = (\n        <IconButton onClick={() => this.props.centerOnUser({})}>\n          <MyLocationIcon className={classes.icon} />\n        </IconButton>\n      );\n    } else {\n      userLocationButton = null;\n    }\n\n    return (\n      <Toolbar>\n        <IconButton\n          color=\"inherit\"\n          aria-label=\"Open Drawer\"\n          onClick={() => this.props.toggleDrawerOpen({})}\n        >\n          <MenuIcon className={classes.icon} />\n        </IconButton>\n        <Typography variant=\"h6\" color=\"inherit\" className={classes.flex}>\n          ISOBlueApp [1.1.2]\n        </Typography>\n        {userLocationButton}\n      </Toolbar>\n    );\n  }\n}\n\nexport default connect(\n  {\n    userLocationAvailable: state`map.userLocationAvailable`,\n\n    centerOnUser: signal`map.centerOnUser`,\n    toggleDrawerOpen: signal`session.toggleDrawerOpen`,\n  },\n  withStyles(styles)(AppBarContent),\n);\n","import React from \"react\";\nimport _ from \"lodash\";\nimport { connect } from \"@cerebral/react\";\nimport { state } from \"cerebral/tags\";\nimport uuid from \"uuid\";\n//import Leaflet from 'leaflet';\nimport { Polyline } from \"react-leaflet\";\nimport { withStyles } from \"@material-ui/core/styles\";\n\nconst styles = theme => ({});\n\nclass Lines extends React.Component {\n  render() {\n    // get connection id\n    const conn_id = this.props.connection_id;\n\n    // do not render lines if data is not ready\n    if (!this.props.ready) return null;\n\n    var dataLines = [];\n\n    if (!this.props.oada[conn_id].bookmarks.hasOwnProperty(\"isoblue\")) {\n      return null;\n    }\n\n    const devices =\n      this.props.oada[conn_id].bookmarks.isoblue[\"device-index\"] || {};\n\n    // Unit is selected\n    if (this.props.selectedUnit && this.props.date && this.props.hour) {\n      // ensure that the target resource actually exists\n      var gps_data = null;\n      try {\n        gps_data =\n          devices[this.props.selectedUnit][\"location\"][\"day-index\"][\n            this.props.date\n          ][\"hour-index\"][this.props.hour][\"sec-index\"];\n      } catch (e) {\n        console.error(\"hmm\");\n        return null;\n      }\n\n      // make a line\n      var points = [];\n      _.forEach(gps_data, instance => {\n        if (\n          instance.hasOwnProperty(\"lat\") &&\n          instance.hasOwnProperty(\"lng\") &&\n          instance.lat &&\n          instance.lng\n        ) {\n          points.push([instance.lat, instance.lng]);\n        }\n      });\n\n      // add line\n      dataLines.push({ unit: this.props.selectedUnit, positions: points });\n    }\n\n    // None of the units is selected\n    else {\n      _.forEach(devices, (unit_resource, unit) => {\n        // get the most recent date\n        if (!unit_resource.hasOwnProperty(\"location\")) return;\n        if (!unit_resource.location.hasOwnProperty(\"day-index\")) return;\n        const date_list = Object.keys(unit_resource[\"location\"][\"day-index\"]);\n        if (date_list.length === 0) return;\n        const last_date = _.maxBy(date_list, function(o) {\n          return new Date(o);\n        });\n\n        // get hours\n        if (\n          !unit_resource[\"location\"][\"day-index\"][last_date].hasOwnProperty(\n            \"hour-index\",\n          )\n        )\n          return;\n        const hour_list = Object.keys(\n          unit_resource[\"location\"][\"day-index\"][last_date][\"hour-index\"],\n        );\n\n        const current_hour = _.max(hour_list);\n        const last_hour = _.max(\n          _.remove(hour_list, n => {\n            return n !== current_hour;\n          }),\n        );\n        var current_time_sec = Math.round(new Date().getTime() / 1000);\n        var positions = [];\n\n        if (\n          last_hour !== undefined &&\n          unit_resource[\"location\"][\"day-index\"][last_date][\"hour-index\"][\n            last_hour\n          ].hasOwnProperty(\"sec-index\")\n        ) {\n          const prev_gps_data =\n            unit_resource[\"location\"][\"day-index\"][last_date][\"hour-index\"][\n              last_hour\n            ][\"sec-index\"];\n          var prev_gps_ts = Object.keys(prev_gps_data || {});\n          prev_gps_ts.forEach(o => {\n            if (\n              current_time_sec - o <= 15 * 60 &&\n              prev_gps_data[o].hasOwnProperty(\"lat\") &&\n              prev_gps_data[o].hasOwnProperty(\"lng\") &&\n              prev_gps_data[o].lat &&\n              prev_gps_data[o].lng\n            ) {\n              positions.push([prev_gps_data[o].lat, prev_gps_data[o].lng]);\n            }\n          });\n        }\n\n        if (\n          unit_resource[\"location\"][\"day-index\"][last_date][\"hour-index\"][\n            current_hour\n          ].hasOwnProperty(\"sec-index\")\n        ) {\n          const current_gps_data =\n            unit_resource[\"location\"][\"day-index\"][last_date][\"hour-index\"][\n              current_hour\n            ][\"sec-index\"];\n          var current_gps_ts = Object.keys(current_gps_data || {});\n          current_gps_ts.forEach(o => {\n            if (\n              current_time_sec - o <= 15 * 60 &&\n              current_gps_data[o].hasOwnProperty(\"lat\") &&\n              current_gps_data[o].hasOwnProperty(\"lng\") &&\n              current_gps_data[o].lat &&\n              current_gps_data[o].lng\n            ) {\n              positions.push([\n                current_gps_data[o].lat,\n                current_gps_data[o].lng,\n              ]);\n            }\n          });\n        }\n\n        // FIXME: currentGPS and lastGPS are not guaranteed to be sorted\n        dataLines.push({ unit, positions });\n      });\n    }\n\n    return (\n      <div>\n        {dataLines.map(posobj => (\n          <Polyline\n            key={posobj.unit}\n            positions={posobj.positions}\n            color=\"#ffffff\"\n          />\n        ))}\n      </div>\n    );\n  }\n}\n\nexport default connect(\n  {\n    connection_id: state`data.connection_id`,\n    ready: state`data.ready`,\n    oada: state`oada`,\n    date: state`diagnostics.date`,\n    hour: state`diagnostics.hour`,\n    selectedUnit: state`diagnostics.selectedUnit`,\n  },\n  withStyles(styles, { withTheme: true })(Lines),\n);\n","import React from \"react\";\nimport _ from \"lodash\";\nimport { connect } from \"@cerebral/react\";\nimport { state, signal } from \"cerebral/tags\";\nimport { CircleMarker, Tooltip } from \"react-leaflet\";\nimport { withStyles } from \"@material-ui/core/styles\";\n\nconst styles = theme => ({});\n\nclass Markers extends React.Component {\n  render() {\n    const unitMarkers = [];\n    _.forEach(Object.keys(this.props.snapshots) || {}, unit => {\n      var tempGPS = this.props.snapshots[unit].location;\n      if (\n        tempGPS &&\n        tempGPS.hasOwnProperty(\"lat\") &&\n        tempGPS.hasOwnProperty(\"lng\") &&\n        tempGPS.lat &&\n        tempGPS.lng\n      ) {\n        unitMarkers.push(\n          <CircleMarker\n            ref={unit => {\n              this.unit = unit;\n            }}\n            key={unit}\n            center={[\n              this.props.snapshots[unit].location.lat,\n              this.props.snapshots[unit].location.lng,\n            ]}\n            color={\"#ffffff\"}\n            fillColor={(() => {\n              switch (this.props.snapshots[unit].health) {\n                case \"Healthy\":\n                  return \"#008000\";\n                case \"Sick\":\n                  return \"#ffbf00\";\n                case \"Down\":\n                  return \"#707070\";\n                default:\n                  return \"#707070\";\n              }\n            })()}\n            fillOpacity={1}\n            radius={12}\n            zIndexOffset={1}\n            onClick={e => this.props.selectUnit({ unit: unit })}\n          >\n            <Tooltip direction=\"top\" offset={[0, -10]}>\n              <b>Unit: {unit}</b>\n              <br />\n              <center>\n                <b>{this.props.snapshots[unit].health}</b>\n              </center>\n            </Tooltip>\n          </CircleMarker>,\n        );\n      }\n    });\n\n    return <div>{unitMarkers}</div>;\n  }\n}\n\nexport default connect(\n  {\n    snapshots: state`snapshots`,\n    selectUnit: signal`diagnostics.selectUnit`,\n  },\n  withStyles(styles, { withTheme: true })(Markers),\n);\n","import React from \"react\";\nimport { connect } from \"@cerebral/react\";\nimport { state, signal } from \"cerebral/tags\";\nimport { Map, Marker, TileLayer } from \"react-leaflet\";\nimport PropTypes from \"prop-types\";\nimport { withStyles } from \"@material-ui/core/styles\";\n\nimport \"./Map.css\";\nimport Lines from \"./Lines/\";\nimport Markers from \"./Markers/\";\n\nconst styles = theme => ({\n  map: {\n    position: \"relative\",\n    display: \"flex\",\n    width: \"100%\",\n    height: \"calc(100% - 56px)\",\n  },\n});\n\nconst mapTiles =\n  \"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}\";\nconst attrib =\n  \"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community\";\n\nclass map extends React.Component {\n  componentDidMount() {\n    this.refs.map.leafletElement.locate();\n  }\n\n  render() {\n    const { classes } = this.props;\n\n    const currentMarker = [];\n    if (this.props.userLocationAvailable) {\n      currentMarker.push(\n        <Marker\n          key={\"user\"}\n          position={[this.props.userLocation.lat, this.props.userLocation.lng]}\n        >\n          zIndexOffset={1}\n        </Marker>,\n      );\n    }\n\n    return (\n      <div className={classes.map}>\n        <Map\n          dragging={true}\n          center={[this.props.targetCenter.lat, this.props.targetCenter.lng]}\n          ref=\"map\"\n          zoom={18}\n          onlocationfound={e =>\n            this.props.storeUserLocation({\n              lat: e.latlng.lat,\n              lng: e.latlng.lng,\n            })\n          }\n          style={{ height: \"100%\", width: \"100%\", position: \"relative\" }}\n        >\n          <TileLayer url={mapTiles} attribution={attrib} />\n          <Markers />\n          <Lines />\n          {currentMarker}\n        </Map>\n      </div>\n    );\n  }\n}\n\nmap.propTypes = {\n  classes: PropTypes.object.isRequired,\n  theme: PropTypes.object.isRequired,\n};\n\nexport default connect(\n  {\n    // states\n    targetCenter: state`map.targetCenter`,\n    userLocation: state`map.userLocation`,\n    userLocationAvailable: state`map.userLocationAvailable`,\n    // signals\n    storeUserLocation: signal`map.storeUserLocation`,\n    selectUnit: signal`diagnostics.selectUnit`,\n  },\n  withStyles(styles, { withTheme: true })(map),\n);\n","import React from \"react\";\nimport { connect } from \"@cerebral/react\";\nimport { state } from \"cerebral/tags\";\nimport {\n  LineChart,\n  Line,\n  CartesianGrid,\n  XAxis,\n  YAxis,\n  ResponsiveContainer,\n  Tooltip,\n} from \"recharts\";\nimport _ from \"lodash\";\nimport { withStyles } from \"@material-ui/core/styles\";\n\nconst styles = theme => ({});\n\nclass Graph extends React.Component {\n  render() {\n    var rawData;\n    if (this.props.selectedUnit && this.props.date && this.props.hour) {\n      rawData = this.props.oada[this.props.connection_id].bookmarks.isoblue[\n        \"device-index\"\n      ][this.props.selectedUnit][\"day-index\"][this.props.date][\"hour-index\"][\n        this.props.hour\n      ];\n    } else {\n      // this should not happen\n      return null;\n    }\n\n    var data = [];\n    var chart;\n    if (this.props.measurement === \"Latency\" && rawData) {\n      _.forEach(Object.values(rawData.heartbeats || {}), value => {\n        value.latency = value.recTime - value.genTime;\n        value.time = new Date(value.genTime * 1000).toLocaleTimeString(\n          \"en-US\",\n          { hour: \"numeric\", minute: \"numeric\" },\n        );\n        data.push(value);\n      });\n\n      chart = (\n        <LineChart\n          data={data}\n          margin={{ top: 20, right: 30, left: 0, bottom: 80 }}\n        >\n          <Line\n            type=\"step\"\n            isAnimationActive={false}\n            dataKey={\"latency\"}\n            stroke=\"#8884d8\"\n          />\n          <CartesianGrid stroke=\"#ccc\" strokeDasharray=\"5 5\" />\n          <XAxis\n            dataKey={\"time\"}\n            label={{ value: \"Time\", position: \"insideBottom\", dy: 20 }}\n          />\n          <YAxis\n            dataKey={\"latency\"}\n            label={{\n              value: \"Latency (sec)\",\n              position: \"insideLeft\",\n              angle: -90,\n            }}\n          />\n          <Tooltip />\n        </LineChart>\n      );\n    } else if (this.props.measurement === \"Wifi RSSI\" && rawData) {\n      _.forEach(Object.values(rawData.heartbeats || {}), value => {\n        _.forEach(value.interfaces, connection => {\n          if (connection.type === \"wifi\") {\n            connection.time = new Date(value.genTime * 1000).toLocaleTimeString(\n              \"en-US\",\n              { hour: \"numeric\", minute: \"numeric\" },\n            );\n            data.push(connection);\n          }\n        });\n      });\n\n      chart = (\n        <LineChart\n          data={data}\n          margin={{ top: 20, right: 30, left: 0, bottom: 80 }}\n        >\n          <Line\n            type=\"step\"\n            isAnimationActive={false}\n            dataKey={\"rssi\"}\n            stroke=\"#8884d8\"\n          />\n          <CartesianGrid stroke=\"#ccc\" strokeDasharray=\"5 5\" />\n          <XAxis dataKey={\"time\"} />\n          <YAxis\n            dataKey={\"rssi\"}\n            label={{\n              value: \"WiFi RSSI (dB)\",\n              position: \"insideLeft\",\n              angle: -90,\n            }}\n          />\n          <Tooltip />\n        </LineChart>\n      );\n    } else if (this.props.measurement === \"Cellular RSSI\" && rawData) {\n      _.forEach(Object.values(rawData.heartbeats || {}), value => {\n        _.forEach(value.interfaces, connection => {\n          if (connection.type === \"cellular\") {\n            connection.time = new Date(value.genTime * 1000).toLocaleTimeString(\n              \"en-US\",\n              { hour: \"numeric\", minute: \"numeric\" },\n            );\n            data.push(connection);\n          }\n        });\n      });\n\n      chart = (\n        <LineChart\n          data={data}\n          margin={{ top: 20, right: 30, left: 0, bottom: 80 }}\n        >\n          <Line\n            type=\"step\"\n            isAnimationActive={false}\n            dataKey={\"rssi\"}\n            stroke=\"#8884d8\"\n          />\n          <CartesianGrid stroke=\"#ccc\" strokeDasharray=\"5 5\" />\n          <XAxis dataKey={\"time\"} />\n          <YAxis\n            dataKey={\"rssi\"}\n            label={{\n              value: \"Cellular RSSI (dB)\",\n              position: \"insideLeft\",\n              angle: -90,\n            }}\n          />\n          <Tooltip />\n        </LineChart>\n      );\n    } else {\n      chart = (\n        <LineChart margin={{ top: 20, right: 30, left: 0, bottom: 80 }} />\n      );\n    }\n\n    return (\n      <ResponsiveContainer width={\"100%\"} height={\"100%\"}>\n        {chart}\n      </ResponsiveContainer>\n    );\n  }\n}\n\nexport default connect(\n  {\n    connection_id: state`data.connection_id`,\n    date: state`diagnostics.date`,\n    hour: state`diagnostics.hour`,\n    selectedUnit: state`diagnostics.selectedUnit`,\n    measurement: state`diagnostics.measurement`,\n    oada: state`oada`,\n    data: state`data`,\n  },\n  withStyles(styles, { withTheme: true })(Graph),\n);\n","import React from \"react\";\nimport { connect } from \"@cerebral/react\";\nimport { state } from \"cerebral/tags\";\n\nimport Map from \"./Map/\";\nimport Graph from \"./Graph/\";\n\nclass Visualization extends React.Component {\n  render() {\n    var graphic;\n    if (this.props.mode === \"map\") {\n      graphic = <Map />;\n    } else {\n      graphic = <Graph />;\n    }\n\n    return graphic;\n  }\n}\n\nexport default connect(\n  {\n    mode: state`diagnostics.mode`,\n  },\n  Visualization,\n);\n","import React from \"react\";\n\nimport { withStyles } from \"@material-ui/core/styles\";\nimport Divider from \"@material-ui/core/Divider\";\nimport List from \"@material-ui/core/List\";\nimport ListItem from \"@material-ui/core/ListItem\";\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\nimport ListItemText from \"@material-ui/core/ListItemText\";\nimport SyncIcon from \"@material-ui/icons/Sync\";\nimport SyncProblemIcon from \"@material-ui/icons/SyncProblem\";\nimport SyncDisabledIcon from \"@material-ui/icons/SyncDisabled\";\n\nimport { connect } from \"@cerebral/react\";\nimport { state, signal } from \"cerebral/tags\";\n\nconst styles = theme => ({\n  list: {\n    width: \"90%\",\n    backgroundColor: theme.palette.background.paper,\n    //position: 'relative',\n    overflow: \"auto\",\n    height: 300,\n    margin: 1.5 * theme.spacing.unit,\n  },\n  textField: {\n    margin: 1.5 * theme.spacing.unit,\n  },\n  healthy: { color: \"#008000\" },\n  sick: { color: \"#ffbf00\" },\n  down: { color: \"#ff0000\" },\n});\n\nclass Summary extends React.Component {\n  render() {\n    const { classes } = this.props;\n\n    // create unit list\n    var units;\n    if (Object.keys(this.props.health || {}).length > 0) {\n      units = (\n        <List className={classes.list} component=\"nav\">\n          {Object.keys(this.props.health).map(unit => (\n            <ListItem\n              button\n              key={`-${unit}`}\n              onClick={() => this.props.selectUnit({ unit: unit })}\n            >\n              <ListItemText primary={unit} />\n              <ListItemIcon>\n                {(() => {\n                  switch (this.props.health[unit]) {\n                    case \"Healthy\":\n                      return <SyncIcon className={classes.healthy} />;\n                    case \"Sick\":\n                      return <SyncProblemIcon className={classes.sick} />;\n                    case \"Down\":\n                      return <SyncDisabledIcon />;\n                    default:\n                      return <SyncDisabledIcon />;\n                  }\n                })()}\n              </ListItemIcon>\n            </ListItem>\n          ))}\n        </List>\n      );\n    } else {\n      units = <List className={classes.list} component=\"nav\" />;\n    }\n\n    // wrapper for unit list\n    return (\n      <List>\n        <ListItem>\n          <ListItemText align=\"center\" primary={\"My ISOBlues:\"} />\n        </ListItem>\n        {units}\n        <Divider />\n      </List>\n    );\n  }\n}\n\nexport default connect(\n  {\n    health: state`health`,\n    selectUnit: signal`diagnostics.selectUnit`,\n  },\n  withStyles(styles)(Summary),\n);\n","import React from \"react\";\nimport { withStyles } from \"@material-ui/core/styles\";\nimport Divider from \"@material-ui/core/Divider\";\nimport List from \"@material-ui/core/List\";\nimport ListItem from \"@material-ui/core/ListItem\";\nimport ListItemText from \"@material-ui/core/ListItemText\";\nimport Button from \"@material-ui/core/Button\";\nimport Select from \"@material-ui/core/Select\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\n\nimport { connect } from \"@cerebral/react\";\nimport { state, signal } from \"cerebral/tags\";\n\nconst styles = theme => ({});\n\nclass Diagnostics extends React.Component {\n  render() {\n    const visualizing = (\n      <ListItem>\n        <ListItemText align=\"center\">\n          <Button onClick={() => this.props.toggleMode({})} variant=\"contained\">\n            {this.props.mode === \"map\" ? \"Show Statistics\" : \"Show Map\"}\n          </Button>\n        </ListItemText>\n      </ListItem>\n    );\n\n    var measurements;\n    if (this.props.mode === \"map\") {\n      measurements = [\"GPS\"];\n    } else {\n      measurements = [\"Latency\", \"Wifi RSSI\", \"Cellular RSSI\"];\n    }\n    const measurementSelect = (\n      <Select\n        value={this.props.measurement}\n        renderValue={value => `${value}`}\n        onChange={value =>\n          this.props.setMeasurement({ measurement: value.target.value })\n        }\n      >\n        {measurements.map(measurement => (\n          <MenuItem key={measurement} value={measurement}>\n            {measurement}\n          </MenuItem>\n        ))}\n      </Select>\n    );\n\n    const dateSelect = (\n      <Select\n        value={this.props.date}\n        renderValue={value => `${value}`}\n        onChange={value => this.props.setDate({ date: value.target.value })}\n      >\n        {Object.keys(\n          this.props.oada[this.props.connection_id].bookmarks.isoblue[\n            \"device-index\"\n          ][this.props.selectedUnit][\"location\"][\"day-index\"],\n        ).map(date => (\n          <MenuItem key={date} value={date}>\n            {date}\n          </MenuItem>\n        ))}\n        ;\n      </Select>\n    );\n\n    // Get timezone offset\n    const tzOffsetMinutes = new Date().getTimezoneOffset();\n    const genTimeLabel = hour => {\n      // UTC -> Local time zone conversion\n      // Assume hour has format hh:mm\n      const hhmm = hour.split(\":\");\n      const utcMinutes = 60 * parseInt(hhmm[0]) + parseInt(hhmm[1]);\n      var localMinutes = utcMinutes - tzOffsetMinutes;\n      var msg = \"\";\n      if (localMinutes < 0) {\n        localMinutes += 1440;\n        msg = \" (-1 day)\";\n      } else if (localMinutes > 1440) {\n        localMinutes -= 1440;\n        msg = \" (+1 day)\";\n      }\n      const localHH = Math.floor(localMinutes / 60);\n      const localMM = localMinutes % 60;\n      return (\n        localHH.toString().padStart(2, \"0\") +\n        \":\" +\n        localMM.toString().padStart(2, \"0\") +\n        msg\n      );\n    };\n\n    const hourSelect = (\n      <Select\n        value={this.props.hour}\n        renderValue={value => `${genTimeLabel(value)}`}\n        onChange={value => this.props.setHour({ hour: value.target.value })}\n      >\n        {Object.keys(\n          this.props.oada[this.props.connection_id].bookmarks.isoblue[\n            \"device-index\"\n          ][this.props.selectedUnit][\"location\"][\"day-index\"][this.props.date][\n            \"hour-index\"\n          ],\n        ).map(hour => {\n          return (\n            <MenuItem key={hour} value={hour}>\n              {genTimeLabel(hour)}\n            </MenuItem>\n          );\n        })}\n        ;\n      </Select>\n    );\n\n    return (\n      <List>\n        <ListItem>\n          <ListItemText align=\"center\" primary={\"Selected Unit:\"} />\n        </ListItem>\n        <ListItem>\n          <ListItemText align=\"center\" primary={this.props.selectedUnit} />\n        </ListItem>\n        <Divider />\n        <ListItem>\n          <ListItemText align=\"center\" primary=\"ISOBlue Status:\" />\n        </ListItem>\n        <ListItem>\n          <ListItemText align=\"center\" primary={\"Health:\"} />\n          <ListItemText\n            align=\"center\"\n            primary={this.props.snapshots[this.props.selectedUnit].health}\n          />\n        </ListItem>\n        <ListItem>\n          <ListItemText align=\"center\" primary={\"Last Report:\"} />\n          <ListItemText\n            align=\"center\"\n            primary={\n              this.props.snapshots[this.props.selectedUnit].lastReport === \"NA\"\n                ? \"NA\"\n                : this.props.snapshots[this.props.selectedUnit]\n                    .lastLocationReport + \" min\"\n            }\n          />\n        </ListItem>\n        <Divider />\n        <ListItem>\n          <ListItemText align=\"center\" primary={\"Available Data:\"} />\n        </ListItem>\n        <ListItem>\n          <ListItemText align=\"center\">{measurementSelect}</ListItemText>\n        </ListItem>\n        <ListItem>\n          <ListItemText align=\"center\">{dateSelect}</ListItemText>\n        </ListItem>\n        <ListItem>\n          <ListItemText align=\"center\">{hourSelect}</ListItemText>\n        </ListItem>\n        {visualizing}\n        <Divider />\n        <ListItem>\n          <ListItemText align=\"center\">\n            <Button\n              variant=\"contained\"\n              onClick={() => this.props.unselectUnit({})}\n            >\n              Back to Main\n            </Button>\n          </ListItemText>\n        </ListItem>\n      </List>\n    );\n  }\n}\n\nexport default connect(\n  {\n    date: state`diagnostics.date`,\n    hour: state`diagnostics.hour`,\n    measurement: state`diagnostics.measurement`,\n    selectedUnit: state`diagnostics.selectedUnit`,\n    snapshots: state`snapshots`,\n    data: state`data`,\n    mode: state`diagnostics.mode`,\n    oada: state`oada`,\n    connection_id: state`data.connection_id`,\n\n    selectUnit: signal`diagnostics.selectUnit`,\n    unselectUnit: signal`diagnostics.unselectUnit`,\n    setDate: signal`diagnostics.setDate`,\n    setHour: signal`diagnostics.setHour`,\n    setMeasurement: signal`diagnostics.setMeasurement`,\n    toggleMode: signal`diagnostics.toggleMode`,\n  },\n  withStyles(styles)(Diagnostics),\n);\n","import React from \"react\";\nimport { connect } from \"@cerebral/react\";\nimport { state, signal } from \"cerebral/tags\";\n\nimport { withStyles } from \"@material-ui/core/styles\";\nimport Drawer from \"@material-ui/core/Drawer\";\n\nimport Summary from \"./Summary/\";\nimport Diagnostics from \"./Diagnostics/\";\n\nconst styles = theme => ({\n  drawerPaper: {\n    position: \"relative\",\n    width: 240,\n    backgroundColor: \"#eeeeee\",\n  },\n  toolbar: theme.mixins.toolbar,\n});\n\nclass DrawerContent extends React.Component {\n  render() {\n    const { classes } = this.props;\n\n    var content;\n    if (this.props.selectedUnit) {\n      content = <Diagnostics />;\n    } else {\n      content = <Summary />;\n    }\n\n    return (\n      <Drawer\n        open={this.props.drawerOpen}\n        onClose={() => this.props.toggleDrawerOpen({})}\n        classes={{\n          paper: classes.drawerPaper,\n        }}\n      >\n        <div className={classes.toolbar} />\n        {content}\n      </Drawer>\n    );\n  }\n}\n\nexport default connect(\n  {\n    selectedUnit: state`diagnostics.selectedUnit`,\n    drawerOpen: state`session.drawerOpen`,\n\n    toggleDrawerOpen: signal`session.toggleDrawerOpen`,\n  },\n  withStyles(styles)(DrawerContent),\n);\n","import React from \"react\";\nimport { connect } from \"@cerebral/react\";\nimport {\n  TextField,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n} from \"@material-ui/core\";\nimport Dialog from \"@material-ui/core/Dialog\";\nimport Button from \"@material-ui/core/Button\";\nimport { state, signal } from \"cerebral/tags\";\n\nexport default connect(\n  {\n    oadaDomainText: state`connection.oada_domain_text`,\n    open: state`connection.dialog_open`,\n\n    submitClicked: signal`connection.setConnection`,\n    oadaDomainChanged: signal`connection.updateOadaDomain`,\n  },\n\n  class ConnectDialog extends React.Component {\n    render() {\n      return (\n        <Dialog open={this.props.open} className={\"connection-dialog\"}>\n          <DialogTitle id=\"form-dialog-title\">\n            Connect to OADA Server\n          </DialogTitle>\n          <DialogContent>Please enter the domain of OADA server.</DialogContent>\n          <DialogContent>\n            <TextField\n              autoFocus\n              label=\"Domain\"\n              value={this.props.oadaDomainText}\n              onChange={e =>\n                this.props.oadaDomainChanged({ value: e.target.value })\n              }\n              margin=\"dense\"\n              fullwidth=\"true\"\n            />\n          </DialogContent>\n          <DialogActions>\n            <Button\n              onClick={() => {\n                this.props.open = false;\n              }}\n              color=\"secondary\"\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={() => {\n                this.props.submitClicked({});\n              }}\n              color=\"secondary\"\n            >\n              Submit\n            </Button>\n          </DialogActions>\n        </Dialog>\n      );\n    }\n  },\n);\n","import React from \"react\";\nimport { connect } from \"@cerebral/react\";\nimport { signal } from \"cerebral/tags\";\n\nimport { withStyles } from \"@material-ui/core/styles\";\nimport AppBar from \"@material-ui/core/AppBar\";\n\nimport AppBarContent from \"../AppBarContent/\";\nimport Visualization from \"../Visualization/\";\nimport DrawerContent from \"../DrawerContent/index.js\";\nimport ConnectDialog from \"../ConnectDialog/index.js\";\n\nconst styles = theme => ({\n  root: {\n    flexGrow: 1,\n    height: \"100vh\",\n    zIndex: 1,\n    overflow: \"hidden\",\n    position: \"relative\",\n    display: \"flex\",\n  },\n  appBar: {\n    zIndex: theme.zIndex.drawer + 1,\n  },\n  content: {\n    flexGrow: 1,\n  },\n  toolbar: theme.mixins.toolbar,\n});\n\nclass App extends React.Component {\n  componentWillMount() {\n    this.props.init({});\n  }\n\n  render() {\n    const { classes } = this.props;\n\n    return (\n      <div className={classes.root}>\n        <AppBar position=\"absolute\" className={classes.appBar}>\n          <AppBarContent />\n        </AppBar>\n        <DrawerContent />\n        <main className={classes.content}>\n          <div className={classes.toolbar} />\n          <Visualization />\n        </main>\n        <ConnectDialog />\n      </div>\n    );\n  }\n}\n\nexport default connect(\n  {\n    init: signal`init`,\n  },\n  withStyles(styles, { withTheme: true })(App),\n);\n","import { sequence } from \"cerebral\";\nimport { state } from \"cerebral/tags\";\nimport { toggle } from \"cerebral/operators\";\n\nexport const toggleDrawerOpen = sequence(\"toggleDrawerOpen\", [\n  toggle(state`session.drawerOpen`),\n]);\n","import { Module } from \"cerebral\";\nimport * as signals from \"./sequences\";\n\nexport default Module({\n  state: {\n    drawerOpen: false,\n    dataReady: false,\n  },\n  signals,\n});\n","import { sequence } from \"cerebral\";\nimport { state } from \"cerebral/tags\";\nimport { set, debounce } from \"cerebral/operators\";\nimport _ from \"lodash\";\n\nexport const storeUserLocation = sequence(\"storeUserLocation\", [\n  ({ state, props }) =>\n    state.set(\"map.userLocation\", { lat: props.lat, lng: props.lng }),\n  set(state`map.userLocationAvailable`, true),\n]);\n\nexport const centerOnUser = sequence(\"centerOnUser\", [\n  set(state`map.targetCenter`, { lat: 40.428641, lng: -86.913783 }),\n  debounce(1),\n  {\n    continue: [set(state`map.targetCenter`, state`map.userLocation`)],\n    discard: [],\n  },\n]);\n\nexport const centerOnUnit = sequence(\"centerOnUnit\", [\n  set(state`map.targetCenter`, { lat: 40.428641, lng: -86.913783 }),\n  debounce(1),\n  {\n    continue: [\n      set(\n        state`map.targetCenter`,\n        state`snapshots.${state`diagnostics.selectedUnit`}.location`,\n      ),\n    ],\n    discard: [],\n  },\n]);\n","import { sequence } from \"cerebral\";\nimport { state, props } from \"cerebral/tags\";\nimport { set } from \"cerebral/operators\";\nimport _ from \"lodash\";\nimport oada from \"@oada/cerebral-module/sequences\";\n\nvar masterTree = {\n  bookmarks: {\n    _type: \"application/vnd.oada.bookmarks.1+json\",\n    _rev: 0,\n    isoblue: {\n      _type: \"application/vnd.oada.isoblue.1+json\",\n      _rev: 0,\n      \"device-index\": {\n        \"*\": {\n          _type: \"application/vnd.oada.isoblue.device.1+json\",\n          _rev: 0,\n          \"*\": {\n            _type: \"application/vnd.oada.isoblue.dataset.1+json\",\n            _rev: 0,\n            \"day-index\": {\n              \"*\": {\n                _type: \"application/vnd.oada.isoblue.day.1+json\",\n                _rev: 0,\n                \"hour-index\": {\n                  \"*\": {\n                    _type: \"application/vnd.oada.isoblue.hour.1+json\",\n                  },\n                },\n              },\n            },\n          },\n        },\n      },\n    },\n  },\n};\n\nvar dayTree = {\n  bookmarks: {\n    _type: \"applications/vnd.oada.bookmarks.1+json\",\n    _rev: 0,\n    isoblue: {\n      _type: \"applications/vnd.oada.isoblue.1+json\",\n      _rev: 0,\n      \"device-index\": {\n        \"*\": {\n          _type: \"applications/vnd.oada.isoblue.device.1+json\",\n          _rev: 0,\n          \"*\": {\n            _type: \"application/vnd.oada.isoblue.dataset.1+json\",\n            _rev: 0,\n            \"day-index\": {\n              \"*\": {\n                _type: \"applications/vnd.oada.isoblue.day.1+json\",\n                _rev: 0,\n              },\n            },\n          },\n        },\n      },\n    },\n  },\n};\n\nvar deviceTree = {\n  bookmarks: {\n    _type: \"applications/vnd.oada.bookmarks.1+json\",\n    _rev: 0,\n    isoblue: {\n      _type: \"applications/vnd.oada.isoblue.1+json\",\n      _rev: 0,\n      \"device-index\": {\n        \"*\": {\n          _type: \"applications/vnd.oada.isoblue.device.1+json\",\n          _rev: 0,\n          \"*\": {\n            _type: \"application/vnd.oada.isoblue.dataset.1+json\",\n            _rev: 0,\n          },\n        },\n      },\n    },\n  },\n};\n\n/* Set requests */\nfunction setRequestLastHour({ state, props }) {\n  const devices = Object.keys(\n    state.get(`oada.${props.connection_id}.bookmarks.isoblue.device-index`) ||\n      {},\n  );\n\n  var requests = []; // OADA requests\n\n  devices.forEach(device_name => {\n    var device_data =\n      state.get(\n        `oada.${\n          props.connection_id\n        }.bookmarks.isoblue.device-index.${device_name}.location.day-index`,\n      ) || {};\n\n    // find the most recent day\n    const date_list = Object.keys(device_data);\n    if (date_list.length === 0) {\n      return;\n    }\n    const last_date = _.maxBy(date_list, function(o) {\n      return new Date(o);\n    });\n\n    //find the most recent hour\n    const last_hour = _.max(\n      Object.keys(device_data[last_date][\"hour-index\"] || {}),\n    );\n\n    // add request\n    requests.push({\n      path: `/bookmarks/isoblue/device-index/${device_name}/location/day-index/${last_date}/hour-index/${last_hour}`,\n      watch: { signals: [\"snapshots.createSnapshots\"] },\n      tree: masterTree,\n    });\n  });\n\n  return { requests };\n}\n\n/* Called when the device list was modified */\nexport const handleDeviceUpdate = sequence(\"data.handleDeviceUpdate\", [\n  set(state`data.ready`, false),\n  setRequestLastHour,\n  oada.get,\n  set(state`data.ready`, true),\n]);\n\n// Get devices and watch for changes\nexport const getDevices = sequence(\"data.getDevices\", [\n  // get devices\n  ({ state, props }) => ({\n    requests: [\n      {\n        path: \"/bookmarks/isoblue\",\n        tree: dayTree,\n        watch: { signals: [\"data.handleDeviceUpdate\"] },\n      },\n    ],\n  }),\n  oada.get,\n]);\n\n/* Initial sequence. Only called at startup. */\nexport const init = sequence(\"data.init\", [\n  set(state`data.ready`, false),\n  set(state`health`, {}),\n  // connect to server\n  set(state`data.connection_id`, props`connection_id`),\n\n  // get most recent data\n  getDevices,\n  setRequestLastHour,\n  oada.get,\n  set(state`data.ready`, true),\n]);\n\n/* Set request to OADA server based on currently selected device, date, and hour */\nexport const getHour = sequence(\"data.getHour\", [\n  ({ state, props }) => ({\n    requests: [\n      {\n        connection_id: state.get(\"data.connection_id\"),\n        path: `/bookmarks/isoblue/device-index/${state.get(\n          `diagnostics.selectedUnit`,\n        )}/location/day-index/${state.get(\n          `diagnostics.date`,\n        )}/hour-index/${state.get(`diagnostics.hour`)}`,\n        tree: masterTree,\n      },\n    ],\n  }),\n  oada.get,\n]);\n","import { sequence } from \"cerebral\";\nimport { state, props } from \"cerebral/tags\";\nimport { set, when } from \"cerebral/operators\";\nimport _ from \"lodash\";\nimport * as map from \"../map/sequences\";\nimport * as data from \"../data/sequences\";\n\nexport const setDate = sequence(\"setDate\", [\n  set(state`diagnostics.date`, props`date`),\n  ({ state, props }) =>\n    state.set(\n      \"diagnostics.hour\",\n      _.max(\n        Object.keys(\n          state.get(\n            `oada.${state.get(\n              \"data.connection_id\",\n            )}.bookmarks.isoblue.device-index.${state.get(\n              \"diagnostics.selectedUnit\",\n            )}.location.day-index.${state.get(\"diagnostics.date\")}.hour-index`,\n          ),\n        ),\n      ),\n    ),\n  data.getHour,\n  map.centerOnUnit,\n]);\n\nexport const setHour = sequence(\"setHour\", [\n  set(state`diagnostics.hour`, props`hour`),\n  data.getHour,\n  map.centerOnUnit,\n]);\n\nexport const setMeasurement = sequence(\"setMeasurement\", [\n  ({ state, props }) => state.set(\"diagnostics.measurement\", props.measurement),\n]);\n\n/* Set the selected unit, default date, and hour */\nexport const selectUnit = sequence(\"selectUnit\", [\n  ({ state, props }) => ({ connection_id: state.get(\"data.connection_id\") }),\n  set(state`diagnostics.selectedUnit`, props`unit`),\n\n  // set default date and hour\n  ({ state, props }) => {\n    const date = Object.keys(\n      state.get(\n        `oada.${props.connection_id}.bookmarks.isoblue.device-index.${\n          props.unit\n        }.location.day-index`,\n      ),\n    ).sort((a, b) => {\n      return new Date(b) - new Date(a);\n    })[0];\n\n    const hour = _.max(\n      Object.keys(\n        state.get(\n          `oada.${props.connection_id}.bookmarks.isoblue.device-index.${\n            props.unit\n          }.location.day-index.${date}.hour-index`,\n        ),\n      ),\n    );\n\n    state.set(\"diagnostics.date\", date);\n    state.set(\"diagnostics.hour\", hour);\n  },\n\n  // center the map\n  map.centerOnUnit,\n]);\n\nexport const unselectUnit = sequence(\"unselectUnit\", [\n  set(state`diagnostics.selectedUnit`, null),\n  set(state`diagnostics.date`, null),\n  set(state`diagnostics.hour`, null),\n]);\n\n/* Toggle map view and graph view */\nexport const toggleMode = sequence(\"toggleMode\", [\n  when(state`diagnostics.mode`, value => value === \"map\"),\n  {\n    true: [\n      set(state`diagnostics.mode`, \"graph\"),\n      set(state`diagnostics.measurement`, \"Latency\"),\n    ],\n    false: [\n      set(state`diagnostics.mode`, \"map\"),\n      set(state`diagnostics.measurement`, \"GPS\"),\n    ],\n  },\n]);\n","import { Module } from 'cerebral';\nimport * as signals from './sequences';\n\nexport default Module({\n  state: {\n    hour: null,\n    measurement: 'GPS',\n    selectedUnit: null,\n    date: null,\n    mode: \"map\",\n  },\n  signals,\n});\n","import { Module } from 'cerebral';\nimport * as signals from './sequences';\n\nexport default Module({\n\n  state: {\n    targetCenter: { lat: 40.428641, lng: -86.913783 },\n    userLocation: { lat: 40.428641, lng: -86.913783 },\n    userLocationAvailable: false,\n  },\n\n  signals,\n\n});\n","import { Module } from \"cerebral\";\nimport * as signals from \"./sequences\";\n\nexport default Module({\n  //state: stateTree,\n  //state: {},\n\n  signals,\n});\n","import { sequence } from \"cerebral\";\nimport { state, props } from \"cerebral/tags\";\nimport { set } from \"cerebral/operators\";\nimport _ from \"lodash\";\n\nexport const createSnapshots = sequence(\"createSnapshots\", [\n  ({ state, props }) => ({\n    units: _.reduce(\n      Object.keys(\n        state.get(\n          `oada.${props.connection_id}.bookmarks.isoblue.device-index`,\n        ) || {},\n      ),\n      (acc, unit, unitkey) => {\n        // iterate over all the ISOBlue units\n        var unitLocationData = state.get(\n          `oada.${\n            props.connection_id\n          }.bookmarks.isoblue.device-index.${unit}.location.day-index`,\n        );\n        //var health, location, connection, lastReport;\n        const lastDate = _.maxBy(Object.keys(unitLocationData || {}), function(\n          o,\n        ) {\n          return new Date(o);\n        });\n\n        if (!lastDate) return acc;\n        if (!unitLocationData[lastDate].hasOwnProperty(\"hour-index\"))\n          return acc;\n\n        const lastHour = _.max(\n          Object.keys(unitLocationData[lastDate][\"hour-index\"] || {}),\n        );\n\n        if (!lastHour) return acc;\n        var lastGPS =\n          _.max(\n            Object.keys(\n              unitLocationData[lastDate][\"hour-index\"][lastHour][\"sec-index\"] ||\n                {},\n            ),\n          ) || null;\n\n        // get messages\n        const msg_gps = lastGPS\n          ? unitLocationData[lastDate][\"hour-index\"][lastHour][\"sec-index\"][\n              lastGPS\n            ]\n          : null;\n        // const msg_hb = lastHeartbeat\n        //   ? unitData[lastDate][\"hour-index\"][lastTime][\"heartbeats\"][\n        //       lastHeartbeat\n        //     ]\n        //   : null;\n        if (msg_gps) {\n          var lastLocationReport = Math.round(\n            (Math.round(new Date().getTime() / 1000) - lastGPS) / 60,\n          );\n\n          var latency = null;\n          // if (\n          //   msg_hb.hasOwnProperty(\"recTime\") &&\n          //   msg_hb.hasOwnProperty(\"genTime\")\n          // ) {\n          //   latency = msg_hb.recTime - msg_hb.genTime;\n          // }\n\n          var health = null;\n          if (lastLocationReport < 2) {\n            if (latency < 20) {\n              health = \"Healthy\";\n            } else {\n              health = \"Sick\";\n            }\n          } else if (lastLocationReport < 10) {\n            health = \"Sick\";\n          } else {\n            health = \"Down\";\n          }\n\n          var location = null;\n          if (msg_gps.hasOwnProperty(\"lat\") && msg_gps.hasOwnProperty(\"lng\")) {\n            location = msg_gps;\n          }\n\n          var connection = null;\n\n          acc[unit] = {\n            health,\n            connection,\n            location,\n            lastLocationReport,\n            lastHeartbeatTime: lastLocationReport,\n          };\n          state.set(`health.${unit}`, health);\n        } else {\n          acc[unit] = {\n            health: \"Down\",\n            connection: null,\n            location: null,\n            lastReport: \"NA\",\n            lastHeartbeatTime: 60,\n          };\n          state.set(`health.${unit}`, \"Down\");\n        }\n        return acc;\n      },\n      {},\n    ),\n  }),\n  set(state`snapshots`, props`units`),\n]);\n","import { Module } from 'cerebral';\nimport * as signals from './sequences'\n\nexport default Module({\n  state: {\n  },\n  signals,\n});\n\n\n","/* cerebral imports */\nimport { state, props } from \"cerebral/tags\";\nimport { set } from \"cerebral/operators\";\nimport oada from \"@oada/cerebral-module/sequences\";\nimport * as data from \"../data/sequences\";\nimport * as snapshots from \"../snapshots/sequences\";\n\nconst _SCOPE = \"oada.isoblue:all\";\nconst _OPENATK_METADATA =\n  \"eyJqa3UiOiJodHRwczovL2lkZW50aXR5Lm9hZGEtZGV2LmNvbS9jZXJ0cyIsImtpZCI6ImtqY1NjamMzMmR3SlhYTEpEczNyMTI0c2ExIiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJyZWRpcmVjdF91cmlzIjpbImh0dHBzOi8vb3BlbmF0ay5jb20vSVNPQmx1ZUFwcC9vYXV0aDIvcmVkaXJlY3QuaHRtbCIsImh0dHA6Ly9sb2NhbGhvc3Q6ODAwMC9vYXV0aDIvcmVkaXJlY3QuaHRtbCJdLCJ0b2tlbl9lbmRwb2ludF9hdXRoX21ldGhvZCI6InVybjppZXRmOnBhcmFtczpvYXV0aDpjbGllbnQtYXNzZXJ0aW9uLXR5cGU6and0LWJlYXJlciIsImdyYW50X3R5cGVzIjpbImF1dGhvcml6YXRpb25fY29kZSJdLCJyZXNwb25zZV90eXBlcyI6WyJ0b2tlbiIsImNvZGUiLCJpZF90b2tlbiIsImlkX3Rva2VuIHRva2VuIiwiY29kZSBpZF90b2tlbiIsImNvZGUgdG9rZW4iLCJjb2RlIGlkX3Rva2VuIHRva2VuIl0sImNsaWVudF9uYW1lIjoiSVNPQmx1ZSBIZWFsdGggTW9uaXRvciIsImNsaWVudF91cmkiOiJodHRwOi8vb2FkYS5vcGVuYXRrLmNvbS9JU09CbHVlQXBwIiwiY29udGFjdHMiOlsiU2FtIE5vZWwgPHNhbm9lbEBwdXJkdWUuZWR1PiJdLCJqd2tzIjp7ImtleXMiOlt7Imt0eSI6IlJTQSIsIm4iOiJ6YXVaRkJ1TWRsdjFrWWp6VWI0cS1fM200c21GeG5mdzRTWW9hSHE3Y2k4U2N0WTN4ajdyZEFIeWtRcG5RVnJqNktPOG1hSHYtMEJ2VzVNaGNnaXZrdVlzLXpIRXZmWUJlVkJuY3ZIZ09rSlBiYzkxQ3dfaXdPWTdFSFdCOGhNN1ZpTFFWY19EdjBoOG5KeWJCdmhMMDRDSFF0N0NwTXRWWUc2Zm9KWGMzZHE1MmpOUWJCSElaNW03VnoxS3R5em9MY3A4TzJtaGFMcDQ1VXIzQ18xZUd0djhuNU56OWJXX0JoNVhGWWJEeHY3Qm5oWk5JdzFHQ2JqakF3bXRibm5MN0dnZjRDeTYwd1JIbVI0dm9lMjFPSWpvQVNxMmpaMDN4MTJtWHM3SFBJM1lCNHkyOXd2Wk13MmdMek9kVG9ycnFPLXRsbW4xYm9Qa1dLSkpTWG9BdnciLCJlIjoiQVFBQiJ9XX0sInNvZnR3YXJlX2lkIjoiNzY1ZjFlZjctMzExNy00NjhhLTgwYjMtMDExYzQ1MjhkMGExIiwicmVnaXN0cmF0aW9uX3Byb3ZpZGVyIjoiaHR0cHM6Ly9pZGVudGl0eS5vYWRhLWRldi5jb20iLCJpYXQiOjE1NDcxNDYxOTF9.seH7eMsR1218IgEEbiq3T5ASGQAr7vqvy54_Yu8-6TIoAoVfslG-dSYWE2dXZ_P65kElqCKZLizVxyR1732vcFnOdzp6jE_pgpLg-eWZfVnIvNQdGK8Dh-5t1gVbPs1ME-j_GMCb2Un-mpDS8LAw4Nig_r-monjKyKbcPBN6gc4\";\n\nconst _REDIRECT_OPENATK = \"https://openatk.com/ISOBlueApp/oauth2/redirect.html\"; // for production\nconst _REDIRECT_LOCALHOST = \"http://localhost:8000/oauth2/redirect.html\"; // for local test\n\nconst _CURRENT_METADATA = _OPENATK_METADATA;\nconst _CURRENT_REDIRECT =\n  process.env.NODE_ENV === \"production\"\n    ? _REDIRECT_OPENATK\n    : _REDIRECT_LOCALHOST;\n\nexport var signOut = [\n  set(state`Connections.oada_token`, \"\"),\n  set(state`Connections.oada_domain`, \"\"),\n  set(state`Connections.oada_fields_domain`, \"\"),\n  set(state`Connections.oada_domain_text`, \"\"),\n  set(state`Connections.oada_fields_domain_text`, \"\"),\n];\n\nexport var updateOadaDomain = [\n  set(state`connection.oada_domain_text`, props`value`),\n];\n\nexport var connect = [\n  ({ state }) => ({\n    domain: state.get(\"connection.oada_domain\"),\n    options: {\n      redirect: _CURRENT_REDIRECT,\n      metadata: _CURRENT_METADATA,\n      scope: _SCOPE,\n    },\n    //    connection_id: state.get(\"operations.connection_id\"),\n    //    signals: [\"fields.handleWatchUpdate\"],\n  }),\n  oada.connect,\n  set(state`data.connection_id`, props`connection_id`), // FIXME: remove this line\n  set(state`connection.connection_id`, props`connection_id`),\n  set(state`connection.dialog_open`, false),\n];\n\nexport var setConnection = [\n  set(state`connection.oada_domain`, state`connection.oada_domain_text`),\n  connect,\n  data.init,\n  snapshots.createSnapshots,\n];\n\nfunction clearConnection({ state, props }) {\n  const connection_id = state.get(\"connection.connection_id\");\n  /* cleaning up connections from oada state */\n  state.unset(\"oada.connections\");\n  /* cleaning up previous connection_id from oada state */\n  state.unset(\"oada.\" + connection_id);\n}\n","import { Module } from \"cerebral\";\nimport oadaProvider from \"@oada/cerebral-provider\";\nimport * as signals from \"./sequences\";\n\nlet _OADA_HOST = \"https://oada.openatk.com\";\nlet _CURRENT_HOST = _OADA_HOST;\n\nexport default Module({\n  state: {\n    dialog_open: true,\n    oada_domain_text: _CURRENT_HOST,\n    oada_domain: _CURRENT_HOST,\n  },\n  signals,\n  providers: {\n    oada: oadaProvider,\n  },\n});\n","import { sequence } from \"cerebral\";\n\nexport const init = sequence(\"init\", []);\n","import { Module } from \"cerebral\";\n\nimport session from \"../session/\";\nimport diagnostics from \"../diagnostics/\";\nimport map from \"../map/\";\nimport data from \"../data/\";\nimport snapshots from \"../snapshots/\";\nimport connection from \"../connection/\";\nimport oadaModule from \"@oada/cerebral-module\";\nimport oadaProvider from \"@oada/cerebral-provider\";\nimport * as signals from \"./sequences\";\n\nexport default Module({\n  modules: {\n    connection,\n    session,\n    oada: oadaModule,\n    diagnostics,\n    map,\n    data,\n    snapshots,\n  },\n  signals,\n  providers: {\n    oada: oadaProvider,\n  },\n});\n","import { Controller } from \"cerebral\";\nimport root from \"./modules/root\";\nimport Devtools from \"cerebral/devtools\";\n\nexport default Controller(root, {\n  devtools:\n    process.env.NODE_ENV === \"production\"\n      ? null\n      : Devtools({ host: \"localhost:8787\" }),\n  //devtools: null,\n});\n","import React from \"react\";\nimport { render } from \"react-dom\";\nimport { MuiThemeProvider, createMuiTheme } from \"@material-ui/core/styles\";\nimport App from \"./components/App/\";\n\nimport { Container } from \"@cerebral/react\";\nimport controller from \"./controller\";\n\nconst theme = createMuiTheme({\n  typography: {\n    useNextVariants: true,\n  },\n});\n\nrender(\n  <Container controller={controller}>\n    <MuiThemeProvider theme={theme}>\n      <App />\n    </MuiThemeProvider>\n  </Container>,\n  document.getElementById(\"root\"),\n);\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _keys = require(\"babel-runtime/core-js/object/keys\");\n\nvar _keys2 = _interopRequireDefault(_keys);\n\nvar _typeof2 = require(\"babel-runtime/helpers/typeof\");\n\nvar _typeof3 = _interopRequireDefault(_typeof2);\n\nvar _asyncToGenerator2 = require(\"babel-runtime/helpers/asyncToGenerator\");\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _cache = require(\"./cache\");\n\nvar _cache2 = _interopRequireDefault(_cache);\n\nvar _uuid = require(\"uuid\");\n\nvar _uuid2 = _interopRequireDefault(_uuid);\n\nvar _lodash = require(\"lodash\");\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar Promise = require(\"bluebird\");\n\nvar pretty = require(\"prettyjson\");\n\nvar urlLib = require(\"url\");\n\nvar pointer = require(\"json-pointer\");\n\nvar ws = require(\"./websocket\");\n\nvar axios = require(\"axios\");\n\nvar _TOKEN = require(\"./token\"); //const error = require('debug')('oada-cache:index:error');\n//const info = require('debug')('oada-cache:index:info');\n\n\nvar connect = function () {\n  var _ref2 = (0, _asyncToGenerator3.default)(\n  /*#__PURE__*/\n  _regenerator2.default.mark(function _callee18(_ref) {\n    var _makeResourceAndLink = function () {\n      var _ref4 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee(_ref3, waitTime) {\n        var path = _ref3.path,\n            data = _ref3.data,\n            headers = _ref3.headers;\n        var linkReq, resReq, link, pathPieces, parentPath, response, newHeaders, resource;\n        return _regenerator2.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                //info('_makeResourceAndLink', path, data)\n                data._id = _lodash2.default.clone(data._id) || \"resources/\" + (0, _uuid2.default)();\n                linkReq = {\n                  path: path,\n                  type: data._type,\n                  headers: headers,\n                  data: {\n                    _id: data._id\n                  }\n                }; // Create a versioned link if the tree specifies one.\n\n                if ('_rev' in data) {\n                  linkReq.data._rev = 0;\n                } // We don't want to attempt to set the rev when we put the resource\n\n\n                resReq = {\n                  path: \"/\" + data._id,\n                  type: data._type,\n                  data: data\n                };\n                _context.prev = 4;\n                _context.next = 7;\n                return put(linkReq);\n\n              case 7:\n                link = _context.sent;\n                _context.next = 50;\n                break;\n\n              case 10:\n                _context.prev = 10;\n                _context.t0 = _context[\"catch\"](4);\n\n                if (!(_context.t0.response && _context.t0.response.status === 412)) {\n                  _context.next = 49;\n                  break;\n                }\n\n                pathPieces = path.split(\"/\");\n                parentPath = pathPieces.splice(0, pathPieces.length - 1).join(\"/\"); // Wait time increases: 1s, 2s, 4s, 8s, 16s. Throw after 16s.\n\n                if (!(waitTime > 16000)) {\n                  _context.next = 17;\n                  break;\n                }\n\n                throw _context.t0;\n\n              case 17:\n                _context.prev = 17;\n                _context.next = 20;\n                return NOCACHEREQUEST({\n                  method: \"get\",\n                  url: DOMAIN + parentPath,\n                  headers: {\n                    Authorization: \"Bearer \" + TOKEN\n                  }\n                });\n\n              case 20:\n                response = _context.sent;\n                _context.next = 29;\n                break;\n\n              case 23:\n                _context.prev = 23;\n                _context.t1 = _context[\"catch\"](17);\n                waitTime = waitTime || 1000;\n                _context.next = 28;\n                return Promise.delay(waitTime);\n\n              case 28:\n                return _context.abrupt(\"return\", _makeResourceAndLink({\n                  path: path,\n                  data: data,\n                  headers: headers\n                }, waitTime * 2));\n\n              case 29:\n                if (!response.data[pathPieces[pathPieces.length - 1]]) {\n                  _context.next = 41;\n                  break;\n                }\n\n                resReq.data._id = response.data[pathPieces[pathPieces.length - 1]]._id;\n                resReq.path = '/' + resReq.data._id; // Concurrent put, delete, put (delete.test.js #15) can produce situations where _id is undefined\n\n                if (resReq.data._id) {\n                  _context.next = 39;\n                  break;\n                }\n\n                waitTime = waitTime || 1000;\n                _context.next = 36;\n                return Promise.delay(waitTime);\n\n              case 36:\n                newHeaders = _lodash2.default.cloneDeep(headers); //TODO: use if-match headers???\n\n                newHeaders['if-match'] = parseInt(response.headers['x-oada-rev']);\n                return _context.abrupt(\"return\", _makeResourceAndLink({\n                  path: path,\n                  data: data,\n                  headers: newHeaders\n                }, waitTime * 2));\n\n              case 39:\n                _context.next = 47;\n                break;\n\n              case 41:\n                // The key does not yet exist, adjust the if-match and try again.\n                waitTime = waitTime || 1000;\n                _context.next = 44;\n                return Promise.delay(waitTime);\n\n              case 44:\n                newHeaders = _lodash2.default.cloneDeep(headers);\n                newHeaders['if-match'] = parseInt(response.headers['x-oada-rev']);\n                return _context.abrupt(\"return\", _makeResourceAndLink({\n                  path: path,\n                  data: data,\n                  headers: newHeaders\n                }, waitTime * 2));\n\n              case 47:\n                _context.next = 50;\n                break;\n\n              case 49:\n                throw _context.t0;\n\n              case 50:\n                // Delete the _rev  and _id keys. No need for them in the resource object. They will break things.\n                if ('_rev' in data) delete resReq.data._rev;\n                _context.next = 53;\n                return put(resReq);\n\n              case 53:\n                resource = _context.sent;\n                return _context.abrupt(\"return\", {\n                  link: link,\n                  resource: resource\n                });\n\n              case 55:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[4, 10], [17, 23]]);\n      }));\n\n      return function _makeResourceAndLink(_x2, _x3) {\n        return _ref4.apply(this, arguments);\n      };\n    }(); // Construct the request object and catch any 401s (expired token)\n\n\n    var _buildRequest = function () {\n      var _ref8 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee3(_ref7) {\n        var method = _ref7.method,\n            url = _ref7.url,\n            path = _ref7.path,\n            headers = _ref7.headers,\n            data = _ref7.data,\n            type = _ref7.type;\n        var req;\n        return _regenerator2.default.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!(!path && !url)) {\n                  _context3.next = 2;\n                  break;\n                }\n\n                throw new Error(\"Either path or url must be specified.\");\n\n              case 2:\n                if (!url) {\n                  _context3.next = 9;\n                  break;\n                }\n\n                if (!/^\\//.test(url)) {\n                  _context3.next = 7;\n                  break;\n                }\n\n                url = domain + url;\n                _context3.next = 9;\n                break;\n\n              case 7:\n                if (!(url.indexOf(domain) !== 0)) {\n                  _context3.next = 9;\n                  break;\n                }\n\n                throw new Error(\"'url' key must begin with the domain used to connect\");\n\n              case 9:\n                method = method.toLowerCase();\n                req = {\n                  method: method,\n                  url: url || DOMAIN + path,\n                  headers: {\n                    authorization: \"Bearer \" + TOKEN\n                  }\n                };\n                if (/\\/$/.test(req.url)) req.url = req.url.slice(0, req.url.length - 1); //handle headers\n\n                (0, _keys2.default)(headers || {}).forEach(function (header) {\n                  req.headers[header.toLowerCase()] = headers[header];\n                });\n\n                if (method === \"put\" || method === \"post\") {\n                  req.headers[\"content-type\"] = req.headers[\"content-type\"] || type || data._type;\n                  req.data = data;\n                }\n\n                if (method === \"delete\") {\n                  req.headers[\"content-type\"] = req.headers[\"content-type\"] || type;\n                }\n\n                return _context3.abrupt(\"return\", req);\n\n              case 16:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      return function _buildRequest(_x5) {\n        return _ref8.apply(this, arguments);\n      };\n    }();\n\n    var _sendRequest = function () {\n      var _ref9 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee4(req) {\n        return _regenerator2.default.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.prev = 0;\n                return _context4.abrupt(\"return\", REQUEST(req));\n\n              case 4:\n                _context4.prev = 4;\n                _context4.t0 = _context4[\"catch\"](0);\n\n                if (!(_context4.t0 && _context4.t0.response.status === 401)) {\n                  _context4.next = 10;\n                  break;\n                }\n\n                _context4.next = 9;\n                return reconnect();\n\n              case 9:\n                return _context4.abrupt(\"return\", REQUEST(req));\n\n              case 10:\n                throw _context4.t0;\n\n              case 11:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this, [[0, 4]]);\n      }));\n\n      return function _sendRequest(_x6) {\n        return _ref9.apply(this, arguments);\n      };\n    }();\n\n    var get = function () {\n      var _ref11 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee5(_ref10) {\n        var url = _ref10.url,\n            path = _ref10.path,\n            headers = _ref10.headers,\n            watch = _ref10.watch,\n            tree = _ref10.tree;\n        var req, watchResponse, response, pieces, treePath, subTree, stuff;\n        return _regenerator2.default.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.next = 2;\n                return _buildRequest({\n                  method: \"get\",\n                  url: url,\n                  path: path,\n                  headers: headers\n                });\n\n              case 2:\n                req = _context5.sent; // If a tree is supplied, recursively GET data according to the data tree\n                // The tree must be rooted at /bookmarks.\n\n                watchResponse = void 0; // TODO: shouldn't request twice for normal tree get...\n\n                _context5.next = 6;\n                return _sendRequest(req);\n\n              case 6:\n                response = _context5.sent;\n\n                if (!watch) {\n                  _context5.next = 15;\n                  break;\n                }\n\n                path = path || urlLib.parse(url).path;\n                req.headers[\"x-oada-rev\"] = response.data._rev;\n                console.log('SENDING THIS REEVVVVVVVVVVVVVVV', response.data._rev);\n                _context5.next = 13;\n                return _watch({\n                  headers: req.headers,\n                  path: path,\n                  func: watch.function,\n                  payload: watch.payload\n                });\n\n              case 13:\n                watchResponse = _context5.sent;\n                console.log('WATCH RESPONSE', watchResponse);\n\n              case 15:\n                if (!tree) {\n                  _context5.next = 45;\n                  break;\n                }\n\n                console.log('IS TREE');\n                pieces = urlLib.parse(req.url).path.replace(/^\\//, \"\").split(\"/\");\n                treePath = _convertSetupTreePath(pieces, tree);\n                console.log(tree, treePath);\n\n                if (pointer.has(tree, treePath)) {\n                  _context5.next = 22;\n                  break;\n                }\n\n                throw new Error(\"The path does not exist on the given tree.\");\n\n              case 22:\n                //return get({url: req.url})\n                subTree = pointer.get(tree, treePath);\n                _context5.prev = 23;\n\n                if (!(watch && watchResponse.resource)) {\n                  _context5.next = 31;\n                  break;\n                }\n\n                console.log('tree getting', watch, watchResponse.resource);\n                _context5.next = 28;\n                return _recursiveGet(req.url, subTree, watchResponse.resource, true);\n\n              case 28:\n                stuff = _context5.sent;\n                _context5.next = 34;\n                break;\n\n              case 31:\n                _context5.next = 33;\n                return _recursiveGet(req.url, subTree, {}, true);\n\n              case 33:\n                stuff = _context5.sent;\n\n              case 34:\n                response.data = stuff.data;\n                response.cached = stuff.cached;\n                _context5.next = 45;\n                break;\n\n              case 38:\n                _context5.prev = 38;\n                _context5.t0 = _context5[\"catch\"](23); // catch 404s because ... ?\n\n                console.log('ERA', _context5.t0);\n\n                if (!(_context5.t0.response && _context5.t0.response.status === 404)) {\n                  _context5.next = 44;\n                  break;\n                }\n\n                _context5.next = 45;\n                break;\n\n              case 44:\n                throw _context5.t0;\n\n              case 45:\n                return _context5.abrupt(\"return\", response);\n\n              case 46:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this, [[23, 38]]);\n      }));\n\n      return function get(_x7) {\n        return _ref11.apply(this, arguments);\n      };\n    }(); //get\n\n\n    var _recursiveGet = function () {\n      var _ref12 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee7(url, tree, data, cached) {\n        var got;\n        return _regenerator2.default.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                if (!tree._type) {\n                  _context7.next = 6;\n                  break;\n                }\n\n                _context7.next = 3;\n                return get({\n                  url: url,\n                  headers: '_rev' in data ? {\n                    'x-oada-rev': data._rev\n                  } : {}\n                });\n\n              case 3:\n                got = _context7.sent; //info('_recursiveGet GET data:', got.data)\n\n                data = got.data;\n                cached = got.cached ? got.cached : false;\n\n              case 6:\n                return _context7.abrupt(\"return\", Promise.map((0, _keys2.default)(data || {}), function () {\n                  var _ref13 = (0, _asyncToGenerator3.default)(\n                  /*#__PURE__*/\n                  _regenerator2.default.mark(function _callee6(key) {\n                    var res;\n                    return _regenerator2.default.wrap(function _callee6$(_context6) {\n                      while (1) {\n                        switch (_context6.prev = _context6.next) {\n                          case 0:\n                            if (!((0, _typeof3.default)(data[key]) === \"object\")) {\n                              _context6.next = 20;\n                              break;\n                            }\n\n                            if (!tree[key]) {\n                              _context6.next = 9;\n                              break;\n                            }\n\n                            _context6.next = 4;\n                            return _recursiveGet(url + \"/\" + key, tree[key], data[key], cached);\n\n                          case 4:\n                            res = _context6.sent;\n                            cached = res.cached;\n                            return _context6.abrupt(\"return\", data[key] = res.data);\n\n                          case 9:\n                            if (!tree[\"*\"]) {\n                              _context6.next = 17;\n                              break;\n                            }\n\n                            _context6.next = 12;\n                            return _recursiveGet(url + \"/\" + key, tree[\"*\"], data[key], cached);\n\n                          case 12:\n                            res = _context6.sent;\n                            cached = res.cached;\n                            return _context6.abrupt(\"return\", data[key] = res.data);\n\n                          case 17:\n                            return _context6.abrupt(\"return\");\n\n                          case 18:\n                            _context6.next = 21;\n                            break;\n\n                          case 20:\n                            return _context6.abrupt(\"return\");\n\n                          case 21:\n                          case \"end\":\n                            return _context6.stop();\n                        }\n                      }\n                    }, _callee6, this);\n                  }));\n\n                  return function (_x12) {\n                    return _ref13.apply(this, arguments);\n                  };\n                }()).then(function () {\n                  return {\n                    data: data,\n                    cached: cached\n                  };\n                }));\n\n              case 7:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      return function _recursiveGet(_x8, _x9, _x10, _x11) {\n        return _ref12.apply(this, arguments);\n      };\n    }(); // Identify the stored resources vs those that need to be setup.\n    // Walk down the given path using the tree as a guide to create the necessary\n    // resource breaks along the way.\n\n\n    var _ensureTree = function () {\n      var _ref15 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee9(_ref14) {\n        var url = _ref14.url,\n            tree = _ref14.tree,\n            data = _ref14.data;\n        var path, pieces, firstPath, storedTree, responses, ret, parentRev;\n        return _regenerator2.default.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                path = urlLib.parse(url).path.replace(/^\\//, \"\");\n                pieces = path.replace(/\\/$/, \"\").split(\"/\"); // replace trailing slashes\n\n                if (data._id) {\n                  firstPath = _convertSetupTreePath(pieces, tree);\n                  pointer.set(tree, firstPath + \"/_id\", data._id);\n                } //    if (pointer.has(tree, treePath)) pointer.set(tree, treePath, _.merge(pointer.get(tree, treePath),data))\n\n\n                storedTree = {};\n                responses = []; // Find the deepest part of the path that exists. Once found, work back down.\n\n                _context9.next = 7;\n                return _findDeepestResources(pieces, tree, storedTree);\n\n              case 7:\n                ret = _context9.sent; // Create all the resources on the way down. ret.stored is an index. Slice\n                // takes the length to slice, so no need to subtract 1.\n\n                parentRev = ret._rev;\n                _context9.next = 11;\n                return Promise.mapSeries(pieces.slice(0, pieces.length - ret.stored), function () {\n                  var _ref16 = (0, _asyncToGenerator3.default)(\n                  /*#__PURE__*/\n                  _regenerator2.default.mark(function _callee8(piece, j) {\n                    var i, urlPath, treePath, content, resp;\n                    return _regenerator2.default.wrap(function _callee8$(_context8) {\n                      while (1) {\n                        switch (_context8.prev = _context8.next) {\n                          case 0:\n                            i = ret.stored + 1 + j;\n                            urlPath = \"/\" + pieces.slice(0, i + 1).join(\"/\");\n                            treePath = _convertSetupTreePath(pieces.slice(0, i + 1), tree);\n\n                            if (!(pointer.has(tree, treePath + \"/_type\") && i <= ret.setup)) {\n                              _context8.next = 14;\n                              break;\n                            }\n\n                            _context8.next = 6;\n                            return _replaceLinks(pointer.get(tree, treePath));\n\n                          case 6:\n                            content = _context8.sent;\n                            _context8.next = 9;\n                            return _makeResourceAndLink({\n                              path: urlPath,\n                              data: _lodash2.default.cloneDeep(content),\n                              headers: {\n                                \"if-match\": parentRev\n                              }\n                            });\n\n                          case 9:\n                            resp = _context8.sent;\n                            parentRev = resp.resource.headers[\"x-oada-rev\"];\n                            pointer.set(storedTree, urlPath, content);\n                            resp.path = urlPath;\n                            responses.push(resp);\n\n                          case 14:\n                          case \"end\":\n                            return _context8.stop();\n                        }\n                      }\n                    }, _callee8, this);\n                  }));\n\n                  return function (_x14, _x15) {\n                    return _ref16.apply(this, arguments);\n                  };\n                }());\n\n              case 11:\n                return _context9.abrupt(\"return\", responses);\n\n              case 12:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      return function _ensureTree(_x13) {\n        return _ref15.apply(this, arguments);\n      };\n    }();\n\n    var _recursiveDelete = function () {\n      var _ref19 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee12(url, tree, data) {\n        var got;\n        return _regenerator2.default.wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                if (!tree._type) {\n                  _context12.next = 13;\n                  break;\n                }\n\n                _context12.prev = 1;\n                _context12.next = 4;\n                return get({\n                  url: url\n                });\n\n              case 4:\n                got = _context12.sent;\n                data = got.data;\n                _context12.next = 13;\n                break;\n\n              case 8:\n                _context12.prev = 8;\n                _context12.t0 = _context12[\"catch\"](1);\n\n                if (!(_context12.t0.status === 404)) {\n                  _context12.next = 13;\n                  break;\n                }\n\n                data = {};\n                return _context12.abrupt(\"return\");\n\n              case 13:\n                return _context12.abrupt(\"return\", Promise.map((0, _keys2.default)(data || {}), function () {\n                  var _ref20 = (0, _asyncToGenerator3.default)(\n                  /*#__PURE__*/\n                  _regenerator2.default.mark(function _callee10(key) {\n                    var res;\n                    return _regenerator2.default.wrap(function _callee10$(_context10) {\n                      while (1) {\n                        switch (_context10.prev = _context10.next) {\n                          case 0:\n                            if (!((0, _typeof3.default)(data[key]) === \"object\")) {\n                              _context10.next = 18;\n                              break;\n                            }\n\n                            if (!tree[key]) {\n                              _context10.next = 8;\n                              break;\n                            }\n\n                            _context10.next = 4;\n                            return _recursiveDelete(url + \"/\" + key, tree[key], data[key]);\n\n                          case 4:\n                            res = _context10.sent;\n                            return _context10.abrupt(\"return\", data[key] = res.data);\n\n                          case 8:\n                            if (!tree[\"*\"]) {\n                              _context10.next = 15;\n                              break;\n                            }\n\n                            _context10.next = 11;\n                            return _recursiveDelete(url + \"/\" + key, tree[\"*\"], data[key]);\n\n                          case 11:\n                            res = _context10.sent;\n                            return _context10.abrupt(\"return\", data[key] = res.data);\n\n                          case 15:\n                            return _context10.abrupt(\"return\");\n\n                          case 16:\n                            _context10.next = 19;\n                            break;\n\n                          case 18:\n                            return _context10.abrupt(\"return\");\n\n                          case 19:\n                          case \"end\":\n                            return _context10.stop();\n                        }\n                      }\n                    }, _callee10, this);\n                  }));\n\n                  return function (_x19) {\n                    return _ref20.apply(this, arguments);\n                  };\n                }()).then((0, _asyncToGenerator3.default)(\n                /*#__PURE__*/\n                _regenerator2.default.mark(function _callee11() {\n                  var link;\n                  return _regenerator2.default.wrap(function _callee11$(_context11) {\n                    while (1) {\n                      switch (_context11.prev = _context11.next) {\n                        case 0:\n                          if (!tree._type) {\n                            _context11.next = 23;\n                            break;\n                          }\n\n                          _context11.prev = 1;\n\n                          if (!data._id) {\n                            _context11.next = 11;\n                            break;\n                          }\n\n                          _context11.prev = 3;\n                          _context11.next = 6;\n                          return del({\n                            path: '/' + data._id,\n                            headers: {\n                              'content-type': tree._type\n                            }\n                          });\n\n                        case 6:\n                          _context11.next = 11;\n                          break;\n\n                        case 8:\n                          _context11.prev = 8;\n                          _context11.t0 = _context11[\"catch\"](3);\n                          console.log('aaaaaaaa', '/' + data._id, url, _context11.t0);\n\n                        case 11:\n                          _context11.next = 13;\n                          return del({\n                            url: url,\n                            headers: {\n                              'content-type': tree._type\n                            }\n                          });\n\n                        case 13:\n                          link = _context11.sent;\n                          _context11.next = 21;\n                          break;\n\n                        case 16:\n                          _context11.prev = 16;\n                          _context11.t1 = _context11[\"catch\"](1);\n\n                          if (!(_context11.t1.response && _context11.t1.response.status === 404)) {\n                            _context11.next = 21;\n                            break;\n                          }\n\n                          data = {};\n                          return _context11.abrupt(\"return\", {\n                            link: link || {},\n                            data: data || {}\n                          });\n\n                        case 21:\n                          _context11.next = 26;\n                          break;\n\n                        case 23:\n                          if (!CACHE) {\n                            _context11.next = 26;\n                            break;\n                          }\n\n                          _context11.next = 26;\n                          return CACHE.removeLookup({\n                            url: url\n                          });\n\n                        case 26:\n                          return _context11.abrupt(\"return\", {\n                            link: link || {},\n                            data: data || {}\n                          });\n\n                        case 27:\n                        case \"end\":\n                          return _context11.stop();\n                      }\n                    }\n                  }, _callee11, this, [[1, 16], [3, 8]]);\n                }))));\n\n              case 14:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12, this, [[1, 8]]);\n      }));\n\n      return function _recursiveDelete(_x16, _x17, _x18) {\n        return _ref19.apply(this, arguments);\n      };\n    }();\n\n    var del = function () {\n      var _ref23 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee13(_ref22) {\n        var url = _ref22.url,\n            path = _ref22.path,\n            type = _ref22.type,\n            headers = _ref22.headers,\n            tree = _ref22.tree,\n            unwatch = _ref22.unwatch;\n        var req, pieces, treePath, subTree, result;\n        return _regenerator2.default.wrap(function _callee13$(_context13) {\n          while (1) {\n            switch (_context13.prev = _context13.next) {\n              case 0:\n                _context13.next = 2;\n                return _buildRequest({\n                  method: \"delete\",\n                  url: url,\n                  path: path,\n                  type: type,\n                  headers: headers\n                });\n\n              case 2:\n                req = _context13.sent;\n\n                if (!unwatch) {\n                  _context13.next = 6;\n                  break;\n                }\n\n                path = path || urlLib.parse(url).path;\n                return _context13.abrupt(\"return\", SOCKET.unwatch({\n                  path: path,\n                  headers: req.headers\n                }));\n\n              case 6:\n                if (!tree) {\n                  _context13.next = 16;\n                  break;\n                }\n\n                pieces = urlLib.parse(req.url).path.replace(/^\\//, \"\").split(\"/\");\n                treePath = _convertSetupTreePath(pieces, tree);\n\n                if (pointer.has(tree, treePath)) {\n                  _context13.next = 11;\n                  break;\n                }\n\n                throw new Error(\"The path does not exist on the given tree.\");\n\n              case 11:\n                //return get({url: req.url})\n                subTree = pointer.get(tree, treePath);\n                _context13.next = 14;\n                return _recursiveDelete(req.url, subTree, {}, true);\n\n              case 14:\n                result = _context13.sent;\n                return _context13.abrupt(\"return\", result.link);\n\n              case 16:\n                if (req.headers[\"content-type\"]) {\n                  _context13.next = 18;\n                  break;\n                }\n\n                throw new Error(\"content-type header must be specified.\");\n\n              case 18:\n                return _context13.abrupt(\"return\", _sendRequest(req));\n\n              case 19:\n              case \"end\":\n                return _context13.stop();\n            }\n          }\n        }, _callee13, this);\n      }));\n\n      return function del(_x20) {\n        return _ref23.apply(this, arguments);\n      };\n    }(); // Ensure all resources down to the deepest resource are created before\n    // performing a PUT.\n\n\n    var put = function () {\n      var _ref25 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee14(_ref24) {\n        var url = _ref24.url,\n            path = _ref24.path,\n            data = _ref24.data,\n            type = _ref24.type,\n            headers = _ref24.headers,\n            tree = _ref24.tree;\n        var req, responses, pieces, treePath;\n        return _regenerator2.default.wrap(function _callee14$(_context14) {\n          while (1) {\n            switch (_context14.prev = _context14.next) {\n              case 0:\n                _context14.next = 2;\n                return _buildRequest({\n                  method: \"put\",\n                  url: url,\n                  path: path,\n                  data: data,\n                  type: type,\n                  headers: headers\n                });\n\n              case 2:\n                req = _context14.sent;\n\n                if (!tree) {\n                  _context14.next = 10;\n                  break;\n                }\n\n                _context14.next = 6;\n                return _ensureTree({\n                  url: req.url,\n                  tree: _lodash2.default.cloneDeep(tree),\n                  data: data\n                });\n\n              case 6:\n                responses = _context14.sent;\n                pieces = responses.length > 0 ? responses[responses.length - 1].path.replace(/^\\//, \"\").split(\"/\") : urlLib.parse(req.url).path.replace(/^\\//, \"\").split(\"/\");\n                treePath = _convertSetupTreePath(pieces, tree) + \"/_type\";\n                if (!req.headers[\"content-type\"] && pointer.has(tree, treePath)) req.headers[\"content-type\"] = _lodash2.default.clone(pointer.get(tree, treePath));\n\n              case 10:\n                if (req.headers[\"content-type\"]) {\n                  _context14.next = 12;\n                  break;\n                }\n\n                throw new Error(\"content-type header must be specified.\");\n\n              case 12:\n                return _context14.abrupt(\"return\", _sendRequest(req).then(function (result) {\n                  return result;\n                }));\n\n              case 13:\n              case \"end\":\n                return _context14.stop();\n            }\n          }\n        }, _callee14, this);\n      }));\n\n      return function put(_x21) {\n        return _ref25.apply(this, arguments);\n      };\n    }();\n\n    var resetCache = function () {\n      var _ref26 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee15(name, expires) {\n        return _regenerator2.default.wrap(function _callee15$(_context15) {\n          while (1) {\n            switch (_context15.prev = _context15.next) {\n              case 0:\n                if (CACHE) {\n                  _context15.next = 2;\n                  break;\n                }\n\n                return _context15.abrupt(\"return\");\n\n              case 2:\n                _context15.next = 4;\n                return CACHE.resetCache();\n\n              case 4:\n              case \"end\":\n                return _context15.stop();\n            }\n          }\n        }, _callee15, this);\n      }));\n\n      return function resetCache(_x22, _x23) {\n        return _ref26.apply(this, arguments);\n      };\n    }();\n\n    var disconnect = function () {\n      var _ref27 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee16() {\n        return _regenerator2.default.wrap(function _callee16$(_context16) {\n          while (1) {\n            switch (_context16.prev = _context16.next) {\n              case 0:\n                if (!CACHE) {\n                  _context16.next = 3;\n                  break;\n                }\n\n                _context16.next = 3;\n                return CACHE.db.close();\n\n              case 3:\n                //if (CACHE) await CACHE.db.destroy();\n                if (SOCKET) SOCKET.close(); //if (_token.isSet()) {\n\n                _token.cleanUp();\n\n              //}\n\n              case 5:\n              case \"end\":\n                return _context16.stop();\n            }\n          }\n        }, _callee16, this);\n      }));\n\n      return function disconnect() {\n        return _ref27.apply(this, arguments);\n      };\n    }();\n\n    var reconnect = function () {\n      var _ref28 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee17() {\n        return _regenerator2.default.wrap(function _callee17$(_context17) {\n          while (1) {\n            switch (_context17.prev = _context17.next) {\n              case 0:\n                _context17.next = 2;\n                return _token.renew();\n\n              case 2:\n                TOKEN = _context17.sent;\n\n              case 3:\n              case \"end\":\n                return _context17.stop();\n            }\n          }\n        }, _callee17, this);\n      }));\n\n      return function reconnect() {\n        return _ref28.apply(this, arguments);\n      };\n    }(); // get a token\n\n\n    var domain = _ref.domain,\n        options = _ref.options,\n        cache = _ref.cache,\n        token = _ref.token,\n        websocket = _ref.websocket;\n\n    var OFFLINE, CACHE, REQUEST, NOCACHEREQUEST, SOCKET, TOKEN, _token, DOMAIN, NAME, EXPIRES, _replaceLinks, _watch, _findDeepestResources, _convertSetupTreePath, _configureCache, post, socketApi, _getMemoryCache;\n\n    return _regenerator2.default.wrap(function _callee18$(_context18) {\n      while (1) {\n        switch (_context18.prev = _context18.next) {\n          case 0:\n            _getMemoryCache = function _getMemoryCache() {\n              if (CACHE) {\n                return CACHE._getMemoryCache();\n              } else {\n                return {};\n              }\n            };\n\n            post = function post(_ref18) {\n              var url = _ref18.url,\n                  path = _ref18.path,\n                  data = _ref18.data,\n                  type = _ref18.type,\n                  headers = _ref18.headers,\n                  tree = _ref18.tree;\n              url = url || DOMAIN + path;\n              url = url[url.length - 1] === \"/\" ? url + (0, _uuid2.default)() : url + \"/\" + (0, _uuid2.default)();\n              return put({\n                url: url,\n                data: data,\n                type: type,\n                headers: headers,\n                tree: tree\n              });\n            };\n\n            _configureCache = function _configureCache(_ref17) {\n              var name = _ref17.name,\n                  req = _ref17.req,\n                  expires = _ref17.expires;\n              var res = (0, _cache2.default)({\n                name: name,\n                req: req,\n                expires: expires\n              });\n              REQUEST = res.api;\n              CACHE = res;\n              return;\n            };\n\n            _convertSetupTreePath = function _convertSetupTreePath(pathPieces, tree) {\n              var newPieces = _lodash2.default.clone(pathPieces);\n\n              newPieces = pathPieces.map(function (piece, i) {\n                if (pointer.has(tree, \"/\" + newPieces.slice(0, i).join(\"/\") + \"/*\")) {\n                  newPieces[i] = \"*\";\n                  return \"*\";\n                } else {\n                  return piece;\n                }\n              });\n              return \"/\" + newPieces.join(\"/\");\n            };\n\n            _findDeepestResources = function _findDeepestResources(pieces, tree, storedTree) {\n              var stored = 0;\n              var setup = void 0;\n\n              var _rev; // Walk down the url in reverse order\n\n\n              return Promise.mapSeries(pieces, function (piece, i) {\n                var z = pieces.length - 1 - i; //use z to create paths in reverse order\n\n                var urlPath = \"/\" + pieces.slice(0, z + 1).join(\"/\");\n\n                var treePath = _convertSetupTreePath(pieces.slice(0, z + 1), tree); // Check that its in the stored tree then look for deepest _resource_.\n                // If successful, break from the loop by throwing\n\n\n                if (pointer.has(tree, treePath + \"/_type\")) {\n                  setup = setup || z;\n\n                  if (pointer.has(storedTree, urlPath)) {\n                    stored = _lodash2.default.clone(z);\n                    throw new Error(\"stored\");\n                  }\n\n                  return get({\n                    path: urlPath\n                  }).then(function (response) {\n                    //TODO: Detect whether the returned data matches the given tree\n                    pointer.set(storedTree, urlPath, {});\n                    stored = _lodash2.default.clone(z);\n                    _rev = response.headers[\"x-oada-rev\"];\n                    throw new Error(\"stored\");\n                  }).catch(function (err) {\n                    if (/^stored/.test(err.message)) throw err;\n                    return;\n                  });\n                } else return;\n              }).catch(function (err) {\n                // Throwing with a number error only should occur on success.\n                if (/^stored/.test(err.message)) return {\n                  stored: stored,\n                  setup: setup\n                };\n              }).then(function () {\n                return {\n                  stored: stored,\n                  setup: setup || 0,\n                  _rev: _rev\n                };\n              });\n            };\n\n            _watch = function _watch(_ref5) {\n              var headers = _ref5.headers,\n                  path = _ref5.path,\n                  func = _ref5.func,\n                  payload = _ref5.payload;\n\n              if (SOCKET) {\n                return SOCKET.watch({\n                  path: path,\n                  headers: headers\n                }, function () {\n                  var _ref6 = (0, _asyncToGenerator3.default)(\n                  /*#__PURE__*/\n                  _regenerator2.default.mark(function _callee2(response) {\n                    var watchPayload;\n                    return _regenerator2.default.wrap(function _callee2$(_context2) {\n                      while (1) {\n                        switch (_context2.prev = _context2.next) {\n                          case 0:\n                            watchPayload = _lodash2.default.cloneDeep(payload) || {};\n                            watchPayload.response = response;\n                            watchPayload.request = {\n                              url: DOMAIN + path,\n                              headers: headers,\n                              method: response.change.type\n                            };\n                            _context2.prev = 3;\n\n                            if (!CACHE) {\n                              _context2.next = 8;\n                              break;\n                            }\n\n                            _context2.next = 7;\n                            return CACHE.handleWatchChange(watchPayload);\n\n                          case 7:\n                            watchPayload = _context2.sent;\n\n                          case 8:\n                            _context2.next = 13;\n                            break;\n\n                          case 10:\n                            _context2.prev = 10;\n                            _context2.t0 = _context2[\"catch\"](3);\n                            console.log(_context2.t0);\n\n                          case 13:\n                            if (!func) {\n                              _context2.next = 16;\n                              break;\n                            }\n\n                            _context2.next = 16;\n                            return func(watchPayload);\n\n                          case 16:\n                            return _context2.abrupt(\"return\");\n\n                          case 17:\n                          case \"end\":\n                            return _context2.stop();\n                        }\n                      }\n                    }, _callee2, this, [[3, 10]]);\n                  }));\n\n                  function handleWatchResponse(_x4) {\n                    return _ref6.apply(this, arguments);\n                  }\n\n                  return handleWatchResponse;\n                }());\n              } else {\n                return;\n                /*\n                // Ping a normal GET every 5 seconds in the absense of a websocket\n                return setInterval(() => {\n                  get({ url: DOMAIN + path }).then(result => {\n                    func(payload);\n                  });\n                }, 5000);\n                */\n              }\n            };\n\n            _replaceLinks = function _replaceLinks(obj) {\n              var ret = Array.isArray(obj) ? [] : {};\n              if (!obj) return obj; // no defined objriptors for this level\n\n              return Promise.map((0, _keys2.default)(obj || {}), function (key) {\n                if (key === \"*\") {\n                  // Don't put *s into oada. Ignore them\n                  return;\n                }\n\n                var val = obj[key];\n\n                if ((typeof val === \"undefined\" ? \"undefined\" : (0, _typeof3.default)(val)) !== \"object\" || !val) {\n                  ret[key] = val; // keep it asntType: 'application/vnd.oada.harvest.1+json'\n\n                  return;\n                }\n\n                if (val._type) {\n                  // If it has a '_type' key, don't worry about it.\n                  //It'll get created in future iterations of ensureTree\n                  return;\n                }\n\n                if (val._id) {\n                  // If it's an object, and has an '_id', make it a link from descriptor\n                  ret[key] = {\n                    _id: val._id\n                  };\n                  if ('_rev' in val) ret[key]._rev = val._rev;\n                  return;\n                } // otherwise, recurse into the object looking for more links\n\n\n                return _replaceLinks(val).then(function (result) {\n                  ret[key] = result;\n                  return;\n                });\n              }).then(function () {\n                return ret;\n              });\n            };\n\n            if (domain) {\n              _context18.next = 9;\n              break;\n            }\n\n            throw new Error(\"domain undefined\");\n\n          case 9:\n            if (!(typeof domain !== \"string\")) {\n              _context18.next = 11;\n              break;\n            }\n\n            throw new Error(\"domain must be a string\");\n\n          case 11:\n            if (!(!options && !token)) {\n              _context18.next = 13;\n              break;\n            }\n\n            throw new Error(\"options and token undefined\");\n\n          case 13:\n            if (!(token && typeof token !== \"string\")) {\n              _context18.next = 15;\n              break;\n            }\n\n            throw new Error(\"token must be a string\");\n\n          case 15:\n            if (!(cache !== undefined && typeof cache !== \"boolean\" && (typeof cache === \"undefined\" ? \"undefined\" : (0, _typeof3.default)(cache)) !== \"object\")) {\n              _context18.next = 17;\n              break;\n            }\n\n            throw new Error(\"cache must be either a boolean or an object with 'name' and/or 'expires' keys\");\n\n          case 17:\n            if (!(cache && cache.name && typeof cache.name !== \"string\")) {\n              _context18.next = 19;\n              break;\n            }\n\n            throw new Error(\"cache name must be a string\");\n\n          case 19:\n            if (!(typeof websocket !== \"undefined\" && typeof websocket !== \"boolean\")) {\n              _context18.next = 21;\n              break;\n            }\n\n            throw new Error(\"websocket must be boolean\");\n\n          case 21:\n            REQUEST = axios;\n            NOCACHEREQUEST = axios;\n            _token = new _TOKEN({\n              domain: domain,\n              token: token,\n              options: options\n            });\n\n            if (domain) {\n              _context18.next = 26;\n              break;\n            }\n\n            throw new Error(\"domain undefined\");\n\n          case 26:\n            DOMAIN = domain;\n            NAME = cache && cache.name ? cache.name : urlLib.parse(domain).hostname.replace(/\\./g, \"_\");\n            EXPIRES = cache && cache.expires ? cache.expires : undefined; // Loop over the keys of the path and determine whether the object at that level\n            // contains a * key. The path must be updated along the way, replacing *s as\n            // necessary.\n\n            _context18.next = 31;\n            return _token.get();\n\n          case 31:\n            TOKEN = _context18.sent;\n\n            if (!(websocket !== false)) {\n              _context18.next = 41;\n              break;\n            }\n\n            _context18.next = 35;\n            return ws(domain);\n\n          case 35:\n            socketApi = _context18.sent;\n            NOCACHEREQUEST = socketApi.http;\n            REQUEST = socketApi.http;\n            _context18.next = 40;\n            return socketApi;\n\n          case 40:\n            SOCKET = _context18.sent;\n\n          case 41:\n            if (!(cache !== false)) {\n              _context18.next = 44;\n              break;\n            }\n\n            _context18.next = 44;\n            return _configureCache({\n              name: NAME || (0, _uuid2.default)(),\n              req: REQUEST,\n              expires: EXPIRES\n            });\n\n          case 44:\n            return _context18.abrupt(\"return\", {\n              token: TOKEN,\n              cache: CACHE ? CACHE : false,\n              websocket: SOCKET ? SOCKET : false,\n              get: get,\n              put: put,\n              post: post,\n              delete: del,\n              resetCache: resetCache,\n              disconnect: disconnect,\n              reconnect: reconnect,\n              _getMemoryCache: _getMemoryCache\n            });\n\n          case 45:\n          case \"end\":\n            return _context18.stop();\n        }\n      }\n    }, _callee18, this);\n  }));\n\n  function connect(_x) {\n    return _ref2.apply(this, arguments);\n  }\n\n  return connect;\n}();\n\nexports.default = {\n  connect: connect\n};","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _defineProperty2 = require(\"babel-runtime/helpers/defineProperty\");\n\nvar _defineProperty3 = _interopRequireDefault(_defineProperty2);\n\nvar _typeof2 = require(\"babel-runtime/helpers/typeof\");\n\nvar _typeof3 = _interopRequireDefault(_typeof2);\n\nvar _keys = require(\"babel-runtime/core-js/object/keys\");\n\nvar _keys2 = _interopRequireDefault(_keys);\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require(\"babel-runtime/helpers/asyncToGenerator\");\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nexports.default = setupCache;\n\nvar _pouchdb = require(\"pouchdb\");\n\nvar _pouchdb2 = _interopRequireDefault(_pouchdb);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar cq = require(\"concurrent-queue\");\n\nvar pretty = require(\"prettyjson\");\n\nvar Promise = require(\"bluebird\");\n\nvar url = require(\"url\");\n\nvar _ = require(\"lodash\");\n\nvar pointer = require(\"json-pointer\");\n\nvar OFFLINE = false;\nvar REVLIMIT = 10;\nvar memoryCache = {};\nvar timeThreshold = 30000;\nvar cleanMemoryTimer = 10000;\nvar dbPutDelay = 5000; // 5 sec\n\nPromise.config({\n  cancellation: true\n}); //const error = require('debug')('oada-cache:cache:error');\n//const info = require('debug')('oada-cache:cache:info');\n\nfunction setupCache(_ref) {\n  var _ref20;\n  /** Get the resource and merge data if its already in the db. */\n\n  /**\n   * Store (upsert) resource to local DB\n   * @param req request\n   * @param waitTime wait time\n   */\n\n\n  var dbUpsert = function () {\n    var _ref3 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee2(req, waitTime) {\n      var urlObj, pieces, resourceId, pathLeftover, dbPut, memoryResult, result, curData, newData;\n      return _regenerator2.default.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              urlObj = url.parse(req.url);\n              pieces = urlObj.path.split(\"/\");\n              resourceId = pieces.slice(1, 3).join(\"/\"); //returns resources/abc\n\n              pathLeftover = pieces.length > 3 ? \"/\" + pieces.slice(3, pieces.length).join(\"/\") : \"\"; // Create the content to put in the cache\n\n              dbPut = {\n                _id: resourceId,\n                valid: req.valid === undefined ? true : req.valid,\n                // TODO: This current resets this access date for e.g., every put\n                // while offline. This doesn't seem right. I think this should only\n                // get updated when we know we're upserting a new value from the server\n                accessed: Date.now(),\n                doc: {}\n              }; // ALL updates to existing docs (upserts) need to supply the current _rev.\n\n              memoryResult = memoryCache[resourceId]; // Try to get resource from in-memory cache\n\n              result = {\n                doc: {}\n              };\n\n              if (memoryResult) {\n                _context2.next = 23;\n                break;\n              }\n\n              _context2.prev = 8;\n              _context2.next = 11;\n              return db.get(resourceId);\n\n            case 11:\n              result = _context2.sent;\n              _context2.next = 21;\n              break;\n\n            case 14:\n              _context2.prev = 14;\n              _context2.t0 = _context2[\"catch\"](8);\n\n              if (!(req.method && req.method.toLowerCase() === \"delete\")) {\n                _context2.next = 20;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 20:\n              if (pathLeftover) {\n                dbPut.INCOMPLETE_RESOURCE = true;\n              }\n\n            case 21:\n              _context2.next = 25;\n              break;\n\n            case 23:\n              result = memoryResult.data; // If in memory, result._rev might be undefined (409 errors)\n\n              if (result._rev !== undefined) dbPut._rev = result._rev;\n\n            case 25:\n              if (!(req.method && req.method.toLowerCase() === \"delete\")) {\n                _context2.next = 35;\n                break;\n              }\n\n              if (pathLeftover) {\n                _context2.next = 32;\n                break;\n              }\n\n              if (memoryCache[resourceId] && memoryCache[resourceId].promise) memoryCache[resourceId].promise.cancel();\n              delete memoryCache[resourceId];\n              return _context2.abrupt(\"return\", db.remove(result).then(function (response) {\n                return {\n                  response: response\n                };\n              }).catch(function (error) {\n                //its okay if it already doesn't exist\n                if (error.status === 404) return;\n                throw error;\n              }));\n\n            case 32:\n              if (pointer.has(result.doc, pathLeftover)) {\n                dbPut.doc = result.doc;\n                pointer.remove(dbPut.doc, pathLeftover);\n              }\n\n            case 33:\n              _context2.next = 36;\n              break;\n\n            case 35:\n              //handle \"merge\" type operations\n              if (pathLeftover) {\n                curData = pointer.has(result.doc, pathLeftover) ? pointer.get(result.doc, pathLeftover) : {};\n                newData = _.merge(curData, req.data || {});\n                pointer.set(result.doc, pathLeftover, newData);\n                dbPut.doc = result.doc;\n              } else {\n                dbPut.doc = _.merge(result.doc, req.data);\n              }\n\n            case 36:\n              if (req._rev != undefined) dbPut.doc._rev = req._rev;\n              return _context2.abrupt(\"return\", handleMemoryCache(resourceId, dbPut, waitTime, req));\n\n            case 38:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, this, [[8, 14]]);\n    }));\n\n    return function dbUpsert(_x2, _x3) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  /**\n   * Get resource from the server\n   * @param req request\n   */\n\n\n  var getResFromServer = function () {\n    var _ref4 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee3(req) {\n      var res;\n      return _regenerator2.default.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return request({\n                method: \"GET\",\n                url: req.url,\n                headers: req.headers\n              });\n\n            case 2:\n              res = _context3.sent;\n              res.cached = false;\n              req.data = res.data;\n              _context3.prev = 5;\n              _context3.next = 8;\n              return dbUpsert(req);\n\n            case 8:\n              _context3.next = 13;\n              break;\n\n            case 10:\n              _context3.prev = 10;\n              _context3.t0 = _context3[\"catch\"](5);\n              console.log('getResFromServerError', _context3.t0);\n\n            case 13:\n              return _context3.abrupt(\"return\", res);\n\n            case 14:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, this, [[5, 10]]);\n    }));\n\n    return function getResFromServer(_x4) {\n      return _ref4.apply(this, arguments);\n    };\n  }(); // Create a queue of actual PUTs to make when online.\n  // Resource breaks are known via setupTree.\n  // Do the puts, save out the resource IDs, and return to client\n  // Create an index on the data to find those that need synced\n  // Create a service that other apps can run which starts up and periodically\n  // checks if a connections has yet been made. A periodic service may also\n  // concievably check for updates to cached things.\n  //\n  // The cache should go \"stale\" after some period of time; However, if it cannot\n  // establish a connection, it should remain valid, usable data.\n\n  /**\n   * Get resource from local DB. If the specified resource does not exist, try to get it from the server.\n   * @param {any} req request\n   * @param {any} offline default is false (online)\n   */\n\n\n  var getResFromDb = function () {\n    var _ref6 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee5(req) {\n      var offline = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var revLimit = arguments[2];\n      var urlObj, pieces, resourceId, pathLeftover, resource, rev, res_inmemory, res_localdb, data;\n      return _regenerator2.default.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              urlObj = url.parse(req.url);\n              pieces = urlObj.path.split(\"/\");\n              resourceId = pieces.slice(1, 3).join(\"/\"); //returns resources/abc\n\n              pathLeftover = pieces.length > 3 ? \"/\" + pieces.slice(3, pieces.length).join(\"/\") : \"\";\n              resource = undefined;\n              rev = undefined; // 1) Get resource from in-memory cache\n\n              res_inmemory = memoryCache[resourceId];\n\n              if (res_inmemory) {\n                resource = res_inmemory.data.doc;\n              } // 2) Get resource from local DB\n\n\n              if (resource) {\n                _context5.next = 19;\n                break;\n              }\n\n              _context5.prev = 9;\n              _context5.next = 12;\n              return db.get(resourceId);\n\n            case 12:\n              res_localdb = _context5.sent;\n              resource = res_localdb.doc;\n              _context5.next = 19;\n              break;\n\n            case 16:\n              _context5.prev = 16;\n              _context5.t0 = _context5[\"catch\"](9); // Oops\n\n              console.log('getResFromDbErr', _context5.t0);\n\n            case 19:\n              if (!(!resource && !offline)) {\n                _context5.next = 23;\n                break;\n              }\n\n              return _context5.abrupt(\"return\", getResFromServer(req));\n\n            case 23:\n              if (!(!resource && offline)) {\n                _context5.next = 25;\n                break;\n              }\n\n              throw \"Offline and resource not found in local db.\";\n\n            case 25:\n              if (!(resource.accessed + expiration <= Date.now() || !resource.valid === \"false\")) {\n                _context5.next = 30;\n                break;\n              }\n\n              if (!offline) {\n                _context5.next = 29;\n                break;\n              }\n\n              _context5.next = 30;\n              break;\n\n            case 29:\n              return _context5.abrupt(\"return\", getResFromServer(req));\n\n            case 30:\n              if (!(req.headers && req.headers['x-oada-rev'] && parseInt(req.headers['x-oada-rev']) - parseInt(resource._rev) >= revLimit)) {\n                _context5.next = 32;\n                break;\n              }\n\n              return _context5.abrupt(\"return\", getResFromServer(req));\n\n            case 32:\n              if (!pointer.has(resource, pathLeftover)) {\n                _context5.next = 37;\n                break;\n              }\n\n              data = pointer.get(resource, pathLeftover);\n              return _context5.abrupt(\"return\", {\n                data: data,\n                headers: {\n                  \"x-oada-rev\": resource._rev,\n                  \"content-location\": resourceId + pathLeftover\n                },\n                status: 200,\n                cached: true\n              });\n\n            case 37:\n              return _context5.abrupt(\"return\", getResFromServer(req));\n\n            case 38:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, this, [[9, 16]]);\n    }));\n\n    return function getResFromDb(_x6) {\n      return _ref6.apply(this, arguments);\n    };\n  }(); // Accepts an axios-style request. Returns:\n  // {\n  //\n  //   data: the data requested,\n  //\n  //   _rev: the rev of the parent resource requested\n  //\n  //   location: e.g.: /resources/abc123/some/path/leftover\n  //\n  // }\n\n\n  var get = function () {\n    var _ref7 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee6(req, revLimit) {\n      var urlObj, newReq, lookup;\n      return _regenerator2.default.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              urlObj = url.parse(req.url);\n              newReq = _.cloneDeep(req);\n\n              if (!(!/^\\/resources/.test(urlObj.path) || !/^\\/users/.test(urlObj.path))) {\n                _context6.next = 7;\n                break;\n              }\n\n              _context6.next = 5;\n              return getLookup(req);\n\n            case 5:\n              lookup = _context6.sent;\n              newReq.url = urlObj.protocol + \"//\" + urlObj.host + \"/\" + lookup.resourceId + lookup.pathLeftover;\n\n            case 7:\n              return _context6.abrupt(\"return\", getResFromDb(newReq, OFFLINE, revLimit || REVLIMIT).then(function (response) {\n                return response;\n              }));\n\n            case 8:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6, this);\n    }));\n\n    return function get(_x7, _x8) {\n      return _ref7.apply(this, arguments);\n    };\n  }(); // TODO: Need to update the cache for both the parent resource and child new\n  // resource if one is created\n\n\n  var put = function () {\n    var _ref8 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee7(req) {\n      var offline = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var urlObj, lookup, response;\n      return _regenerator2.default.wrap(function _callee7$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              urlObj = url.parse(req.url);\n\n              if (!offline) {\n                _context7.next = 7;\n                break;\n              }\n\n              _context7.next = 4;\n              return getLookup({\n                url: urlObj.protocol + \"//\" + urlObj.host + reqPieces.slice(0, reqPieces.length - 1).join(\"/\"),\n                headers: req.headers\n              });\n\n            case 4:\n              lookup = _context7.sent;\n              _context7.next = 13;\n              break;\n\n            case 7:\n              _context7.next = 9;\n              return request(req);\n\n            case 9:\n              response = _context7.sent;\n              _context7.next = 12;\n              return dbUpsert({\n                url: response.headers[\"content-location\"],\n                data: req.data,\n                _rev: parseInt(response.headers[\"x-oada-rev\"]),\n                // TODO: should it be invalidated until pulled from server?\n                valid: false\n              });\n\n            case 12:\n              return _context7.abrupt(\"return\", response);\n\n            case 13:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee7, this);\n    }));\n\n    return function put(_x10) {\n      return _ref8.apply(this, arguments);\n    };\n  }(); // Remove the deleted key from the parent resource optimistically using\n  // put(). Also mark the parent invalid as the _rev update will affect it\n\n\n  var updateParent = function () {\n    var _ref9 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee8(req) {\n      var urlObj, reqPieces, lookup;\n      return _regenerator2.default.wrap(function _callee8$(_context8) {\n        while (1) {\n          switch (_context8.prev = _context8.next) {\n            case 0:\n              urlObj = url.parse(req.url); // Try to get the parent document\n\n              reqPieces = urlObj.path.split(\"/\");\n              _context8.next = 4;\n              return getLookup({\n                url: urlObj.protocol + \"//\" + urlObj.host + reqPieces.slice(0, reqPieces.length - 1).join(\"/\"),\n                headers: req.headers\n              });\n\n            case 4:\n              lookup = _context8.sent;\n              _context8.next = 7;\n              return dbUpsert({\n                url: \"/\" + lookup.resourceId + lookup.pathLeftover + \"/\" + reqPieces[reqPieces.length - 1],\n                method: \"delete\",\n                valid: false\n              });\n\n            case 7:\n              return _context8.abrupt(\"return\");\n\n            case 8:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n      }, _callee8, this);\n    }));\n\n    return function updateParent(_x11) {\n      return _ref9.apply(this, arguments);\n    };\n  }();\n\n  var removeLookup = function () {\n    var _ref10 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee9(lookup) {\n      return _regenerator2.default.wrap(function _callee9$(_context9) {\n        while (1) {\n          switch (_context9.prev = _context9.next) {\n            case 0:\n              // Clear the in-memory cache\n              if (memoryCache[lookup._id]) {\n                if (memoryCache[lookup._id].promise) memoryCache[lookup._id].promise.cancel();\n                delete memoryCache[lookup._id];\n              }\n\n              _context9.prev = 1;\n              _context9.next = 4;\n              return db.remove(lookup);\n\n            case 4:\n              _context9.next = 11;\n              break;\n\n            case 6:\n              _context9.prev = 6;\n              _context9.t0 = _context9[\"catch\"](1);\n\n              if (!(_context9.t0.status === 404)) {\n                _context9.next = 10;\n                break;\n              }\n\n              return _context9.abrupt(\"return\");\n\n            case 10:\n              throw _context9.t0;\n\n            case 11:\n            case \"end\":\n              return _context9.stop();\n          }\n        }\n      }, _callee9, this, [[1, 6]]);\n    }));\n\n    return function removeLookup(_x12) {\n      return _ref10.apply(this, arguments);\n    };\n  }(); // Issue DELETE to server then update the db\n\n\n  var del = function () {\n    var _ref11 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee10(req, offline) {\n      var urlObj, lookup, response;\n      return _regenerator2.default.wrap(function _callee10$(_context10) {\n        while (1) {\n          switch (_context10.prev = _context10.next) {\n            case 0:\n              //info('delete:', req.url, req);\n              urlObj = url.parse(req.url); // Handle resource deletion\n\n              if (!(/^\\/resources/.test(urlObj.path) || /^\\/users/.test(urlObj.path))) {\n                _context10.next = 6;\n                break;\n              }\n\n              _context10.next = 4;\n              return dbUpsert({\n                url: req.url,\n                method: req.method,\n                valid: false\n              });\n\n            case 4:\n              _context10.next = 31;\n              break;\n\n            case 6:\n              _context10.prev = 6;\n              _context10.next = 9;\n              return getLookup(req);\n\n            case 9:\n              lookup = _context10.sent;\n              _context10.next = 12;\n              return dbUpsert({\n                url: '/' + lookup.resourceId + lookup.pathLeftover,\n                method: req.method,\n                valid: false\n              });\n\n            case 12:\n              _context10.next = 14;\n              return removeLookup(lookup);\n\n            case 14:\n              _context10.prev = 14;\n              _context10.next = 17;\n              return updateParent(req);\n\n            case 17:\n              _context10.next = 23;\n              break;\n\n            case 19:\n              _context10.prev = 19;\n              _context10.t0 = _context10[\"catch\"](14);\n              console.log('was a problem updating parent doc');\n              throw _context10.t0;\n\n            case 23:\n              _context10.next = 31;\n              break;\n\n            case 25:\n              _context10.prev = 25;\n              _context10.t1 = _context10[\"catch\"](6);\n\n              if (!(_context10.t1.response && _context10.t1.response.status === 404)) {\n                _context10.next = 30;\n                break;\n              }\n\n              _context10.next = 31;\n              break;\n\n            case 30:\n              throw _context10.t1;\n\n            case 31:\n              if (offline) {\n                _context10.next = 37;\n                break;\n              }\n\n              _context10.next = 34;\n              return request(req);\n\n            case 34:\n              response = _context10.sent;\n              _context10.next = 37;\n              break;\n\n            case 37:\n              return _context10.abrupt(\"return\", response);\n\n            case 38:\n            case \"end\":\n              return _context10.stop();\n          }\n        }\n      }, _callee10, this, [[6, 25], [14, 19]]);\n    }));\n\n    return function del(_x13, _x14) {\n      return _ref11.apply(this, arguments);\n    };\n  }();\n\n  var _recursiveUpsert = function () {\n    var _ref13 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee13(req, body) {\n      var lookup, newBody;\n      return _regenerator2.default.wrap(function _callee13$(_context13) {\n        while (1) {\n          switch (_context13.prev = _context13.next) {\n            case 0:\n              if (!(body._rev !== undefined)) {\n                _context13.next = 7;\n                break;\n              }\n\n              _context13.next = 3;\n              return getLookup({\n                url: req.url,\n                headers: req.headers,\n                resourceId: body._id\n              });\n\n            case 3:\n              lookup = _context13.sent;\n              newBody = replaceLinks(body, {\n                url: req.url,\n                headers: req.headers\n              });\n              _context13.next = 7;\n              return dbUpsert({\n                url: \"/\" + (body._id || lookup.resourceId),\n                data: newBody\n              });\n\n            case 7:\n              if (!((typeof body === \"undefined\" ? \"undefined\" : (0, _typeof3.default)(body)) === \"object\")) {\n                _context13.next = 11;\n                break;\n              }\n\n              return _context13.abrupt(\"return\", Promise.map((0, _keys2.default)(body || {}), function () {\n                var _ref14 = (0, _asyncToGenerator3.default)(\n                /*#__PURE__*/\n                _regenerator2.default.mark(function _callee12(key) {\n                  return _regenerator2.default.wrap(function _callee12$(_context12) {\n                    while (1) {\n                      switch (_context12.prev = _context12.next) {\n                        case 0:\n                          if (!(key.charAt(0) === \"_\")) {\n                            _context12.next = 2;\n                            break;\n                          }\n\n                          return _context12.abrupt(\"return\");\n\n                        case 2:\n                          if (body[key]) {\n                            _context12.next = 4;\n                            break;\n                          }\n\n                          return _context12.abrupt(\"return\");\n\n                        case 4:\n                          _context12.next = 6;\n                          return _recursiveUpsert({\n                            url: req.url + \"/\" + key,\n                            headers: req.headers\n                          }, body[key]);\n\n                        case 6:\n                        case \"end\":\n                          return _context12.stop();\n                      }\n                    }\n                  }, _callee12, this);\n                }));\n\n                return function (_x19) {\n                  return _ref14.apply(this, arguments);\n                };\n              }()));\n\n            case 11:\n              return _context13.abrupt(\"return\");\n\n            case 12:\n            case \"end\":\n              return _context13.stop();\n          }\n        }\n      }, _callee13, this);\n    }));\n\n    return function _recursiveUpsert(_x17, _x18) {\n      return _ref13.apply(this, arguments);\n    };\n  }();\n  /*\n  async function _recursiveUpsert(req, body, oldBody) {\n  if (body._rev) {\n      let lookup = await getLookup({\n        url: req.url,\n        headers: req.headers,\n        _id: body._id\n      })\n      let newBody = replaceLinks(body, {\n        url: req.url,\n        headers: req.headers\n      });\n    var result = await dbUpsert({\n        url: '/'+(body._id || lookup.resourceId),\n        data: newBody,\n      })\n      oldBody = result.oldBody;\n    }\n  \n    if (typeof body === 'object') {\n      return Promise.map(Object.keys(body || {}), async function(key) {\n        if (key.charAt(0) === '_') return\n        if (!body[key]) return\n        var oldPiece = await _recursiveUpsert({\n          url: req.url+'/'+key,\n          headers: req.headers\n        }, body[key], oldBody[key])\n        oldBody[key] = oldPiece;\n      }).then(() => {\n        return oldBody\n      })\n    } else return;\n  }*/\n\n\n  var resetCache = function () {\n    var _ref18 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee18() {\n      return _regenerator2.default.wrap(function _callee18$(_context18) {\n        while (1) {\n          switch (_context18.prev = _context18.next) {\n            case 0:\n              _context18.prev = 0;\n\n              if (!db) {\n                _context18.next = 6;\n                break;\n              }\n\n              _context18.next = 4;\n              return db.destroy();\n\n            case 4:\n              (0, _keys2.default)(memoryCache).forEach(function () {\n                var _ref19 = (0, _asyncToGenerator3.default)(\n                /*#__PURE__*/\n                _regenerator2.default.mark(function _callee17(key) {\n                  return _regenerator2.default.wrap(function _callee17$(_context17) {\n                    while (1) {\n                      switch (_context17.prev = _context17.next) {\n                        case 0:\n                          if (!memoryCache[key].promise) {\n                            _context17.next = 3;\n                            break;\n                          }\n\n                          _context17.next = 3;\n                          return memoryCache[key].promise.cancel();\n\n                        case 3:\n                        case \"end\":\n                          return _context17.stop();\n                      }\n                    }\n                  }, _callee17, this);\n                }));\n\n                return function (_x22) {\n                  return _ref19.apply(this, arguments);\n                };\n              }());\n              memoryCache = {};\n\n            case 6:\n              _context18.next = 11;\n              break;\n\n            case 8:\n              _context18.prev = 8;\n              _context18.t0 = _context18[\"catch\"](0);\n              return _context18.abrupt(\"return\");\n\n            case 11:\n            case \"end\":\n              return _context18.stop();\n          }\n        }\n      }, _callee18, this, [[0, 8]]);\n    }));\n\n    return function resetCache() {\n      return _ref18.apply(this, arguments);\n    };\n  }();\n\n  var name = _ref.name,\n      req = _ref.req,\n      expires = _ref.expires; // name should be made unique across domains and users\n\n  var db = db || new _pouchdb2.default(name); // This fixes concurrent accesses\n\n  _pouchdb2.default.on(\"destroyed\", function () {\n    var _ref2 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee(dbName) {\n      return _regenerator2.default.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (dbName === name) {\n                db = new _pouchdb2.default(name);\n              }\n\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this);\n    }));\n\n    return function (_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }());\n\n  var request = req;\n  var expiration = expires || 1000 * 60 * 60 * 24 * 2; //(ms/s)*(s/min)*(min/hr)*(hr/days)*days\n  // Clean in-memory cache periodically\n\n  setInterval(cleanMemoryCache, cleanMemoryTimer);\n\n  function cleanMemoryCache() {\n    var now = Date.now();\n    var oldest = {\n      key: undefined,\n      time: now\n    };\n    var deleteCount = 0;\n    (0, _keys2.default)(memoryCache).forEach(function (key) {\n      if (!memoryCache[key].promise && now - memoryCache[key].access < timeThreshold) {\n        if (memoryCache[key].access < oldest) {\n          oldest = {\n            key: key,\n            time: memoryCache[key].access\n          };\n        }\n\n        delete memoryCache[key];\n        deleteCount++;\n      }\n    });\n\n    if (deleteCount === 0 && oldest.key) {\n      delete memoryCache[oldest.key];\n    }\n  }\n  /** Save resource to in-memory cache and schedule PUT */\n\n\n  function handleMemoryCache(resourceId, data, waitTime, req) {\n    var now = Date.now();\n\n    if (resourceId in memoryCache) {\n      // resource exists in in-cache memory\n      // update data and access time\n      memoryCache[resourceId].data = data;\n      memoryCache[resourceId].access = now;\n    } else {\n      // resource does not exist\n      // add new resource\n      memoryCache[resourceId] = {\n        data: data,\n        access: now,\n        promise: undefined\n      };\n    } // Schedule db.put\n\n\n    if (!memoryCache[resourceId].promise) {\n      // Schedule put\n      memoryCache[resourceId].promise = Promise.delay(dbPutDelay).then(function () {\n        doPut(resourceId, waitTime, req);\n      }).catch(function (error) {\n        console.log('handleMemoryCacheError', error);\n      });\n    }\n\n    return Promise.resolve();\n  }\n  /**  Get resource from in-memory cache and do put to Pouch DB */\n\n\n  function doPut(resourceId, waitTime, req) {\n    return db.put(memoryCache[resourceId].data).then(function (response) {\n      memoryCache[resourceId].data._rev = response.rev;\n      delete memoryCache[resourceId].promise;\n    }).catch(function (err) {\n      console.log(\"Error doPut\", memoryCache[resourceId].data._rev, err); // TODO: Handle this error\n      // retry 409s\n      // if (err.status === 409) {\n      //   waitTime = waitTime || 1000;\n      //   return Promise.delay(waitTime).then(() => {\n      //     if (waitTime > 16000) throw err;\n      //     return dbUpsert(req, waitTime * 2);\n      //   });\n      // }\n      //throw err;\n    });\n  }\n\n  function _getMemoryCache() {\n    return memoryCache;\n  } // Perform lookup from bookmarks to resource id (and path leftover) mapping.\n  // If the lookup fails, use a HEAD request to get it from the server and put\n  // it in the cache. An optional _id can be passed into req to force creation\n  // of a particular lookup in the event that the resource doesn't yet exist but will.\n  // This is primarily for when links are created before the resource itself has been.\n\n\n  function getLookup(req) {\n    var urlObj = url.parse(req.url);\n    var res_inmemory = memoryCache[urlObj.path];\n\n    if (res_inmemory) {\n      return res_inmemory.data;\n    } else {\n      // not in memory  \n      return db.get(urlObj.path).catch((0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee4() {\n        var resourceId, pathLeftover, response, pieces, data;\n        return _regenerator2.default.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                if (!req.resourceId) {\n                  _context4.next = 5;\n                  break;\n                }\n\n                resourceId = req.resourceId;\n                pathLeftover = \"\";\n                _context4.next = 11;\n                break;\n\n              case 5:\n                _context4.next = 7;\n                return request({\n                  method: \"HEAD\",\n                  url: req.url,\n                  headers: req.headers\n                });\n\n              case 7:\n                response = _context4.sent; //info('getLookup - HEAD response:', response)\n                //Save the url lookup for future use\n\n                pieces = response.headers[\"content-location\"].split(\"/\");\n                resourceId = pieces.slice(1, 3).join(\"/\"); //returns resources/abc\n\n                pathLeftover = pieces.length > 3 ? \"/\" + pieces.slice(3, pieces.length).join(\"/\") : \"\";\n\n              case 11:\n                // Put the new lookup\n                data = {\n                  _id: urlObj.path,\n                  resourceId: resourceId,\n                  pathLeftover: pathLeftover\n                };\n                return _context4.abrupt(\"return\", handleMemoryCache(urlObj.path, data, undefined, req).then(function () {\n                  return getLookup(req);\n                }));\n\n              case 13:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      })));\n    }\n  }\n\n  function replaceLinks(obj, req) {\n    var ret = Array.isArray(obj) ? [] : {};\n    if (!obj) return obj;\n    (0, _keys2.default)(obj || {}).forEach(function () {\n      var _ref12 = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee11(key, i) {\n        var val, lookup;\n        return _regenerator2.default.wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                val = obj[key];\n\n                if (!((typeof val === \"undefined\" ? \"undefined\" : (0, _typeof3.default)(val)) !== \"object\" || !val)) {\n                  _context11.next = 4;\n                  break;\n                }\n\n                ret[key] = val; // keep it asntType: 'application/vnd.oada.harvest.1+json'\n\n                return _context11.abrupt(\"return\");\n\n              case 4:\n                if (!val._meta) {\n                  _context11.next = 11;\n                  break;\n                }\n\n                _context11.next = 7;\n                return getLookup({\n                  url: req.url + \"/\" + key,\n                  headers: req.headers\n                });\n\n              case 7:\n                lookup = _context11.sent;\n                ret[key] = {\n                  _id: lookup.resourceId\n                };\n                if (obj[key]._rev !== undefined) ret[key]._rev = obj[key]._rev;\n                return _context11.abrupt(\"return\");\n\n              case 11:\n                ret[key] = replaceLinks(obj[key], {\n                  url: req.url + \"/\" + key,\n                  headers: req.headers\n                });\n              // otherwise, recurse into the object\n\n              case 12:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n\n      return function (_x15, _x16) {\n        return _ref12.apply(this, arguments);\n      };\n    }());\n    return ret;\n  }\n\n  function findNullValue(obj, path, nullPath) {\n    if ((typeof obj === \"undefined\" ? \"undefined\" : (0, _typeof3.default)(obj)) === \"object\") {\n      return Promise.map((0, _keys2.default)(obj || {}), function (key) {\n        if (obj[key] === null) {\n          nullPath = path + \"/\" + key;\n          return nullPath;\n        }\n\n        return findNullValue(obj[key], path + \"/\" + key, nullPath).then(function (res) {\n          nullPath = res || nullPath;\n          return res || nullPath;\n        });\n      }, {\n        concurrency: 1\n      }).then(function () {\n        return nullPath;\n      }).catch(function (err) {\n        return;\n      });\n    } else {\n      return Promise.resolve(undefined);\n    }\n  }\n  /*\n  async function _upsertChangeArray(payload) {\n    let urlObj = url.parse(payload.request.url);\n    return Promise.map(payload.response.changes || [], async (change) => {\n      if (change.type === 'merge') {\n        return dbUpsert({\n          url: urlObj.protocol+'//'+urlObj.host+'/'+change._id,\n          data: change.body,\n        })\n      } else if (change.type === 'delete') {\n        var nullPath = await findNullValue(change.body, '', '')\n        return dbUpsert({\n          url: urlObj.protocol+'//'+urlObj.host+'/'+change._id+nullPath,\n          data: change.body,\n        })\n      }\n    })\n  }\n  */\n  // Will this handle watches put on keys of a resource? i.e., no _id to be found\n\n\n  function findDeepestResource(obj, path, deepestResource) {\n    if ((typeof obj === \"undefined\" ? \"undefined\" : (0, _typeof3.default)(obj)) === \"object\") {\n      return Promise.map((0, _keys2.default)(obj || {}), function (key) {\n        // _rev updates guaranteed to be present in change docs for affected resources\n        if (key === \"_rev\") {\n          deepestResource.path = path;\n          deepestResource.data = obj;\n        } else if (key.charAt(0) === \"_\") return deepestResource;\n\n        return findDeepestResource(obj[key], path + \"/\" + key, deepestResource).then(function () {\n          return deepestResource;\n        });\n      }).then(function () {\n        return deepestResource;\n      });\n    }\n\n    return Promise.resolve(deepestResource);\n  }\n\n  var queue = cq().limit({\n    concurrency: 1\n  }).process(function () {\n    var _ref15 = (0, _asyncToGenerator3.default)(\n    /*#__PURE__*/\n    _regenerator2.default.mark(function _callee16(payload) {\n      var _this = this;\n\n      var urlObj;\n      return _regenerator2.default.wrap(function _callee16$(_context16) {\n        while (1) {\n          switch (_context16.prev = _context16.next) {\n            case 0:\n              urlObj = url.parse(payload.request.url); // Give the change body an _id so the deepest resource can be found\n\n              payload.response.change.body._id = payload.response.resourceId; //TODO: This should be unnecessary. The payload ought to specify the root\n              //of the watch as a resource.\n\n              return _context16.abrupt(\"return\", findDeepestResource(payload.response.change.body, \"\", {\n                path: \"\",\n                data: payload.response.change.body\n              }).then(function () {\n                var _ref16 = (0, _asyncToGenerator3.default)(\n                /*#__PURE__*/\n                _regenerator2.default.mark(function _callee15(deepestResource) {\n                  var nullPath, deletedPath;\n                  return _regenerator2.default.wrap(function _callee15$(_context15) {\n                    while (1) {\n                      switch (_context15.prev = _context15.next) {\n                        case 0:\n                          if (!payload.response.change.wasDelete) {\n                            _context15.next = 9;\n                            break;\n                          }\n\n                          _context15.next = 3;\n                          return findNullValue(deepestResource.data, \"\", \"\");\n\n                        case 3:\n                          nullPath = _context15.sent;\n                          deletedPath = deepestResource.path + nullPath;\n                          payload.nullPath = deletedPath;\n                          return _context15.abrupt(\"return\", dbUpsert({\n                            url: payload.request.url + deletedPath,\n                            headers: payload.request.headers,\n                            method: \"delete\",\n                            valid: true\n                          }).then((0, _asyncToGenerator3.default)(\n                          /*#__PURE__*/\n                          _regenerator2.default.mark(function _callee14() {\n                            return _regenerator2.default.wrap(function _callee14$(_context14) {\n                              while (1) {\n                                switch (_context14.prev = _context14.next) {\n                                  case 0:\n                                    return _context14.abrupt(\"return\", payload);\n\n                                  case 1:\n                                  case \"end\":\n                                    return _context14.stop();\n                                }\n                              }\n                            }, _callee14, this);\n                          }))));\n\n                        case 9:\n                          _context15.next = 11;\n                          return _recursiveUpsert(payload.request, payload.response.change.body, {});\n\n                        case 11:\n                          return _context15.abrupt(\"return\", payload);\n\n                        case 12:\n                        case \"end\":\n                          return _context15.stop();\n                      }\n                    }\n                  }, _callee15, _this);\n                }));\n\n                return function (_x21) {\n                  return _ref16.apply(this, arguments);\n                };\n              }()).catch(function (err) {\n                return payload;\n              }));\n\n            case 3:\n            case \"end\":\n              return _context16.stop();\n          }\n        }\n      }, _callee16, this);\n    }));\n\n    return function (_x20) {\n      return _ref15.apply(this, arguments);\n    };\n  }());\n\n  function handleWatchChange(payload) {\n    return queue(payload);\n  }\n\n  var api = function handleRequest(req) {\n    switch (req.method) {\n      case \"get\":\n        return get(req);\n\n      case \"delete\":\n        return del(req);\n\n      case \"put\":\n        return put(req);\n    }\n  };\n\n  return _ref20 = {\n    api: api,\n    db: db,\n    resetCache: resetCache,\n    handleWatchChange: handleWatchChange,\n    removeLookup: removeLookup,\n    findDeepestResource: findDeepestResource,\n    findNullValue: findNullValue,\n    getLookup: getLookup,\n    dbUpsert: dbUpsert,\n    handleMemoryCache: handleMemoryCache,\n    doPut: doPut\n  }, (0, _defineProperty3.default)(_ref20, \"findDeepestResource\", findDeepestResource), (0, _defineProperty3.default)(_ref20, \"_recursiveUpsert\", _recursiveUpsert), (0, _defineProperty3.default)(_ref20, \"findNullValue\", findNullValue), (0, _defineProperty3.default)(_ref20, \"replaceLinks\", replaceLinks), (0, _defineProperty3.default)(_ref20, \"removeLookup\", removeLookup), (0, _defineProperty3.default)(_ref20, \"updateParent\", updateParent), (0, _defineProperty3.default)(_ref20, \"getResFromDb\", getResFromDb), (0, _defineProperty3.default)(_ref20, \"getResFromServer\", getResFromServer), (0, _defineProperty3.default)(_ref20, \"_getMemoryCache\", _getMemoryCache), _ref20;\n}","'use strict';\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _defineProperty2 = require('babel-runtime/helpers/defineProperty');\n\nvar _defineProperty3 = _interopRequireDefault(_defineProperty2);\n\nvar _slicedToArray2 = require('babel-runtime/helpers/slicedToArray');\n\nvar _slicedToArray3 = _interopRequireDefault(_slicedToArray2);\n\nvar _entries = require('babel-runtime/core-js/object/entries');\n\nvar _entries2 = _interopRequireDefault(_entries);\n\nvar _stringify = require('babel-runtime/core-js/json/stringify');\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar Promise = require('bluebird');\n\nvar urlLib = require('url');\n\nvar uuid = require('uuid/v4');\n\nvar WebSocket = require('isomorphic-ws'); //const error = require('debug')('oada-cache:websocket:error');\n//const info = require('debug')('oada-cache:websocket:info');\n\n\nPromise.config({\n  warnings: false\n});\n\nfunction websocket(url) {\n  //Create the message queue\n  var messages = []; //Create the socket\n\n  url = url.replace('https://', 'wss://').replace('http://', 'ws://');\n  var socket = new WebSocket(url);\n  var connected = false;\n  var httpCallbacks = {};\n  var watchCallbacks = {};\n\n  function sendMessages() {\n    if (!connected) return;\n    messages.forEach(function (message) {\n      socket.send((0, _stringify2.default)(message));\n    });\n    messages = [];\n  }\n\n  return new Promise(function (resolve, reject) {\n    socket.onopen = function (event) {\n      connected = true;\n      sendMessages();\n      resolve(socket);\n    };\n\n    socket.onclose = function (event) {};\n\n    socket.onmessage = function (event) {\n      var response = JSON.parse(event.data); //Look for id in httpCallbacks\n\n      if (response.requestId) {\n        if (httpCallbacks[response.requestId]) {\n          //Resolve Promise\n          if (response.status >= 200 && response.status < 300) {\n            httpCallbacks[response.requestId].resolve(response);\n          } else {\n            //Create error like axios\n            var err = new Error('Request failed with status code ' + response.status);\n            err.request = httpCallbacks[response.requestId].request;\n            err.response = {\n              status: response.status,\n              statusText: response.statusText,\n              headers: response.headers,\n              data: response.data\n            };\n            httpCallbacks[response.requestId].reject(err);\n          }\n\n          delete httpCallbacks[response.requestId];\n        } else if (watchCallbacks[response.requestId]) {\n          if (watchCallbacks[response.requestId].resolve) {\n            if (response.status === 'success') {\n              //Successfully setup websocket, resolve promise\n              watchCallbacks[response.requestId].resolve(response);\n            } else {\n              //error(watchCallbacks[response.requestId].request, response);\n              var _err = new Error('Request failed with status code ' + response.status);\n\n              _err.response = response;\n              _err.request = watchCallbacks[response.requestId].request;\n              watchCallbacks[response.requestId].reject(_err);\n            } //Remove resolve and reject so we process change as a signal next time\n\n\n            delete watchCallbacks[response.requestId]['resolve'];\n            delete watchCallbacks[response.requestId]['reject'];\n          } else {\n            if (watchCallbacks[response.requestId].callback == null) throw new Error('The given watch function has an undefined callback:', watchCallbacks[response.requestId]);\n            watchCallbacks[response.requestId].callback(response);\n          }\n        }\n      }\n    };\n  }).then(function () {\n    function _http(request) {\n      //Do a HTTP request\n      return new Promise(function (resolve, reject) {\n        var urlObj = urlLib.parse(request.url);\n        var message = {\n          requestId: uuid(),\n          method: request.method.toLowerCase(),\n          path: urlObj.path,\n          data: request.data,\n          headers: (0, _entries2.default)(request.headers).map(function (_ref) {\n            var _ref2 = (0, _slicedToArray3.default)(_ref, 2),\n                key = _ref2[0],\n                value = _ref2[1];\n\n            return (0, _defineProperty3.default)({}, key.toLowerCase(), value);\n          }).reduce(function (a, b) {\n            return (0, _extends3.default)({}, a, b);\n          })\n        };\n        messages.push(message);\n        httpCallbacks[message.requestId] = {\n          request: request,\n          resolve: resolve,\n          reject: reject\n        };\n        sendMessages();\n      });\n    }\n\n    function _unwatch(request, callback) {\n      //Watch for changes on requested resource and trigger provided signal\n      return new Promise(function (resolve, reject) {\n        var message = {\n          requestId: uuid(),\n          method: 'unwatch',\n          path: request.path,\n          headers: (0, _entries2.default)(request.headers).map(function (_ref4) {\n            var _ref5 = (0, _slicedToArray3.default)(_ref4, 2),\n                key = _ref5[0],\n                value = _ref5[1];\n\n            return (0, _defineProperty3.default)({}, key.toLowerCase(), value);\n          }).reduce(function (a, b) {\n            return (0, _extends3.default)({}, a, b);\n          })\n        };\n        messages.push(message);\n        watchCallbacks[message.requestId] = {\n          request: request,\n          resolve: resolve,\n          reject: reject,\n          callback: callback\n        };\n        sendMessages();\n      });\n    }\n\n    function _watch(request, callback) {\n      //Watch for changes on requested resource and trigger provided signal\n      return new Promise(function (resolve, reject) {\n        var message = {\n          requestId: uuid(),\n          method: 'watch',\n          path: request.path,\n          headers: (0, _entries2.default)(request.headers).map(function (_ref7) {\n            var _ref8 = (0, _slicedToArray3.default)(_ref7, 2),\n                key = _ref8[0],\n                value = _ref8[1];\n\n            return (0, _defineProperty3.default)({}, key.toLowerCase(), value);\n          }).reduce(function (a, b) {\n            return (0, _extends3.default)({}, a, b);\n          })\n        };\n        messages.push(message);\n        watchCallbacks[message.requestId] = {\n          request: request,\n          resolve: resolve,\n          reject: reject,\n          callback: callback\n        };\n        sendMessages();\n      });\n    }\n\n    function _close() {\n      //TODO reject all callbacks that have not resolved\n      //Clear everything\n      messages = [];\n      httpCallbacks = {};\n      watchCallbacks = {}; //Close socket\n\n      socket.close();\n    }\n\n    return {\n      url: url,\n      http: _http,\n      close: _close,\n      watch: _watch,\n      unwatch: _unwatch\n    };\n  });\n}\n\nmodule.exports = websocket;"],"sourceRoot":""}